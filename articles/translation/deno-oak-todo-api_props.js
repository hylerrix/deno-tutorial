import projectConfig from '/pagic.config.js';
import Ga from '/_ga.js';
import Gitalk from '/_gitalk.js';
export default {
    'prev': {
        "text": "ä» Node åˆ° Denoï¼šæ¢ç´¢å„å¤§ä¸»æµåº“æ›¿ä»£æ–¹æ¡ˆ",
        "link": "articles/translation/from-node-to-deno.html"
    },
    'next': {
        "text": "Deno + Oak è¿æ¥ MySQL å®æˆ˜æ•™ç¨‹",
        "link": "articles/translation/deno-oak-mysql.html"
    },
    config: { "root": "/", ...projectConfig, branch: 'main' },
    'pagePath': "articles/translation/deno-oak-todo-api.md",
    'layoutPath': "_layout.tsx",
    'outputPath': "articles/translation/deno-oak-todo-api.html",
    'title': "Deno + Oak æ„å»ºé…·ç‚«çš„ Todo API",
    'content': React.createElement("article", { dangerouslySetInnerHTML: {
            __html: '<h1>Deno + Oak æ„å»ºé…·ç‚«çš„ Todo API</h1>\n<blockquote>\n<ul>\n<li>åŸæ–‡åœ°å€ï¼š<a href="https://www.freecodecamp.org/news/create-a-todo-api-in-deno-written-by-a-guy-coming-from-node/">How to Create a Todo API in Deno and Oak</a></li>\n<li>åŸæ–‡ä½œè€…ï¼šAdeel Imran</li>\n<li>åŸæ–‡å‘å¸ƒæ—¶é—´ï¼š2020-05-29</li>\n<li>è¯‘è€…ï¼š<a href="https://github.com/hylerrix">hylerrix</a></li>\n<li>å¤‡æ³¨ï¼šæœ¬æ–‡éµå¾ª <a href="https://github.com/freeCodeCamp/news-translation">freeCodeCamp ç¿»è¯‘è§„èŒƒ</a>ï¼ŒåŒæ—¶æœ¬æ–‡ä¼šæ”¶å½•åœ¨<a href="https://github.com/hylerrix/deno-tutorial">ã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹</a>çš„ç¿»è¯‘ç¯‡ä¸­ã€‚</li>\n<li>å¤‡æ³¨ï¼šã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹ç”µå­ä¹¦å®˜ç½‘ä¸Šçº¿å•¦ï¼<a href="https://deno-tutorial.js.org">https://deno-tutorial.js.org</a></li>\n</ul>\n</blockquote>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-01.jpg" alt=""></p>\n<h2 id="%E5%BA%8F%E8%A8%80">åºè¨€<a class="anchor" href="#%E5%BA%8F%E8%A8%80">Â§</a></h2>\n<p>æˆ‘æ˜¯ä¸€ä½ JavaScript/Node å¼€å‘è€…ï¼Œé»˜é»˜åœ°å–œæ¬¢ç”šè‡³çˆ±æ…•ç€ Denoã€‚Deno è¯ç”Ÿä¹‹åˆå°±æ·±æ·±åœ°å¸å¼•äº†æˆ‘ï¼Œæ­¤åæˆ‘æˆä¸ºäº† Deno çš„å¿ å®ç²‰ä¸ï¼ŒæœŸå¾…ç€æœ‰æœä¸€æ—¥èƒ½æ­£å¼ç©ä¸Š Denoã€‚</p>\n<p>æœ¬æ–‡ä¸“æ³¨äºåˆ›é€ ä¸€ä¸ªåŸºäº REST API è®¾è®¡çš„å¾…åšæ¸…å•ï¼ˆTodoï¼‰åº”ç”¨ã€‚è¯·è®°ä½æœ¬æ–‡ä¸­è¿˜ä¸ä¼šæ¶‰åŠæœ‰å…³æ•°æ®åº“æ“ä½œçš„çŸ¥è¯†ï¼Œå…¶å†…å®¹ä¼šåœ¨æˆ‘ä¹‹åçš„<a href="https://www.freecodecamp.org/news/how-to-use-mysql-in-deno-oak/">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>\n<p>å¦‚æœä½ æƒ³èƒ½å¤Ÿéšæ—¶å›é¡¾æˆ–å‚è€ƒæœ¬æ–‡çš„ä»£ç ï¼Œå¯ä»¥è®¿é—®æˆ‘çš„è¿™ä¸ªä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ï¼Œæ”¶å½•äº†è¯¥ç³»åˆ—çš„æ‰€æœ‰ä»£ç ã€‚</p>\n<blockquote>\n<p>è¯‘è€…æ³¨ï¼šå¦ä¸€ç¯‡æ–‡ç« ã€ŠHow to Use MySQL With Deno and Oakã€‹å³å°†ä¼šè¢«ç¿»è¯‘ï¼Œå…¶ç›¸å…³ Demo ä¹Ÿä¼šè¢«æ”¶å½•åœ¨ã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹ä¸­ã€‚</p>\n</blockquote>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-02.jpg" alt=""></p>\n<p>ç…§ç‰‡æ¥è‡ªäºÂ <a href="https://unsplash.com/@bernardtheclerk?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Bernard de Clerk</a> / <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Unsplash</a></p>\n<h3 id="%E6%9C%AC%E6%96%87%E4%BC%9A%E6%B6%89%E5%8F%8A%E7%9A%84%E5%86%85%E5%AE%B9">æœ¬æ–‡ä¼šæ¶‰åŠçš„å†…å®¹<a class="anchor" href="#%E6%9C%AC%E6%96%87%E4%BC%9A%E6%B6%89%E5%8F%8A%E7%9A%84%E5%86%85%E5%AE%B9">Â§</a></h3>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ªæœ€åŸºç¡€çš„æœåŠ¡å™¨</li>\n<li>åˆ›å»º 5 ä¸ª APIsï¼ˆè·¯ç”± routes/æ§åˆ¶å™¨ controllerï¼‰</li>\n<li>åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶æ¥ç»™ API è¯·æ±‚æ·»åŠ ç»ˆç«¯è¾“å‡ºçš„æ—¥å¿—åŠŸèƒ½</li>\n<li>åˆ›å»ºä¸€ä¸ª 404 ä¸­é—´ä»¶æ¥å¤„ç†ç”¨æˆ·è®¿é—®æœªçŸ¥ API æ—¶çš„æƒ…å†µ</li>\n</ul>\n<h3 id="%E6%9C%AC%E6%96%87%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87">æœ¬æ–‡éœ€è¦çš„çŸ¥è¯†å‡†å¤‡<a class="anchor" href="#%E6%9C%AC%E6%96%87%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87">Â§</a></h3>\n<ul>\n<li>ä¸€ä¸ªå·²ç»å®‰è£…å¥½çš„ Deno ç¯å¢ƒï¼ˆåˆ«æ€•ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ æ€ä¹ˆåšï¼‰</li>\n<li>å¯¹ TypeScript æœ‰æµ…è¦çš„äº†è§£</li>\n<li>å¦‚æœä½ ä¹‹å‰å¯¹ Node/Express ä¸€å®šçš„äº†è§£å°±æ›´å¥½äº†ï¼ˆä¸äº†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œæœ¬æ–‡è¿˜æ˜¯å¾ˆé€šä¿—æ˜“æ‡‚çš„ï¼‰</li>\n</ul>\n<h2 id="%E8%AE%A9%E6%88%91%E4%BB%AC%E5%BC%80%E5%A7%8B%E5%90%A7">è®©æˆ‘ä»¬å¼€å§‹å§<a class="anchor" href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%BC%80%E5%A7%8B%E5%90%A7">Â§</a></h2>\n<p>é¦–å…ˆæˆ‘ä»¬è¦å…ˆå®‰è£… Denoã€‚ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°†ä½¿ç”¨ brewã€‚åªéœ€è¦æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥è¿™æ¡å‘½ä»¤å³å¯ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ brew <span class="token function">install</span> deno\n</code></pre>\n<p>ä½†å¦‚æœä½ ç”¨çš„æ˜¯å…¶å®ƒæ“ä½œç³»ç»Ÿçš„è¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå®‰è£…æ‰‹å†Œå¯ä»¥çœ‹çœ‹ï¼š<a href="https://deno.land/#installation">deno.land installation</a>ã€‚ä¸Šé¢æœ‰å¤šæ ·åŒ–çš„å®‰è£…æ–¹å¼å¯ä¾›ä½ æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿæ¥é€‰æ‹©ã€‚</p>\n<p>ä¸€æ—¦ä½ å®‰è£…æˆåŠŸï¼Œå…³é—­ç»ˆç«¯å¹¶æ‰“å¼€å¦ä¸€ä¸ªåï¼Œè¾“å…¥è¿™æ¡å‘½ä»¤ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno --version\n</code></pre>\n<p>ä¸€åˆ‡æ­£å¸¸çš„è¯ç»ˆç«¯ä¼šäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-03.jpg" alt=""></p>\n<p><code>deno --version</code> å‘½ä»¤ç”¨æ¥æŸ¥çœ‹å½“å‰å®‰è£…çš„ Deno æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚</p>\n<p>æ£’æäº†ï¼é€šè¿‡è¿™ä¸ªä»‹ç»æˆ‘ä»¬å·²ç»æˆåŠŸå®Œæˆäº†æœ¬æ–‡ 10% çš„æŒ‘æˆ˜ã€‚</p>\n<p>è®©æˆ‘ä»¬ç»§ç»­æ¢ç´¢ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„å¾…åšæ¸…å•åº”ç”¨åˆ›å»ºä¸€ä¸ªåç«¯ API å§ã€‚</p>\n<h2 id="%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">é¡¹ç›®çš„å‡†å¤‡å·¥ä½œ<a class="anchor" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">Â§</a></h2>\n<p>é˜…è¯»ä¸‹æ–‡ï¼Œå¯ä»¥æ¥æå‰æ¥ä»“åº“é‡Œçœ‹çœ‹æœ¬æ–‡æ”¶å½•çš„æ‰€æœ‰ä»£ç ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬ä»é›¶åšèµ·ï¼š</p>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>chapter_1:oak</code> çš„æ–°æ–‡ä»¶å¤¹ï¼ˆä½ ä¹Ÿå¯ä»¥éšæ„èµ·åï¼‰ã€‚</li>\n<li>å½“ä½ åˆ›å»ºå®Œæ¯•åä½¿ç”¨ <code>cd</code> å‘½ä»¤è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚åˆ›å»ºä¸€ä¸ªåä¸º <strong>server.ts</strong> çš„æ–‡ä»¶å¹¶å¡«å……å¦‚ä¸‹ä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬å…ˆè¿è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚æ‰“å¼€ä½ çš„ç»ˆç«¯å¹¶è¿›å…¥å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•åï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åˆ«æ€¥åˆ«æ€¥ï¼Œæˆ‘ä¼šåœ¨ä¹‹åæ¥ä»‹ç» <code>--allow-net</code> å‚æ•°åˆ°åº•åšäº†ä»€ä¹ˆçš„ ğŸ˜„ã€‚</p>\n<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-04.jpg" alt=""></p>\n<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç›‘å¬ç€ 8080 ç«¯å£çš„æœåŠ¡ç«¯åº”ç”¨ã€‚åªæœ‰ 8080 ç«¯å£ä¸è¢«å ç”¨ï¼Œè¿™ä¸ªåº”ç”¨æ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚</p>\n<p>å¦‚æœä½ æœ‰è¿‡ä½¿ç”¨ JavaScript å¼€å‘çš„ç»éªŒï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬å¯¼å…¥æ¨¡å—çš„æ–¹å¼æœ‰äº›ä¸ä¸€æ ·ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯è¿™æ ·å¯¼å…¥æ¨¡å—çš„ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">import { Application } from <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token comment">;</span>\n</code></pre>\n<p>å½“ä½ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>deno run ---allow-net &lt;file_name&gt;</code> å‘½ä»¤æ—¶ï¼ŒDeno ä¼šè¯»å–ä½ çš„å¯¼å…¥ä¿¡æ¯ï¼Œå¹¶åœ¨æœ¬åœ°çš„å…¨å±€ç¯å¢ƒä¸­æ²¡æœ‰å®‰è£…è¯¥æ¨¡å—çš„æƒ…å†µä¸‹å®‰è£…è¿™äº›æ¨¡å—ã€‚</p>\n<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ Deno ä¼šå°è¯•è®¿é—® <code>https://deno.land/x/oak/mod.ts</code> æ¨¡å—å¹¶å®‰è£… <code>oak</code> åº“ã€‚ Oak æ˜¯ä¸€ä¸ªä¸“æ³¨äºç¼–å†™ API çš„ Deno Web æ¡†æ¶ã€‚</p>\n<p>æ¥ä¸‹æ¥çš„ä¸€è¡Œæˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™æ¡è¯­å¥ä¸ºæˆ‘ä»¬çš„åº”ç”¨åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹æ˜¯æœ¬æ–‡æ·±å…¥æ¢ç´¢ Deno çš„åŸºçŸ³ã€‚ä½ å¯ä»¥ä¸ºè¿™ä¸ªå®ä¾‹å¢åŠ è·¯ç”±ï¼Œé…ç½®ä¸­é—´ä»¶ï¼ˆå¦‚æ—¥å¿—ä¸­é—´ä»¶ï¼‰ï¼Œç¼–å†™ 404 æœªçŸ¥è·¯ç”±å¤„ç†ç¨‹åºç­‰ç­‰ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n<span class="token comment">// const port = 8080; // => ä¹Ÿå¯ä»¥å†™æˆè¿™æ ·</span>\n</code></pre>\n<p>ä¸Šé¢ä¸¤è¡Œåœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ <code>const port: number = 8080</code> å‘Šè¯‰ TypeScriptï¼š <code>port</code> å˜é‡çš„ç±»å‹æ˜¯æ•°å€¼ç±»çš„ã€‚</p>\n<p>å¦‚æœä½ è¿™æ ·å†™çš„è¯ï¼š<code>const port: number = &quot;8080&quot;</code>ï¼Œç»ˆç«¯ä¼šäº§ç”Ÿç±»ä¼¼è¿™æ ·çš„æŠ¥é”™ï¼šport å˜é‡åº”è¯¥æ˜¯Â <code>number</code> ç±»å‹çš„ï¼Œä½†æ˜¯è¿™ç±»å°è¯•ç”¨Â <code>string</code> ç±»å‹çš„ &quot;8080&quot; æ¥ä¸ºå…¶èµ‹å€¼ã€‚</p>\n<p>å¦‚æœä½ æƒ³å­¦ä¹ å…³äº Type çš„æ›´å¤šç±»å‹ç°åœ¨å°±å¯ä»¥çœ‹çœ‹è¿™ä¸ªç®€å•çš„æ–‡æ¡£ï¼š<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">TypeScript å®˜æ–¹ - åŸºç¡€ Types ç±»å‹</a>ã€‚ä»…ä»… 2~3 åˆ†é’Ÿå°±å¯ä»¥é‡æ–°å›åˆ°æœ¬æ–‡ã€‚</p>\n<p>åœ¨æ–‡ä»¶çš„æœ€åæˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚ä¸Šæˆ‘ä»¬è®© Deno ç›‘å¬äº† 8080 ç«¯å£ï¼Œç«¯å£å·æ˜¯å†™æ­»çš„ã€‚</p>\n<p>åœ¨ä½ çš„ <strong>server.ts</strong> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ›´å¤šçš„ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nrouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç›¸æ¯”ä¹‹å‰æ–°å¢çš„å†…å®¹æ˜¯ä» <code>oak</code> ä¸­åŒæ—¶å¯¼å…¥äº† <code>Application</code> å’Œ <code>Router</code>Â å˜é‡ã€‚</p>\n<p>å…¶ä¸­å…³äº <code>Router</code> çš„ç›¸å…³ä»£ç æ˜¯ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> router <span class="token operator">=</span> new <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>\nrouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>{ response }<span class="token punctuation">:</span> { response<span class="token punctuation">:</span> any }<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> {\n    message<span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  }<span class="token comment">;</span>\n}<span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>æˆ‘ä»¬é€šè¿‡ <code>const router = new Router()</code> è¯­å¥åˆ›å»ºäº†æ–°çš„ Router ç¤ºä¾‹ï¼Œç„¶åæˆ‘ä»¬ä¸ºå…¶æ ¹ç›®å½• <code>/</code> åˆ›å»ºäº†å¤„ç† <code>get</code> è¯·æ±‚çš„æ‰§è¡Œæ–¹å¼ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>router.get</code> å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è·¯ç”±æŒ‚è½½çš„è·¯å¾„ <code>/</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å‡½æ•°æœ¬èº«ä¹Ÿæ¥å—ä¸€ä¸ªå¯¹è±¡å‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨ ES6 è¯­æ³•å°†å…¶è§£æ„ï¼Œåªå–äº†å…¶ä¸­ response å˜é‡çš„å€¼ã€‚</p>\n<p>æ¥ä¸‹æ¥å°±åƒä¹‹å‰ç¼–å†™Â <code>const port: number = 8080;</code> è¯­å¥ä¸€æ ·ä¸º <code>response</code> å˜é‡å£°æ˜ç±»å‹ã€‚<code>{ response }: { response: any }</code> è¯­å¥å‘Šè¯‰ TypeScript æˆ‘ä»¬è¿™é‡Œè§£æ„çš„ <code>response</code> å˜é‡æ˜¯ <code>any</code> ç±»å‹çš„ã€‚</p>\n<p><code>any</code> ç±»å‹å¯ä»¥å¸®å‡†ä½ é¿å… TypeScript è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œä½ å¯ä»¥é€šè¿‡<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html#any">è¿™ä¸ªæ–‡æ¡£</a>æ¥äº†è§£æ›´å¤šã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘æ‰€ç¼–å†™çš„å°±æ˜¯ä½¿ç”¨ <code>response</code> å˜é‡ï¼Œå¹¶è®¾ç½® <code>response.body.message = &quot;hello world&quot;;</code>ã€‚</p>\n<pre class="language-autoit"><code class="language-autoit">response<span class="token punctuation">.</span>body <span class="token operator">=</span> {\n  message<span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n}<span class="token comment">;</span>\n</code></pre>\n<p>æœ€ååŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ç¼–å†™äº†å¦‚ä¸‹ä¸¤è¡Œä»£ç ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>ç¬¬ä¸€è¡Œå‘Šè¯‰ Deno è¦åŒ…å«æˆ‘ä»¬çš„ router å˜é‡é‡Œè®¾ç½®çš„æ‰€æœ‰è·¯å¾„ï¼ˆç›®å‰æˆ‘ä»¬åªè®¾ç½®äº†æ ¹è·¯å¾„ï¼‰ï¼Œç¬¬äºŒè¡Œè®© Deno å…è®¸ä»»æ„è®¿é—®æ–¹æ³•æ¥è¯·æ±‚æˆ‘ä»¬è®¾ç½®çš„è·¯å¾„ï¼Œæ¯”å¦‚ <code>GET, POST, PUT, DELETE</code>ã€‚</p>\n<p>åˆ°è¿™é‡Œå°±å¯ä»¥æµ‹è¯•è¿è¡Œäº† âœ… ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œè¿™è¡Œè¯­å¥æ¥çœ‹çœ‹æœ€ç»ˆä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p><code>---allow-net</code> å‚æ•°å‘Šè¯‰ Denoï¼šç”¨æˆ·æˆäºˆäº†è¿™ä¸ªåº”ç”¨åœ¨æ‰“å¼€çš„ç«¯å£ä¸Šè®¿é—®ç½‘ç»œçš„æƒé™ã€‚</p>\n<p>ç°åœ¨é€šè¿‡ä½ å¸¸ç”¨çš„æµè§ˆå™¨æ‰“å¼€ <code>http://localhost:8080</code> åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-05.jpg" alt="">\næµè§ˆå™¨æ‰“å¼€ localhost:8080 çš„æ‰§è¡Œç»“æœ</p>\n<p>æœ€éš¾çš„éƒ¨åˆ†å·®ä¸å¤šæå®šäº†ï¼Œä½†åœ¨å¯¹æ¦‚å¿µçš„æ›´å¤šäº†è§£ä¸­æˆ‘ä»¬åªè¿›è¡Œäº† 60% çš„ä»‹ç»ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-06.jpg" alt="">\næ¥è‡ª Yoda å¤§å¸ˆçš„æ‰¹å‡†</p>\n<p>æ£’æäº†ã€‚</p>\n<p>åœ¨æˆ‘ä»¬æ­£å¼å¼€å§‹ç¼–å†™å¾…åšæ¸…å•çš„ API å‰ï¼Œæˆ‘ä»¬æœ€åè¦åšçš„äº‹æ˜¯å°†å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ›¿æ¢æˆè¿™æ ·ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">app<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> secure<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> protocol <span class="token operator">=</span> secure <span class="token operator">?</span> <span class="token string">"https://"</span> <span class="token operator">:</span> <span class="token string">"http://"</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> url <span class="token operator">=</span> $<span class="token punctuation">{</span>protocol<span class="token punctuation">}</span>$<span class="token punctuation">{</span>hostname <span class="token operator">??</span> <span class="token string">"localhost"</span><span class="token punctuation">}</span><span class="token operator">:</span>$<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Listening on<span class="token operator">:</span> $<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬ä¹‹å‰çš„ä»£ç æ˜¯å…ˆåœ¨æ§åˆ¶å°ä¸Šç®€å•çš„æ‰“å°ä¸€æ¡æˆåŠŸæ—¥å¿—ï¼Œç„¶åå†è®©åº”ç”¨å¼€å§‹åœ¨ç«¯å£ä¸Šç›‘å¬ï¼Œä¸æ˜¯å¾ˆä¼˜é›…ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰å¯èƒ½ä¼šåœ¨ç›‘å¬å¤±è´¥çš„æƒ…å†µä¸‹ä¾ç„¶æ‰“å°ç›‘å¬æˆåŠŸçš„æ—¥å¿—ï¼‰ã€‚</p>\n<p>åœ¨æ›¿æ¢åçš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>app.addEventListener(&quot;listen&quot;, ({ secure, hostname, port }) =&gt; {}</code> è¯­å¥æ¥å‘åº”ç”¨å®ä¾‹æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨åï¼Œå†è®©åº”ç”¨ç›‘å¬åœ¨ç«¯å£ä¸Šã€‚</p>\n<p>ä¾¦å¬å™¨çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æƒ³ä¾¦å¬çš„äº‹ä»¶ã€‚ä¸€è¯­åŒå…³ï¼Œè¿™é‡Œä¾¦å¬ï¼ˆlistenï¼‰çš„å°±æ˜¯ <code>listen</code> äº‹ä»¶ ğŸ˜…ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯ä»¥è¢«è§£æ„çš„å¯¹è±¡ï¼Œè¿™é‡Œè§£æ„å‡º <code>{ secure, hostname, port }</code> ä¸‰ä¸ªå˜é‡ã€‚Secure å˜é‡æ˜¯å¸ƒå°”ç±»å‹ï¼Œhostname å˜é‡æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œport å˜é‡æ˜¯æ•°å€¼ç±»å‹ã€‚</p>\n<p>æ­¤æ—¶è¿è¡Œè¿™ä¸ªåº”ç”¨çš„è¯ï¼Œåªæœ‰åœ¨æˆåŠŸç›‘å¬æŒ‡å®šç«¯å£åæ‰ä¼šè¾“å‡ºç›‘å¬æˆåŠŸçš„æ—¥å¿—ï¼Œ</p>\n<p>æˆ‘ä»¬å¯ä»¥å†å‘è¿œæ–¹è¿ˆå‡ºä¸€æ­¥ï¼Œä½¿å…¶æ›´åŠ ä¸°å¯Œå¤šå½©ã€‚è®©æˆ‘ä»¬åœ¨ <code>server.ts</code> æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ è¿™æ ·ä¸€ä¸ªæ–°æ¨¡å—ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> green<span class="token punctuation">,</span> yellow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹å‰çš„äº‹ä»¶ä¾¦å¬å™¨å‡½æ•°é‡Œå°†å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Listening on<span class="token operator">:</span> $<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ›¿æ¢ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">"Listening on:"</span><span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ¥ä¸‹æ¥å½“æˆ‘ä»¬æ‰§è¡Œï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>å°†ä¼šæ‰“å°è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-07.jpg" alt=""></p>\n<p>å¤ªé…·äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªè‰²å½©ç¼¤çº·çš„æ§åˆ¶å°ã€‚</p>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®æœ¬æ•™ç¨‹çš„æºç ä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">@adeelibr/deno-playground</a>ã€‚</p>\n<p>è®©æˆ‘ä»¬æ¥ä¸‹æ¥åˆ›å»ºå¾…åšæ¸…å•çš„ API å§ã€‚</p>\n<ul>\n<li>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>routes</code> æ–‡ä»¶å¤¹ï¼Œç„¶åå†æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>todo.ts</code> æ–‡ä»¶ã€‚</li>\n<li>ä¸æ­¤åŒæ—¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>controllers</code> æ–‡ä»¶å¤¹ï¼Œå†åœ¨æ–‡ä»¶å¤¹é‡Œä¹Ÿåˆ›å»ºä¸€ä¸ª <code>todo.ts</code> æ–‡ä»¶ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥å¡«å…… <code>controllers/todo.ts</code> æ–‡ä»¶é‡Œçš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬åœ¨è¿™é‡Œå…ˆç®€å•åœ°å¯¼å‡ºäº†ä¸€ä¸ªåŒ…å«å¾ˆå¤šæœ‰åå­—çš„å‡½æ•°çš„å¯¹è±¡ï¼Œè¿™äº›å‡½æ•°ç›®å‰éƒ½æ˜¯ç©ºçš„ã€‚</p>\n<p>æ¥ä¸‹æ¥åœ¨ <code>routes/todo.ts</code> æ–‡ä»¶ä¸­å¡«å……è¿™äº›ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// controller æ§åˆ¶å™¨</span>\n<span class="token keyword">import</span> todoController <span class="token keyword">from</span> <span class="token string">"../controllers/todo.ts"</span><span class="token punctuation">;</span>\nrouter\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getAllTodos<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>createTodo<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>updateTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>deleteTodoById<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>\n</code></pre>\n<p>å¯¹äºç¼–å†™è¿‡ Node å’Œ Express çš„äººæ¥è¯´ï¼Œå¯¹å¦‚ä¸Šçš„ä»£ç é£æ ¼ä¸€å®šå¾ˆç†Ÿæ‚‰ã€‚</p>\n<p>å…¶ä¸­åŒ…æ‹¬ä» <code>oak</code> ä¸­å¯¼å…¥äº† <code>Route</code> å˜é‡å¹¶é€šè¿‡ <code>const router = new Router();</code> è¯­å¥å°†å…¶å®ä¾‹åŒ–ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¼å…¥æˆ‘ä»¬çš„æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">import todoController from <span class="token string">"../controllers/todo.ts"</span><span class="token comment">;</span>\n</code></pre>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ Deno ä¸­æˆ‘ä»¬æ¯æ¬¡å¯¼å…¥ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åˆ°é¡¹ç›®ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¡«å†™å®Œæ•´è¿™ä¸ªæ–‡ä»¶çš„åç¼€ã€‚å¦åˆ™ Deno æ˜¯ä¸çŸ¥é“ç”¨æˆ·æƒ³è¦å¯¼å…¥çš„æ–‡ä»¶åç¼€åˆ°åº•ä»¥ <code>.js</code>Â è¿˜æ˜¯ <code>.ts</code> ç»“å°¾ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç ä¸ºåº”ç”¨é…ç½®äº†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ RESTful é£æ ¼çš„è·¯å¾„ã€‚</p>\n<pre class="language-typescript"><code class="language-typescript">router\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getAllTodos<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>createTodo<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>updateTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>deleteTodoById<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ä¸Šé¢çš„ä»£ç ä¼šå°†è·¯å¾„è§£æä¸ºè¿™æ ·ï¼š</p>\n<div class="table_wrapper"><table>\n<thead>\n<tr>\n<th>è¯·æ±‚æ–¹å¼</th>\n<th>API è·¯ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/todos</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/todos/:id</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/todos</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/todos/:id</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/todos/:id</td>\n</tr>\n</tbody>\n</table></div>\n<p>æœ€åæˆ‘ä»¬é€šè¿‡Â <code>export default router;</code>Â è¯­å¥æ¥å°†é…ç½®å¥½çš„è·¯ç”±å¯¼å‡ºã€‚</p>\n<p>æ­¤æ—¶æˆ‘ä»¬å·²ç»å®Œæˆäº†åˆ›å»ºè·¯ç”±çš„å·¥ä½œï¼ˆä½†æ˜¯ç”±äºæˆ‘ä»¬çš„æ§åˆ¶å™¨è¿˜æ˜¯ç©ºçš„å‡½æ•°ï¼Œæ‰€ä»¥æ¯ä¸ªè·¯ç”±å¹¶éƒ½ä¸ä¼šåšä»»ä½•ååº”ï¼Œæˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ åŠŸèƒ½ï¼‰ã€‚</p>\n<p>åœ¨æˆ‘ä»¬å¼€å§‹å‘æ¯ä¸ªæ§åˆ¶å™¨æ·»åŠ åŠŸèƒ½ä¹‹å‰çš„æœ€åä¸€ä¸ªéš¾é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤ <code>router</code> æŒ‚è½½åˆ°æˆ‘ä»¬çš„Â <code>app</code> å®ä¾‹ä¸Šã€‚</p>\n<p>å› æ­¤å›åˆ° <code>server.ts</code>Â æ–‡ä»¶ä¸­æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<ul>\n<li>å°†è¿™è¡Œä»£ç æ·»åŠ è‡³æ–‡ä»¶é¡¶éƒ¨ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// routes è·¯ç”±</span>\n<span class="token keyword">import</span> todoRouter <span class="token keyword">from</span> <span class="token string">"./routes/todo.ts"</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>åˆ é™¤è¿™ä¸€æ®µä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nrouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>å°†å…¶æ›¿æ¢ä¸ºï¼š</li>\n</ul>\n<pre class="language-autoit"><code class="language-autoit">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>ç»ˆäºæå®šäº†ï¼Œä½ çš„ <code>server.ts</code> ç°åœ¨åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> green<span class="token punctuation">,</span> yellow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token comment">// routes</span>\n<span class="token keyword">import</span> todoRouter <span class="token keyword">from</span> <span class="token string">"./routes/todo.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> secure<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> protocol <span class="token operator">=</span> secure <span class="token operator">?</span> <span class="token string">"https://"</span> <span class="token operator">:</span> <span class="token string">"http://"</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname <span class="token operator">??</span> <span class="token string">"localhost"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>\n    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">"Listening on:"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®æœ¬æ•™ç¨‹çš„æºç ä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">@adeelibr/deno-playground</a>ã€‚</p>\n<p>ç”±äºè·¯ç”±çš„æ§åˆ¶å™¨ä¸Šæš‚æ—¶æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œç°åœ¨ä¸€èµ·æ¥æ‰‹åŠ¨ä¸ºæˆ‘ä»¬çš„æ§åˆ¶å™¨æ·»åŠ åŠŸèƒ½ã€‚</p>\n<p>åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¾—å…ˆåˆ›å»ºä¸¤ä¸ªï¼ˆå°ï¼‰æ–‡ä»¶ï¼š</p>\n<ul>\n<li>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸Šåˆ›å»ºä¸€ä¸ª <code>interfaces</code>Â æ–‡ä»¶å¤¹å¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª <code>Todo.ts</code>ï¼ˆç¡®ä¿ Todo é¦–å­—æ¯å¤§å†™ï¼Œå› ä¸ºå¦‚æœä¸è¿™æ ·åšï¼Œå®ƒå°†ä¸ä¼šåœ¨æ­¤å¤„ç»™å‡ºä»»ä½•è¯­æ³•é”™è¯¯â€”â€”è¿™åªæ˜¯ä¸€ç§çº¦å®šï¼‰ã€‚</li>\n<li>åŒæ—¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>stubs</code>Â æ–‡ä»¶å¤¹å¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªÂ <code>todos.ts</code>Â æ–‡ä»¶ã€‚</li>\n</ul>\n<p>åœ¨ <code>interfaces/Todo.ts</code>Â æ–‡ä»¶ä¸­ç¼–å†™å¦‚ä¸‹æ¥å£è¯´æ˜ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> interface Todo {\n  id<span class="token punctuation">:</span> string<span class="token punctuation">,</span>\n  todo<span class="token punctuation">:</span> string<span class="token punctuation">,</span>\n  isCompleted<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>\n}\n</code></pre>\n<p>ä»€ä¹ˆæ˜¯ interfaceï¼ˆæ¥å£ï¼‰ï¼Ÿ</p>\n<p>è¦çŸ¥é“ TypeScript çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯æ£€æŸ¥ä¸€ä¸ªå˜é‡çš„ç±»å‹ã€‚å°±åƒå‰æ–‡çš„ <code>const port: number = 8080</code>Â å’ŒÂ <code>{ response }: { response : any }</code>Â ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æµ‹ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºå¯¹è±¡ç±»å‹ã€‚</p>\n<p>åœ¨ TypeScript ä¸­ï¼Œinterface è´Ÿè´£å‘½åç±»å‹ï¼Œå¹¶ä¸”æ˜¯<strong>å®šä¹‰ä»£ç å†…å¤–ç±»å‹çº¦æŸ</strong>çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>\n<p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰å…³ interface çš„ç¤ºä¾‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å†™äº†ä¸ªæ¥å£</span>\n<span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">{</span>\n  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// æ­¤å‡½æ•°çš„labeledObj å‚æ•°æ˜¯ç¬¦åˆ LabeledValue æ¥å£ç±»å‹çš„</span>\n<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token function">printLabel</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¸Œæœ›å¦‚ä¸Šç¤ºä¾‹å¯ä»¥è®©ä½ å¯¹ interface æœ‰æ›´å¤šçš„äº†è§£ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://www.typescriptlang.org/docs/handbook/interfaces.html">Interfaces å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>\n<p>ç°åœ¨å…³äº interface çš„çŸ¥è¯†å·²ç»ä»‹ç»å¤Ÿäº†ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ¨¡æ‹Ÿä¸€äº›å‡æ•°æ®ï¼ˆå› ä¸ºæœ¬æ–‡ä¸æ¶‰åŠæœ‰å…³æ•°æ®åº“çš„æ“ä½œï¼‰ã€‚</p>\n<p>æˆ‘ä»¬åœ¨ <code>stubs/todos.ts</code> æ–‡ä»¶ä¸­æ¥ä¸º todos å˜é‡å¡«å……ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ã€‚è¿™æ ·å³å¯ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interface</span>\n<span class="token class-name"><span class="token keyword">import</span></span> Todo <span class="token keyword">from</span> <span class="token string">\'../interfaces/Todo.ts\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> todos<span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    todo<span class="token operator">:</span> <span class="token string">\'walk dog\'</span><span class="token punctuation">,</span>\n    isCompleted<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span>\n    id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    todo<span class="token operator">:</span> <span class="token string">\'eat food\'</span><span class="token punctuation">,</span>\n    isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> todos<span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æœ‰ä¸¤ä»¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼šæˆ‘ä»¬è¿™é‡Œå¼•ç”¨äº†ä¸€ä¸ªæ–°çš„æ¨¡å—å¹¶ä¸”é€šè¿‡ <code>import { v4 } from &quot;https://deno.land/std/uuid/mod.ts&quot;;</code>Â è¯­å¥è§£æ„äº†å…¶ä¸­çš„ <code>v4</code>Â å˜é‡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨ <code>v4.generate()</code>Â è¯­å¥éƒ½èƒ½ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ID å­—ç¬¦ä¸²ã€‚è¿™ä¸ª <code>id</code>Â ä¸èƒ½æ˜¯Â <code>number</code> ç±»å‹çš„ï¼Œè€Œéœ€æ˜¯Â <code>string</code>Â ç±»å‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„ <code>Todo</code> æ¥å£å·²ç»å£°æ˜äº†Â <code>id</code>Â çš„ç±»å‹å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚</li>\n<li>å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ <code>let todos: Todo[] = []</code>Â è¯­å¥ã€‚æ­¤è¯­å¥å‘Šè¯‰ Deno æˆ‘ä»¬çš„ todos å˜é‡æ˜¯ä¸€ä¸ªÂ <code>Todo</code> æ•°ç»„ï¼ˆæ­¤æ—¶ç¼–è¯‘å™¨å°†ä¼šçŸ¥é“æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯Â <code>{id: _string_, todo: _string_ &amp; isCompleted: _boolean_}</code> ç±»å‹çš„ï¼Œå¹¶ä¸å…è®¸å…¶ä»–ä»»ä½•ç±»å‹ï¼‰ã€‚</li>\n</ul>\n<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://www.typescriptlang.org/docs/handbook/interfaces.html">Interfaces å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>\n<p>å¤ªæ£’äº†ï¼Œä½ å·²ç»è¿›è¡Œåˆ°å¦‚æ­¤ä¹‹è¿œï¼Œå†æ¥å†å‰ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-08.jpg" alt=""></p>\n<p>å·¨çŸ³å¼ºæ£®æ„Ÿæ¿€ä½ æ‰€åšçš„ä¸€åˆ‡åŠªåŠ›ã€‚</p>\n<h2 id="%E8%AE%A9%E6%88%91%E4%BB%AC%E5%85%B3%E6%B3%A8%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A">è®©æˆ‘ä»¬å…³æ³¨åœ¨æ§åˆ¶å™¨ä¸Š<a class="anchor" href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%85%B3%E6%B3%A8%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A">Â§</a></h2>\n<p>åœ¨ä½ çš„Â <code>controllers/todo.ts</code>Â æ–‡ä»¶ä¸­ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬å…ˆç¼–å†™Â <code>getAllTodos</code>Â æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> è·å–æ‰€æœ‰ todos\n   * <span class="token keyword">@route</span> GET /todos\n   */</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åœ¨å¼€å§‹ä»‹ç»è¿™æ®µä»£ç å‰ï¼Œè®©æˆ‘è§£é‡Šä¸‹æ¯ä¸ªæ§åˆ¶å™¨éƒ½æœ‰çš„å‚æ•°â€”â€”<code>context</code>ï¼ˆä¸Šä¸‹æ–‡ï¼‰å‚æ•°ã€‚</p>\n<p>å› æ­¤æˆ‘ä»¬æ‰èƒ½è§£æ„ <code>getAllTodos: (context) =&gt; {}</code>Â ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre>\n<p>å¹¶ä¸”è‡ªä»å“ªä¸ªæˆ‘ä»¬ä½¿ç”¨Â <code>typescript</code>Â åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè¿™æ ·çš„å˜é‡æ·»åŠ ç±»å‹å£°æ˜ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n  <span class="token punctuation">{</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> params <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> \n    request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> \n    response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> \n    params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre>\n<p>æ­¤æ—¶æˆ‘ä»¬ä¸ºè§£æ„çš„ä¸‰ä¸ªå˜é‡Â <code>{ request, response, params }</code>Â æ·»åŠ äº†ç±»å‹è¯´æ˜ã€‚</p>\n<ul>\n<li><code>request</code>Â å˜é‡æœ‰å…³ç”¨æˆ·å‘æ¥çš„è¯·æ±‚ï¼ˆæ¯”å¦‚è¯·æ±‚å¤´å’Œ JSON ç±»çš„è¯·æ±‚ä½“ï¼‰ã€‚</li>\n<li><code>response</code>Â å˜é‡æœ‰å…³æœåŠ¡å™¨ç«¯é€šè¿‡ API è¿”å›çš„ä¿¡æ¯ã€‚</li>\n<li><code>params</code>Â å˜é‡æ˜¯æˆ‘ä»¬åœ¨è·¯ç”±é…ç½®ä¸­å®šä¹‰çš„å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p><code>/todos/:id</code>Â ä¸­çš„Â <code>:id</code>Â æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥ä» URL ä¸­è·å¾—åŠ¨æ€çš„æ•°æ®ã€‚å› æ­¤å½“ç”¨æˆ·è®¿é—®è¿™ä¸ª API ï¼ˆæ¯”å¦‚ <code>/todos/756</code>ï¼‰çš„æ—¶å€™ï¼Œ<strong>756</strong> åˆ™æ˜¯ <strong>:id</strong> å‚æ•°çš„å€¼ã€‚å¹¶ä¸”æˆ‘ä»¬çŸ¥é“ URL é‡Œçš„è¿™ä¸ªå€¼çš„ç±»å‹æ˜¯Â <code>string</code>Â ç±»çš„ã€‚</p>\n<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†åŸºæœ¬çš„å£°æ˜åï¼Œè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ todos æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> è·å–æ‰€æœ‰ todos\n   * <span class="token keyword">@route</span> GET /todos\n   */</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¯¹äº <code>getAllTodos</code>Â æ–¹æ³•æ¥è¯´æˆ‘ä»¬åªéœ€è¦ç®€å•çš„è¿”å›ç»“æœã€‚å¦‚æœä½ è®°å¾—ä¹‹å‰è¯´çš„ï¼Œä¼šæƒ³èµ·æ¥Â <code>response</code>Â æ˜¯ç”¨æ¥å¤„ç†æœåŠ¡å™¨æƒ³è¦ç»™ç”¨æˆ·è¿”å›çš„æ•°æ®ã€‚</p>\n<p>å¯¹äºç¼–å†™è¿‡ Node å’Œ Express çš„äººæ¥è¯´ï¼Œè¿™é‡Œçš„ä¸€å¤§ä¸åŒæ˜¯æˆ‘ä»¬ä¸éœ€è¦ <code>return</code>Â å“åº”å¯¹è±¡ã€‚ Deno ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ‰§è¡Œæ­¤æ“ä½œã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€šè¿‡ <code>response.status</code> æ¥è®¾ç½®æ­¤æ¬¡è¯·æ±‚çš„å“åº”ç æ˜¯ <code>200</code>ã€‚</p>\n<p>æ›´å¤š HTTP å“åº”ç å¯ä»¥çœ‹ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">MDN ä¸Šçš„Â HTTP å“åº”çŠ¶æ€ç æ–‡æ¡£</a>ã€‚</p>\n<p>å¦ä¸€ä»¶äº‹æ˜¯è®¾ç½® <code>response.body</code>Â çš„å€¼ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> todos\n<span class="token punctuation">}</span>\n</code></pre>\n<p>é‡æ–°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<blockquote>\n<p>ä¿®è®¢ï¼š--allow-net å±æ€§å‘Šè¯‰ Denoï¼Œæ­¤åº”ç”¨ç¨‹åºæˆäºˆç”¨æˆ·é€šè¿‡æ‰“å¼€çš„ç«¯å£è®¿é—®ç½‘ç»œçš„æƒé™ã€‚</p>\n</blockquote>\n<p>ä¸€æ—¦ä½ çš„æœåŠ¡ç«¯ç¤ºä¾‹è·‘é€šï¼ŒæŒºå¯ä»¥é€šè¿‡ <code>GET /todos</code>Â æ–¹å¼æ¥è¯·æ±‚è¿™ä¸ª APIã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ Google Chrome æµè§ˆå™¨ä¸‹çš„ä¸€ä¸ªæ’ä»¶ <code>postman</code>ï¼Œ<a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop//%40">åœ¨è¿™é‡Œä¸‹è½½</a>ã€‚</p>\n<p>ä½ å¯ä»¥ä½¿ç”¨ä»»æ„çš„ REST é£æ ¼çš„å®¢æˆ·ç«¯ï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨ <code>postman</code> æ˜¯å› ä¸ºå®ƒçœŸçš„å¾ˆç®€å•å¥½ç”¨ã€‚</p>\n<p>åœ¨ Postman ä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µã€‚è®¾ç½®è¯·æ±‚æ–¹å¼ä¸ºÂ <code>GET</code>Â è¯·æ±‚å¹¶ä¸”åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â ã€‚ç‚¹å‡» <code>Send</code> æŒ‰é’®ä¾¿ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-09.jpg" alt=""></p>\n<p>GET /todos API è¿”å›ç»“æœã€‚</p>\n<p>é…·ï¼ä¸€ä¸ª API æå®šäº†ï¼Œè¿˜å‰© 4 ä¸ªç­‰ç€æˆ‘ä»¬Â ğŸ‘ğŸ‘ã€‚</p>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œå¯ä»¥åœ¨<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">é…å¥—çš„æºç ä»“åº“</a>ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚</p>\n<p>è®©æˆ‘ä»¬å…³æ³¨ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨å§ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> Add a new todo\n   * <span class="token keyword">@route</span> POST /todos\n   */</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>hasBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No data provided"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœè¯·æ±‚ä½“éªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›æ–°å¢åçš„æ‰€æœ‰ todos</span>\n    <span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n      id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n      isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç”±äºæˆ‘ä»¬å°†è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ Todo åˆ°åˆ—è¡¨ä¸­ï¼Œå› æ­¤æˆ‘åœ¨ controller æ–‡ä»¶ä¸­å¯¼å…¥äº† 2 ä¸ªé€šç”¨æ¨¡å—ï¼š</p>\n<ul>\n<li><code>import { v4 } from &quot;https://deno.land/std/uuid/mod.ts&quot;</code>Â è¯­å¥ç”¨æ¥ä¸ºæ¯ä¸€ä¸ª todo å…ƒç´ åˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ã€‚</li>\n<li><code>import Todo from &quot;../interfaces/Todo.ts&quot;;</code> è¯­å¥ç”¨æ¥ä¿è¯æ–°å»ºçš„ todo éµå¾ª todo å…ƒç´ çš„æ¥å£æ ¼å¼æ ‡å‡†ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬çš„ <code>createTodo</code>Â æ§åˆ¶å™¨æ˜¯ <code>async</code> å¼‚æ­¥çš„ä»£è¡¨å‡½æ•°ä¸­ä¼šä½¿ç”¨åˆ°ä¸€äº› Promise æŠ€æœ¯ã€‚</p>\n<p>è®©æˆ‘ä»¬æ¥æˆªæ–­è¯´æ˜å…¶ä¸­çš„å°ç‰‡æ®µï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>hasBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No data provided"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>é¦–å…ˆæˆ‘ä»¬è¯»å–è¯·æ±‚ä½“ä¸­ç”¨æˆ·ä¼ æ¥çš„çš„ JSON å†…å®¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>oak</code>Â çš„å†…ç½® <code>request.hasBody</code>Â æ–¹æ³•æ¥æ£€æŸ¥ç”¨æˆ·ä¼ æ¥çš„å†…å®¹æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œæˆ‘ä»¬å°†è¿›å…¥Â <code>if (!request.hasBody) {}</code>Â ä»£ç å—ä¸­æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>\n<p>é‡Œé¢æˆ‘ä»¬å°†å“åº”ä½“çš„çŠ¶æ€ç è®¾ç½®æˆ <code>400</code>ï¼ˆ400 ä»£è¡¨ç€ç”¨æˆ·ç«¯å‡ºç°äº†ä¸€äº›æœ¬ä¸è¯¥å‡ºç°çš„é”™è¯¯ï¼‰ï¼Œå¹¶ä¸”æœåŠ¡ç«¯è¿”å›çš„å“åº”ä½“ä¸º <code>{success: false, message: &quot;no data provided }</code>ã€‚ä¹‹åç¨‹åºç›´æ¥æ‰§è¡ŒÂ <code>return;</code>Â è¯­å¥æ¥ä¿è¯æ¥ä¸‹æ¥çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœè¯·æ±‚ä½“éªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›æ–°å¢åçš„æ‰€æœ‰ todos</span>\n<span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n  id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n  isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„ todo å…ƒç´ ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n  id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n  isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>let newTodo: Todo = {}</code> ä¿è¯Â <code>newTodo</code>Â å˜é‡çš„å€¼å’Œå…¶å®ƒ todo å…ƒç´ ä¸€æ ·éƒ½éµå¾ªç›¸åŒçš„æ¥å£æ ¼å¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>v4.generate()</code>Â åˆ†é…ä¸€ä¸ªéšæœº IDï¼Œå°† todo çš„é”®å€¼è®¾ç½®ä¸º <code>body.value.todo</code>Â å¹¶å°† <code>isCompleted</code>Â å˜é‡å€¼è®¾ç½®ä¸ºÂ <code>false</code>ã€‚</p>\n<p>è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œç”¨æˆ·ç»™æˆ‘ä»¬å‘çš„å†…å®¹æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>oak</code>Â ä¸­çš„Â <code>body.value</code>Â æ¥è·å–ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™é‡Œå°† <code>newTodo</code>Â æ·»åŠ åˆ°æ•´ä¸ª todo åˆ—è¡¨ä¸­ä¸­ï¼Œå¹¶åœ¨å“åº”ä½“ä¸­è¿”å›Â <code>{success: true &amp; data: data</code>ã€‚</p>\n<p>æ­¤æ—¶è¿™ä¸ªæ§åˆ¶å™¨ä¹Ÿè¿è¡ŒæˆåŠŸäº†Â âœ…ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡æ–°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ postman ä¸­ï¼Œæˆ‘å†æ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µã€‚è®¾ç½®è¯·æ±‚çš„æ–¹å¼ä¸º <code>POST</code>Â ç±»å‹ï¼Œå¹¶åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â åï¼Œç‚¹å‡» <code>Send</code>Â ä¾¿ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-10.jpg" alt=""></p>\n<p>å› ä¸ºä¸Šé¢çš„è¯·æ±‚ä½“ä¸­å‘é€äº†ç©ºçš„å†…å®¹ï¼Œæ‰€ä»¥å¾—åˆ°äº† 400 é”™è¯¯å“åº”ç åŠå…¶é”™è¯¯åŸå› ã€‚</p>\n<p>ä½†å¦‚æœæˆ‘ä»¬ç»™è¯·æ±‚ä½“ä¸­åŠ å…¥å¦‚ä¸‹ JSON å†…å®¹ï¼Œå¹¶é‡æ–°å‘é€ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-11.jpg" alt=""></p>\n<p>é€šè¿‡ { todo: &quot;eat a lamma&quot; } æ¥Â POST /todosÂ åçš„æˆåŠŸç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°çš„å…ƒç´ å·²ç»åŠ å…¥åˆ°åˆ—è¡¨ä¸­ã€‚</p>\n<p>é…·ï¼Œæˆ‘ä¹°å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ API å·²ç»ä¸€ä¸ªä¸ªä»¥é¢„æœŸçš„æ–¹å¼æ‰§è¡ŒæˆåŠŸäº†ã€‚</p>\n<p>ä¸¤ä¸ª API æå®šï¼Œè¿˜å‰©ä¸‰ä¸ªè¦åšã€‚</p>\n<p>æˆ‘ä»¬å¿«è¦æå®šäº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†éš¾çš„å†…å®¹å·²ç»ä»‹ç»å®Œæ¯•ã€‚â˜ºï¸ ğŸ™‚ğŸ¤—ğŸ¤©</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸‰ä¸ª APIï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> é€šè¿‡ ID è·å– todo\n   * <span class="token keyword">@route</span> GET todos/:id\n   */</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœ todo æ‰¾åˆ°äº†</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todo<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬å…ˆæ¥èŠèŠÂ <code>GET todos/:id</code>Â ä¸‹çš„æ§åˆ¶å™¨ï¼Œæ­¤æ§åˆ¶å™¨ä¼šé€šè¿‡ ID æ¥æŸ¥æ‰¾ç›¸åº”çš„ todo å…ƒç´ ã€‚</p>\n<p>è®©æˆ‘ä»¬ç»§ç»­é€šè¿‡æˆªå–å°ç‰‡æ®µæ¥æ·±å…¥åˆ†æï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>åœ¨ç¬¬ä¸€è¡Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code>const todo</code> å˜é‡å¹¶å°†å…¶ç±»å‹è®¾ç½®ä¸ºÂ <code>Todo</code>Â æˆ–Â <code>undefined</code>Â ç±»ã€‚å› æ­¤ <code>todo</code> å…ƒç´ åªèƒ½æ˜¯ç¬¦åˆ <code>Todo</code>Â æ¥å£è§„èŒƒçš„å˜é‡æˆ–è€…æ˜¯ä¸€ä¸ª <code>undefined</code>Â å€¼ï¼Œè€Œä¸èƒ½æ˜¯å…¶å®ƒä»»ä½•ç±»å‹ã€‚</p>\n<p>æˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨ <code>todos.find((t) =&gt; t.id === params.id);</code>Â è¯­å¥æ¥é€šè¿‡Â <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find">Array.find()</a>Â æ–¹æ³•å’ŒÂ <code>params.id</code>Â çš„å€¼æ¥æŸ¥æ‰¾æŒ‡å®šçš„ <code>todo</code>Â å…ƒç´ ã€‚å¦‚æœæ‰¾åˆ°äº†æˆ‘ä»¬ä¼šå¾—åˆ°Â <code>Todo</code>Â ç±»å‹çš„ <code>todo</code>Â å…ƒç´ ï¼Œå‘å¦åˆ™å¾—åˆ°ä¸€ä¸ªÂ <code>undefined</code>Â å€¼ã€‚</p>\n<p>å¦‚æœå¾—åˆ°çš„ <code>todo</code>Â çš„å€¼æ˜¯ undefined çš„ï¼Œæ„å‘³ç€å¦‚ä¸‹ if æ¡ä»¶ä¸­çš„ä»£ç ä¼šæ‰§è¡Œï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®å“åº”çš„çŠ¶æ€ç ä¸º <code>404</code>ï¼Œä»£è¡¨ç€ <code>not found</code>Â æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å…ƒç´ ï¼Œå¹¶ä¸”è¿”å›ä½“çš„æ ¼å¼ä¹Ÿæ˜¯æ ‡å‡†çš„Â <code>{ status, message }</code>ã€‚</p>\n<p>å¾ˆé…·ä¸æ˜¯å˜›ï¼Ÿ ğŸ˜„</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•åœ°ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœ todo æ‰¾åˆ°äº†</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> todo<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®¾ç½®ä¸€ä¸ªå“åº”çŠ¶æ€ç ä¸º <code>200</code>Â çš„å“åº”ä½“å¹¶è¿”å›Â <code>success: true &amp; data: todo</code>Â å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬æ¥åœ¨ postman ä¸­æµ‹è¯•ï¼š</p>\n<p>å…ˆä¸€èµ·é‡æ–°å¯åŠ¨æœåŠ¡ç«¯ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ postman ä¸­ï¼Œç»§ç»­æ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œè®¾ç½®è¯·æ±‚æ–¹å¼ä¸ºÂ <code>GET</code>Â è¯·æ±‚å¹¶åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code>Â åï¼Œç‚¹å‡» <code>Send</code>Â æ¥æ‰§è¡Œè¯·æ±‚ã€‚</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚æ¯æ¬¡ä½ é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p>æˆ‘ä»¬è¿™æ ·è¾“å…¥ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-12.jpg" alt=""></p>\n<p>æœåŠ¡ç«¯è¿”å› 404ï¼Œä¸”å‘Šè¯‰æˆ‘ä»¬æ²¡æœ‰ç›¸å…³æ•°æ®è¢«æ‰¾åˆ°ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-13.jpg" alt=""></p>\n<p>ä½†å¦‚æœè¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„ IDï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›å…¶ ID å’Œè¿™ä¸ª ID çš„ä¸€æ ·çš„æ•°æ®å¹¶ä¸”å“åº”çŠ¶æ€ä¸º 200ã€‚</p>\n<p>å¦‚æœä½ éœ€è¦å‚è€ƒæœ¬æ–‡çš„æºç å¯ä»¥è®¿é—®è¿™é‡Œï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<p>ä¸é”™ï¼Œ3 ä¸ª API æå®šï¼Œåªå‰© 2 ä¸ªäº†ã€‚</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> Update todo by id\n   * <span class="token keyword">@route</span> PUT todos/:id\n   */</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>\n      response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åº” todo åˆ™æ›´æ–°å®ƒ</span>\n    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> newTodos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬æ¥æ¢è®¨ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨Â <code>PUT todos/:id</code>ã€‚è¿™ä¸ªæ§åˆ¶å™¨ä¼šæ›´æ–°ä¸€ä¸ªå…ƒç´ çš„å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬ç»§ç»­æˆªæ–­ä»£ç æ¥ç»†çœ‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™é‡Œåšçš„å’Œä¹‹å‰æ§åˆ¶å™¨åšçš„ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘å°±ä¸æ·±å…¥ä»‹ç»äº†ã€‚</p>\n<p>é«˜çº§æç¤ºï¼šå¦‚æœä½ æƒ³å°†è¿™æ®µä»£ç è®¾ä¸ºé€šç”¨ä»£ç å—ï¼Œç„¶ååœ¨ä¸¤ä¸ªæ§åˆ¶å™¨ä¸­éƒ½ä½¿ç”¨å®ƒï¼Œå®Œå…¨å¯ä»¥ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åº” todo åˆ™æ›´æ–°å®ƒ</span>\n<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n<span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> newTodos<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­æˆ‘æƒ³åœ¨è¿™é‡Œé‡ç‚¹è®¨è®ºçš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n<span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰§è¡Œ <code>const updatedData = body.value</code>ï¼Œç„¶åå°†ç±»å‹æ£€æŸ¥æ·»åŠ åˆ° <code>updatedData</code> ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™ä¸€å°æ®µä»£ç å‘Šè¯‰ TSï¼š<code>updatedData</code>Â å˜é‡æ˜¯ä¸€ä¸ªæœ‰å¯èƒ½åŒ…å«ä¹Ÿæœ‰å¯èƒ½ä¸åŒ…å« todoã€isComplete ç†Ÿæ‚‰çš„å¯¹è±¡ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬éå†æ¯ä¸€ä¸ª todo å…ƒç´ ï¼Œå°±åƒè¿™æ ·ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­å½“Â <code>params.id</code>Â å’ŒÂ <code>t.id</code>Â çš„å€¼ä¸€è‡´æ—¶ï¼Œæˆ‘ä»¬å°†æ­¤æ—¶çš„å¯¹è±¡çš„å†…å®¹é‡æ–°è¦†ç›–ä¸ºç”¨æˆ·ä¼ æ¥çš„æƒ³è¦æ›´æ”¹ä¸ºçš„å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬ä¹Ÿç¼–å†™æˆåŠŸäº†è¿™ä¸ª APIã€‚</p>\n<p>è®©æˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸ºÂ <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥Â <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚</p>\n<p>æ¯æ¬¡é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-14.jpg" alt=""></p>\n<p>å¦‚ä¸Šè¿”å›äº† 404 çŠ¶æ€ç å¹¶æç¤ºæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ todo å…ƒç´ ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-15.jpg" alt=""></p>\n<p>æä¾›ä¸€ä¸ªå·²çŸ¥çš„ IDï¼Œå¹¶ä¸”è¯·æ±‚ä½“ä¸­å¡«å†™éœ€è¦æ”¹å˜çš„å†…å®¹ã€‚æœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªæ›´æ”¹åçš„å…ƒç´ åŠå…¶å®ƒæ‰€æœ‰å…ƒç´ ã€‚</p>\n<p>é…·ï¼Œå››ä¸ª API æå®šæˆ‘ä»¬åªå‰©æœ€åä¸€ä¸ªéœ€è¦åšã€‚</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> é€šè¿‡ ID åˆ é™¤æŒ‡å®š todo\n   * <span class="token keyword">@route</span> DELETE todos/:id\n   */</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> allTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// remove the todo w.r.t id and return</span>\n    <span class="token comment">// remaining todos</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> allTodos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬æœ€åæ¥è®¨è®ºä¸‹ <code>Delete todos/:id</code> æ§åˆ¶å™¨çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ­¤æ§åˆ¶å™¨ä¼šé€šè¿‡ç»™å®šçš„ ID æ¥åˆ é™¤ç›¸åº” todo å…ƒç´ ã€‚</p>\n<p>æˆ‘ä»¬è¿™é‡Œåªéœ€ç®€å•åœ°åŠ ä¸€æ¡è¿‡æ»¤æ–¹æ³•ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> allTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> t<span class="token punctuation">.</span>id !<span class="token operator">==</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>éå†æ‰€æœ‰å…ƒç´ å¹¶åˆ é™¤Â <code>todo.id</code> å’ŒÂ <code>params.id</code>Â å€¼ä¸€æ ·çš„å…ƒç´ ï¼Œå¹¶è¿”å›å…¶ä½™æ‰€æœ‰å…ƒç´ ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// åˆ é™¤è¿™ä¸ª todo å¹¶è¿”å›å…¶å®ƒæ‰€æœ‰å†…å®¹</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> allTodos<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åªéœ€è¿”å›æ‰€æœ‰æ²¡æœ‰ç›¸åŒ <a href="http://todo.id">todo.id</a> çš„å¾…åŠäº‹é¡¹æ¸…å•å³å¯ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚æ¯æ¬¡ä½ é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p>æ¯æ¬¡é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-16.jpg" alt=""></p>\n<p>æˆ‘ä»¬ç»ˆäºæå®šäº†æ‰€æœ‰ 5 ä¸ª APIã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-17.jpg" alt=""></p>\n<p>ç°åœ¨æˆ‘ä»¬åªå‰©ä¸‹ä¸¤ä»¶äº‹äº†ï¼š</p>\n<ul>\n<li>å¢åŠ ä¸€ä¸ª 404 ä¸­é—´ä»¶ï¼Œæ¥è®©ç”¨æˆ·è®¿é—®ä¸å­˜åœ¨çš„è·¯ç”±æ—¶å¾—åˆ°è¯¥æœ‰çš„æç¤ºï¼›</li>\n<li>å¢åŠ ä¸€ä¸ªæ—¥å¿— API æ¥æ‰“å°æ‰€æœ‰è¯·æ±‚çš„æ‰§è¡Œæ—¶é—´ã€‚</li>\n</ul>\n<h2 id="%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-404-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6">åˆ›å»ºä¸€ä¸ª 404 è·¯ç”±ä¸­é—´ä»¶<a class="anchor" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-404-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6">Â§</a></h2>\n<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºÂ <code>middlewares</code>Â çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>notFound.ts</code> çš„æ–‡ä»¶åï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"404 - Not found."</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚ä¸Šä»£ç å¹¶æ²¡æœ‰å¼•å…¥ä»€ä¹ˆæ–°çš„çŸ¥è¯†ç‚¹â€”â€”å®ƒå¯¹äºæˆ‘ä»¬çš„æ§åˆ¶å™¨ç»“æ„æ¥ä½¿ç”¨äº†è¯´å¾ˆç†Ÿæ‚‰çš„é£æ ¼ã€‚è¿™é‡Œä»…ä»…è¿”å›äº†Â <code>404</code>Â çŠ¶æ€ç ï¼ˆä»£è¡¨ç€ç›¸å…³è·¯ç”±æ²¡æœ‰æ‰¾åˆ°ï¼‰å¹¶ä¸”è¿”å›äº†ä¸€æ®µ JSON å†…å®¹ï¼šÂ <code>{ success, message }</code>ã€‚</p>\n<p>æ¥ä¸‹æ¥åœ¨ä½ çš„Â <code>server.ts</code>Â æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<ul>\n<li>åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ç›¸å…³å¯¼å…¥è¯­å¥ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// æ²¡æœ‰æ‰¾åˆ°</span>\n<span class="token keyword">import</span> notFound <span class="token keyword">from</span> <span class="token string">\'./middlewares/notFound.ts\'</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æ¥ä¸‹æ¥åœ¨ <code>app.use(todoRouter.allowedMethods())</code>Â ä¸‹é¢å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 404 page</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>notFound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ‰§è¡Œé¡ºåºåœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šæ¯å½“æˆ‘ä»¬å°è¯•è®¿é—® API è·¯ç”±æ—¶ï¼Œå®ƒéƒ½ä¼šé¦–å…ˆåŒ¹é…/æ£€æŸ¥æ¥è‡ª <code>todoRouter</code>Â çš„è·¯ç”±ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå®ƒå°†æ‰§è¡Œ <code>app.use(notFound);</code>Â è¯­å¥ã€‚</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿è¡Œã€‚</p>\n<p>é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-18.jpg" alt=""></p>\n<p>å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œå°† <code>app.use(notFound);</code>Â æ”¾åœ¨Â <code>server.ts</code>Â æ–‡ä»¶ä¸­å…¶å®ƒè·¯ç”±çš„åé¢ã€‚å¦‚æœè¯·æ±‚è·¯ç”±ä¸å­˜åœ¨ï¼Œå®ƒå°†æ‰§è¡Œå¹¶è¿”å› <code>404</code>Â çŠ¶æ€ä»£ç ï¼ˆè¡¨ç¤ºæœªæ‰¾åˆ°ï¼‰ï¼Œå¹¶åƒå¾€å¸¸ä¸€æ ·ç®€å•åœ°è¿”å›ä¸€ä¸ªå“åº”æ¶ˆæ¯ï¼Œå³ <code>{success, message}</code>ã€‚</p>\n<p><strong>é«˜çº§è´´å£«</strong>ï¼šæˆ‘ä»¬å·²ç»çº¦æŸ <code>{success, message}</code>Â æ˜¯åœ¨è¯·æ±‚å¤±è´¥æ—¶è¿”å›çš„æ ¼å¼ï¼Œ<code>{success, data}</code> æ˜¯åœ¨è¯·æ±‚æˆåŠŸæ—¶å€™è¿”å›ç»™ç”¨æˆ·çš„æ ¼å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸ºå¯¹è±¡æ¥å£ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œä»¥ç¡®ä¿æ¥å£çš„ä¸€è‡´æ€§å’Œè¿›è¡Œå®‰å…¨çš„ç±»å‹æ£€æŸ¥ã€‚</p>\n<p>é…·ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æå®šäº†å…¶ä¸­ä¸€ä¸ªä¸­é—´ä»¶â€”â€”è®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªä¸­é—´ä»¶æ¥åœ¨ç»ˆç«¯æ‰“å°æ—¥å¿—å§ã€‚</p>\n<p><strong>åˆ‡è®°</strong>ï¼šå¦‚æœä½ åœ¨æŸäº›åœ°æ–¹å¡ä½äº†ï¼Œå¯ä»¥çœ‹çœ‹æ–‡ç« çš„é…å¥—æºç ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<h2 id="%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6">ç»ˆç«¯ä¸­æ‰“å°æ—¥å¿—çš„ä¸­é—´ä»¶<a class="anchor" href="#%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6">Â§</a></h2>\n<p>åœ¨ä½ çš„ <code>middlewares</code> æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>logger.ts</code> æ–‡ä»¶å¹¶å¡«å……å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  green<span class="token punctuation">,</span>\n  cyan<span class="token punctuation">,</span>\n  white<span class="token punctuation">,</span>\n  bgRed<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">X_RESPONSE_TIME</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"X-Response-Time"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">responseTime</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åœ¨Â <code>server.ts</code>Â æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<ul>\n<li>æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  import è¯­å¥æ¥å¯¼å…¥æ¨¡å—ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// logger</span>\n<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">\'./middlewares/logger.ts\'</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>åœ¨ä¹‹å‰æåˆ°çš„Â <code>todoRouter</code>Â ä»£ç å‰è¿™æ ·å¢åŠ ä¸­é—´ä»¶ä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä»£ç çš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>\n<p>æˆ‘ä»¬å…ˆæ¥è®¨è®º <code>logger.ts</code>Â æ–‡ä»¶ï¼Œå…ˆæˆªæ–­çœ‹è¿™é‡Œï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  green<span class="token punctuation">,</span>\n  cyan<span class="token punctuation">,</span>\n  white<span class="token punctuation">,</span>\n  bgRed<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘åœ¨è¿™é‡Œå¯¼å…¥äº†æœ‰å…³ç»ˆç«¯é¢œè‰²çš„æ¨¡å—ï¼Œæƒ³è¦ç”¨åœ¨æˆ‘ä»¬çš„æ—¥å¿—ä¸­é—´ä»¶ä¸Šã€‚</p>\n<p>è¿™é‡Œå’Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„Â <code>server.ts</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>eventListener</code>Â çš„æ–¹å¼å¾ˆåƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨æœ‰é¢œè‰²çš„æ—¥å¿—ä¿¡æ¯æ¥è®°å½•æˆ‘ä»¬çš„ API è¯·æ±‚ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¾ç½®äº†Â <code>const X_RESPONSE_TIME: string = &quot;X-Response-Time&quot;;</code>ã€‚è¿™æ¡è¯­å¥ç”¨æ¥åœ¨ä¸ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ç»™å“åº”å¤´çš„ Header ä¸­æ³¨å…¥ <code>X_RESPONSE_TIME</code>Â å˜é‡çš„å€¼ï¼š<code>X-Response-Time</code>ã€‚æˆ‘ä¼šåœ¨åé¢è¿›è¡Œè¯´æ˜ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬åƒè¿™æ ·ä¸€æ ·å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  logger<span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  responseTime<span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ­¤æ—¶æˆ‘ä»¬åœ¨Â <code>server.ts</code>Â ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä¸¤è¡Œçš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸‹æ—¥å¿—ä¸­é—´ä»¶åˆ°åº•åšäº†ä»€ä¹ˆï¼Œå¹¶ä¸”é€šè¿‡Â <code>next()</code> æ¥è¯´æ˜å…¶æ‰§è¡Œè¿‡ç¨‹ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-19.jpg" alt=""></p>\n<p>ä¸Šå›¾ä¸ºè°ƒç”¨ GET / todos API æ—¶æ—¥å¿—è®°å½•ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºã€‚</p>\n<p>è¿™é‡Œå’Œä»¥å‰çš„æ§åˆ¶å™¨å”¯ä¸€çš„åŒºåˆ«æ˜¯ä½¿ç”¨äº† <code>next()</code>Â å‡½æ•°ï¼Œæ­¤å‡½æ•°æœ‰åŠ©äºæˆ‘ä»¬ä»ä¸€ä¸ªæ§åˆ¶å™¨è·³åˆ°å¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>\n<p>å› æ­¤æœ‰äº†è¿™æ®µï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">responseTime</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¯·ç•™æ„æˆ‘ä»¬åœ¨ <code>server.ts</code> ä¸­çš„ç¼–å†™æ–¹å¼ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä»£ç çš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™é‡Œçš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>logger.logger ä¸­é—´ä»¶</li>\n<li>logger.responseTime ä¸­é—´ä»¶</li>\n<li>todoRouter æ§åˆ¶å™¨ï¼ˆæ— è®ºç”¨æˆ·æƒ³è¦è®¿é—®ä»€ä¹ˆè·¯ç”±ï¼Œå‡ºäºè§£é‡Šçš„ç›®çš„ï¼Œè¿™é‡Œå‡è®¾ç”¨æˆ·éƒ½è°ƒç”¨ <code>GET /todos</code>Â æ¥è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹ï¼‰ã€‚</li>\n</ul>\n<p>å› æ­¤ä¼šå…ˆæ‰§è¡ŒÂ logger.logger çš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre>\n<p>å½“é‡åˆ°Â <code>await next()</code> æ—¶ä¼šç«‹å³è·³åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶â€”â€”<code>responseTime</code>Â ä¸Šã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-20.jpg" alt=""></p>\n<p>å†æ¬¡åˆ†äº«æ­¤å›¾æ¥å›é¡¾è¿™ä¸ªè¿‡ç¨‹ã€‚</p>\n<p>åœ¨Â <code>responseTime</code>Â ä¸­ï¼Œåªä¼šå…ˆæ‰§è¡Œå¦‚ä¸‹ä¸¤è¡Œï¼ˆå‚è€ƒä¸Šå›¾çš„æ‰§è¡Œè¿‡ç¨‹ 2ï¼‰ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç„¶åè·³è½¬åˆ°Â <code>getAllTodos</code>Â æ§åˆ¶å™¨ä¸­å¹¶æ‰§è¡Œ <code>getAllTodos</code>Â é‡Œçš„æ‰€æœ‰ä»£ç ã€‚</p>\n<p>åœ¨è¿™ä¸ªæ§åˆ¶å™¨ä¸­æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ <code>next()</code>ï¼Œå®ƒä¼šè‡ªåŠ¨è¿”å›åˆ° <code>responseTime</code>Â ä¸­é—´ä»¶ä¸­ï¼Œå¹¶æ‰§è¡Œæ¥ä¸‹æ¥çš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n</code></pre>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¾¿äº†è§£äº† 2ã€3ã€4 çš„æ‰§è¡Œé¡ºåºè¿‡ç¨‹ï¼ˆå‚è§ä¸Šå›¾ï¼‰ã€‚</p>\n<p>è¿™é‡Œæ˜¯å‘ç”Ÿçš„å…·ä½“è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ <code>const start = Date.now();</code>Â æ¥æ•è·ä»¥ <code>ms</code>Â ä¸ºå•ä½çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬ç«‹å³è°ƒç”¨ <code>next()</code> æ¥è·³è½¬åˆ° <code>getAllTodos</code>Â æ§åˆ¶å™¨å¹¶è¿è¡Œå…¶ä¸­çš„ä»£ç ã€‚ç„¶åå†æ¬¡è¿”å›åˆ° <code>responseTime</code>Â æ§åˆ¶å™¨ä¸­ã€‚</li>\n<li>ç„¶åï¼Œé€šè¿‡æ‰§è¡Œ <code>const ms: number = Date.now() - start;</code>Â æ¥å‡å»è¯·æ±‚åˆšæ¥çš„æ—¶é—´ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ¯«ç§’å·®çš„æ•°å­—ï¼Œå°†å‘Šè¯‰ Deno æ‰§è¡Œ getAllTodos æ§åˆ¶å™¨æ‰€èŠ±è´¹çš„æ‰€æœ‰æ—¶é—´ã€‚</li>\n</ul>\n<p>å†æ¬¡åˆ†äº«è¿™ä¸ªæ–‡ä»¶æ¥å›é¡¾è¿™ä¸ªè¿‡ç¨‹ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-21.jpg" alt=""></p>\n<ul>\n<li>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ <code>response</code>Â å“åº”å¤´çš„ Headers ä¸­è®¾ç½®ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript">response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n</code></pre>\n<p>å°† X-Response-Time çš„å€¼è®¾ç½®ä¸º Deno getAllTodos API æ‰€èŠ±è´¹çš„æ¯«ç§’æ•°ã€‚</p>\n<ul>\n<li>ç„¶åä»æ‰§è¡Œé¡ºåº 4 è¿”å›åˆ°æ‰§è¡Œé¡ºåº 5ï¼ˆå‚è€ƒä¸Šå›¾ï¼‰ã€‚</li>\n</ul>\n<p>åœ¨è¿™é‡Œç®€å•åœ°ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æ‰“å°æ—¥å¿—æ—¶æˆ‘ä»¬ä»Â <code>X-Response-Time</code>Â ä¸­è·å–åˆ°äº†æ‰§è¡Œ API è€—è´¹çš„æ—¶é—´ã€‚</li>\n<li>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å¸¦æœ‰é¢œè‰²çš„å­—ä½“å°†å…¶æ‰“å°åœ¨ç»ˆç«¯ã€‚</li>\n</ul>\n<p><code>request.method</code>Â è¿”å›ç”¨æˆ·è¯·æ±‚çš„æ–¹å¼ï¼Œæ¯”å¦‚Â <code>GET, PUT ç­‰</code>ï¼ŒåŒæ—¶Â <code>request.url.pathname</code>Â è¿”å›ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„ï¼Œæ¯”å¦‚Â <code>/todos</code>ã€‚</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿è¡Œã€‚</p>\n<p>é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>GET</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-22.jpg" alt=""></p>\n<p>åœ¨ Postman ä¸­å¤šè¯·æ±‚å‡ æ¬¡ APIï¼Œç„¶åè¿”å›åˆ°æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—æ—¶ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-23.jpg" alt=""></p>\n<p>æ¯ä¸ª API è¯·æ±‚éƒ½ä¼šè¢«æ—¥å¿—ä¸­é—´ä»¶è®°å½•åœ¨ç»ˆç«¯ã€‚</p>\n<p>å°±æ˜¯è¿™æ · â€”â€” æˆ‘ä»¬æå®šäº†è¿™ä¸€åˆ‡ã€‚</p>\n<p>å¦‚æœä½ åœ¨å“ªé‡Œå¡ä½äº†ï¼Œå¯ä»¥çœ‹çœ‹æœ¬æ–‡çš„å…¨éƒ¨æºç ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">github.com/adeelibr/deno-playground/tree/master/chapter_1:oak</a></p>\n<p>æˆ‘å¸Œæœ›ä½ è§‰å¾—æœ¬æ–‡ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œå¹¶ä¸”çœŸçš„èƒ½å¸®åŠ©ä½ å­¦åˆ°ä¸€äº›æ–°çš„çŸ¥è¯†ã€‚</p>\n<p>å¦‚æœä½ å–œæ¬¢ï¼Œæ¬¢è¿åˆ†äº«åˆ°ç¤¾äº¤å¹³å°ä¸Šã€‚å¦‚æœä½ æƒ³è¦æ·±å…¥äº¤æµï¼Œå¯ä»¥åœ¨Â <a href="https://twitter.com/adeelibr">Twitter</a>Â ä¸Šä¸æˆ‘è”ç³»ã€‚</p>'
        } }),
    'head': React.createElement(React.Fragment, null,
        React.createElement(Ga, { id: "UA-169223577-1" }),
        React.createElement("link", { href: "/favicon.png", rel: "icon", type: "image/png" })),
    'script': React.createElement(React.Fragment, null,
        React.createElement("script", { src: "https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js" }),
        React.createElement("script", { src: "https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js" }),
        React.createElement("script", { src: "/index.js", type: "module" })),
    'contentTitle': React.createElement("h1", { key: "0" }, "Deno + Oak \u6784\u5EFA\u9177\u70AB\u7684 Todo API"),
    'contentBody': React.createElement("article", { dangerouslySetInnerHTML: {
            __html: '<blockquote>\n<ul>\n<li>åŸæ–‡åœ°å€ï¼š<a href="https://www.freecodecamp.org/news/create-a-todo-api-in-deno-written-by-a-guy-coming-from-node/">How to Create a Todo API in Deno and Oak</a></li>\n<li>åŸæ–‡ä½œè€…ï¼šAdeel Imran</li>\n<li>åŸæ–‡å‘å¸ƒæ—¶é—´ï¼š2020-05-29</li>\n<li>è¯‘è€…ï¼š<a href="https://github.com/hylerrix">hylerrix</a></li>\n<li>å¤‡æ³¨ï¼šæœ¬æ–‡éµå¾ª <a href="https://github.com/freeCodeCamp/news-translation">freeCodeCamp ç¿»è¯‘è§„èŒƒ</a>ï¼ŒåŒæ—¶æœ¬æ–‡ä¼šæ”¶å½•åœ¨<a href="https://github.com/hylerrix/deno-tutorial">ã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹</a>çš„ç¿»è¯‘ç¯‡ä¸­ã€‚</li>\n<li>å¤‡æ³¨ï¼šã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹ç”µå­ä¹¦å®˜ç½‘ä¸Šçº¿å•¦ï¼<a href="https://deno-tutorial.js.org">https://deno-tutorial.js.org</a></li>\n</ul>\n</blockquote>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-01.jpg" alt=""></p>\n<h2 id="%E5%BA%8F%E8%A8%80">åºè¨€<a class="anchor" href="#%E5%BA%8F%E8%A8%80">Â§</a></h2>\n<p>æˆ‘æ˜¯ä¸€ä½ JavaScript/Node å¼€å‘è€…ï¼Œé»˜é»˜åœ°å–œæ¬¢ç”šè‡³çˆ±æ…•ç€ Denoã€‚Deno è¯ç”Ÿä¹‹åˆå°±æ·±æ·±åœ°å¸å¼•äº†æˆ‘ï¼Œæ­¤åæˆ‘æˆä¸ºäº† Deno çš„å¿ å®ç²‰ä¸ï¼ŒæœŸå¾…ç€æœ‰æœä¸€æ—¥èƒ½æ­£å¼ç©ä¸Š Denoã€‚</p>\n<p>æœ¬æ–‡ä¸“æ³¨äºåˆ›é€ ä¸€ä¸ªåŸºäº REST API è®¾è®¡çš„å¾…åšæ¸…å•ï¼ˆTodoï¼‰åº”ç”¨ã€‚è¯·è®°ä½æœ¬æ–‡ä¸­è¿˜ä¸ä¼šæ¶‰åŠæœ‰å…³æ•°æ®åº“æ“ä½œçš„çŸ¥è¯†ï¼Œå…¶å†…å®¹ä¼šåœ¨æˆ‘ä¹‹åçš„<a href="https://www.freecodecamp.org/news/how-to-use-mysql-in-deno-oak/">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>\n<p>å¦‚æœä½ æƒ³èƒ½å¤Ÿéšæ—¶å›é¡¾æˆ–å‚è€ƒæœ¬æ–‡çš„ä»£ç ï¼Œå¯ä»¥è®¿é—®æˆ‘çš„è¿™ä¸ªä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ï¼Œæ”¶å½•äº†è¯¥ç³»åˆ—çš„æ‰€æœ‰ä»£ç ã€‚</p>\n<blockquote>\n<p>è¯‘è€…æ³¨ï¼šå¦ä¸€ç¯‡æ–‡ç« ã€ŠHow to Use MySQL With Deno and Oakã€‹å³å°†ä¼šè¢«ç¿»è¯‘ï¼Œå…¶ç›¸å…³ Demo ä¹Ÿä¼šè¢«æ”¶å½•åœ¨ã€ŠDeno é’»ç ”ä¹‹æœ¯ã€‹ä¸­ã€‚</p>\n</blockquote>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-02.jpg" alt=""></p>\n<p>ç…§ç‰‡æ¥è‡ªäºÂ <a href="https://unsplash.com/@bernardtheclerk?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Bernard de Clerk</a> / <a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit">Unsplash</a></p>\n<h3 id="%E6%9C%AC%E6%96%87%E4%BC%9A%E6%B6%89%E5%8F%8A%E7%9A%84%E5%86%85%E5%AE%B9">æœ¬æ–‡ä¼šæ¶‰åŠçš„å†…å®¹<a class="anchor" href="#%E6%9C%AC%E6%96%87%E4%BC%9A%E6%B6%89%E5%8F%8A%E7%9A%84%E5%86%85%E5%AE%B9">Â§</a></h3>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ªæœ€åŸºç¡€çš„æœåŠ¡å™¨</li>\n<li>åˆ›å»º 5 ä¸ª APIsï¼ˆè·¯ç”± routes/æ§åˆ¶å™¨ controllerï¼‰</li>\n<li>åˆ›å»ºä¸€ä¸ªä¸­é—´ä»¶æ¥ç»™ API è¯·æ±‚æ·»åŠ ç»ˆç«¯è¾“å‡ºçš„æ—¥å¿—åŠŸèƒ½</li>\n<li>åˆ›å»ºä¸€ä¸ª 404 ä¸­é—´ä»¶æ¥å¤„ç†ç”¨æˆ·è®¿é—®æœªçŸ¥ API æ—¶çš„æƒ…å†µ</li>\n</ul>\n<h3 id="%E6%9C%AC%E6%96%87%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87">æœ¬æ–‡éœ€è¦çš„çŸ¥è¯†å‡†å¤‡<a class="anchor" href="#%E6%9C%AC%E6%96%87%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87">Â§</a></h3>\n<ul>\n<li>ä¸€ä¸ªå·²ç»å®‰è£…å¥½çš„ Deno ç¯å¢ƒï¼ˆåˆ«æ€•ï¼Œæˆ‘ä¼šå‘Šè¯‰ä½ æ€ä¹ˆåšï¼‰</li>\n<li>å¯¹ TypeScript æœ‰æµ…è¦çš„äº†è§£</li>\n<li>å¦‚æœä½ ä¹‹å‰å¯¹ Node/Express ä¸€å®šçš„äº†è§£å°±æ›´å¥½äº†ï¼ˆä¸äº†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œæœ¬æ–‡è¿˜æ˜¯å¾ˆé€šä¿—æ˜“æ‡‚çš„ï¼‰</li>\n</ul>\n<h2 id="%E8%AE%A9%E6%88%91%E4%BB%AC%E5%BC%80%E5%A7%8B%E5%90%A7">è®©æˆ‘ä»¬å¼€å§‹å§<a class="anchor" href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%BC%80%E5%A7%8B%E5%90%A7">Â§</a></h2>\n<p>é¦–å…ˆæˆ‘ä»¬è¦å…ˆå®‰è£… Denoã€‚ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°†ä½¿ç”¨ brewã€‚åªéœ€è¦æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥è¿™æ¡å‘½ä»¤å³å¯ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ brew <span class="token function">install</span> deno\n</code></pre>\n<p>ä½†å¦‚æœä½ ç”¨çš„æ˜¯å…¶å®ƒæ“ä½œç³»ç»Ÿçš„è¯ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå®‰è£…æ‰‹å†Œå¯ä»¥çœ‹çœ‹ï¼š<a href="https://deno.land/#installation">deno.land installation</a>ã€‚ä¸Šé¢æœ‰å¤šæ ·åŒ–çš„å®‰è£…æ–¹å¼å¯ä¾›ä½ æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿæ¥é€‰æ‹©ã€‚</p>\n<p>ä¸€æ—¦ä½ å®‰è£…æˆåŠŸï¼Œå…³é—­ç»ˆç«¯å¹¶æ‰“å¼€å¦ä¸€ä¸ªåï¼Œè¾“å…¥è¿™æ¡å‘½ä»¤ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno --version\n</code></pre>\n<p>ä¸€åˆ‡æ­£å¸¸çš„è¯ç»ˆç«¯ä¼šäº§ç”Ÿå¦‚ä¸‹è¾“å‡ºï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-03.jpg" alt=""></p>\n<p><code>deno --version</code> å‘½ä»¤ç”¨æ¥æŸ¥çœ‹å½“å‰å®‰è£…çš„ Deno æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚</p>\n<p>æ£’æäº†ï¼é€šè¿‡è¿™ä¸ªä»‹ç»æˆ‘ä»¬å·²ç»æˆåŠŸå®Œæˆäº†æœ¬æ–‡ 10% çš„æŒ‘æˆ˜ã€‚</p>\n<p>è®©æˆ‘ä»¬ç»§ç»­æ¢ç´¢ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„å¾…åšæ¸…å•åº”ç”¨åˆ›å»ºä¸€ä¸ªåç«¯ API å§ã€‚</p>\n<h2 id="%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">é¡¹ç›®çš„å‡†å¤‡å·¥ä½œ<a class="anchor" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">Â§</a></h2>\n<p>é˜…è¯»ä¸‹æ–‡ï¼Œå¯ä»¥æ¥æå‰æ¥ä»“åº“é‡Œçœ‹çœ‹æœ¬æ–‡æ”¶å½•çš„æ‰€æœ‰ä»£ç ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬ä»é›¶åšèµ·ï¼š</p>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>chapter_1:oak</code> çš„æ–°æ–‡ä»¶å¤¹ï¼ˆä½ ä¹Ÿå¯ä»¥éšæ„èµ·åï¼‰ã€‚</li>\n<li>å½“ä½ åˆ›å»ºå®Œæ¯•åä½¿ç”¨ <code>cd</code> å‘½ä»¤è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚åˆ›å»ºä¸€ä¸ªåä¸º <strong>server.ts</strong> çš„æ–‡ä»¶å¹¶å¡«å……å¦‚ä¸‹ä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬å…ˆè¿è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚æ‰“å¼€ä½ çš„ç»ˆç«¯å¹¶è¿›å…¥å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•åï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åˆ«æ€¥åˆ«æ€¥ï¼Œæˆ‘ä¼šåœ¨ä¹‹åæ¥ä»‹ç» <code>--allow-net</code> å‚æ•°åˆ°åº•åšäº†ä»€ä¹ˆçš„ ğŸ˜„ã€‚</p>\n<p>ä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-04.jpg" alt=""></p>\n<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç›‘å¬ç€ 8080 ç«¯å£çš„æœåŠ¡ç«¯åº”ç”¨ã€‚åªæœ‰ 8080 ç«¯å£ä¸è¢«å ç”¨ï¼Œè¿™ä¸ªåº”ç”¨æ‰èƒ½æ­£å¸¸æ‰§è¡Œã€‚</p>\n<p>å¦‚æœä½ æœ‰è¿‡ä½¿ç”¨ JavaScript å¼€å‘çš„ç»éªŒï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬å¯¼å…¥æ¨¡å—çš„æ–¹å¼æœ‰äº›ä¸ä¸€æ ·ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯è¿™æ ·å¯¼å…¥æ¨¡å—çš„ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">import { Application } from <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token comment">;</span>\n</code></pre>\n<p>å½“ä½ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>deno run ---allow-net &lt;file_name&gt;</code> å‘½ä»¤æ—¶ï¼ŒDeno ä¼šè¯»å–ä½ çš„å¯¼å…¥ä¿¡æ¯ï¼Œå¹¶åœ¨æœ¬åœ°çš„å…¨å±€ç¯å¢ƒä¸­æ²¡æœ‰å®‰è£…è¯¥æ¨¡å—çš„æƒ…å†µä¸‹å®‰è£…è¿™äº›æ¨¡å—ã€‚</p>\n<p>ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ Deno ä¼šå°è¯•è®¿é—® <code>https://deno.land/x/oak/mod.ts</code> æ¨¡å—å¹¶å®‰è£… <code>oak</code> åº“ã€‚ Oak æ˜¯ä¸€ä¸ªä¸“æ³¨äºç¼–å†™ API çš„ Deno Web æ¡†æ¶ã€‚</p>\n<p>æ¥ä¸‹æ¥çš„ä¸€è¡Œæˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™æ¡è¯­å¥ä¸ºæˆ‘ä»¬çš„åº”ç”¨åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹æ˜¯æœ¬æ–‡æ·±å…¥æ¢ç´¢ Deno çš„åŸºçŸ³ã€‚ä½ å¯ä»¥ä¸ºè¿™ä¸ªå®ä¾‹å¢åŠ è·¯ç”±ï¼Œé…ç½®ä¸­é—´ä»¶ï¼ˆå¦‚æ—¥å¿—ä¸­é—´ä»¶ï¼‰ï¼Œç¼–å†™ 404 æœªçŸ¥è·¯ç”±å¤„ç†ç¨‹åºç­‰ç­‰ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n<span class="token comment">// const port = 8080; // => ä¹Ÿå¯ä»¥å†™æˆè¿™æ ·</span>\n</code></pre>\n<p>ä¸Šé¢ä¸¤è¡Œåœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ <code>const port: number = 8080</code> å‘Šè¯‰ TypeScriptï¼š <code>port</code> å˜é‡çš„ç±»å‹æ˜¯æ•°å€¼ç±»çš„ã€‚</p>\n<p>å¦‚æœä½ è¿™æ ·å†™çš„è¯ï¼š<code>const port: number = &quot;8080&quot;</code>ï¼Œç»ˆç«¯ä¼šäº§ç”Ÿç±»ä¼¼è¿™æ ·çš„æŠ¥é”™ï¼šport å˜é‡åº”è¯¥æ˜¯Â <code>number</code> ç±»å‹çš„ï¼Œä½†æ˜¯è¿™ç±»å°è¯•ç”¨Â <code>string</code> ç±»å‹çš„ &quot;8080&quot; æ¥ä¸ºå…¶èµ‹å€¼ã€‚</p>\n<p>å¦‚æœä½ æƒ³å­¦ä¹ å…³äº Type çš„æ›´å¤šç±»å‹ç°åœ¨å°±å¯ä»¥çœ‹çœ‹è¿™ä¸ªç®€å•çš„æ–‡æ¡£ï¼š<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">TypeScript å®˜æ–¹ - åŸºç¡€ Types ç±»å‹</a>ã€‚ä»…ä»… 2~3 åˆ†é’Ÿå°±å¯ä»¥é‡æ–°å›åˆ°æœ¬æ–‡ã€‚</p>\n<p>åœ¨æ–‡ä»¶çš„æœ€åæˆ‘ä»¬æ˜¯è¿™æ ·å†™çš„ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚ä¸Šæˆ‘ä»¬è®© Deno ç›‘å¬äº† 8080 ç«¯å£ï¼Œç«¯å£å·æ˜¯å†™æ­»çš„ã€‚</p>\n<p>åœ¨ä½ çš„ <strong>server.ts</strong> æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ›´å¤šçš„ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nrouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç›¸æ¯”ä¹‹å‰æ–°å¢çš„å†…å®¹æ˜¯ä» <code>oak</code> ä¸­åŒæ—¶å¯¼å…¥äº† <code>Application</code> å’Œ <code>Router</code>Â å˜é‡ã€‚</p>\n<p>å…¶ä¸­å…³äº <code>Router</code> çš„ç›¸å…³ä»£ç æ˜¯ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> router <span class="token operator">=</span> new <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>\nrouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>{ response }<span class="token punctuation">:</span> { response<span class="token punctuation">:</span> any }<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> {\n    message<span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  }<span class="token comment">;</span>\n}<span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>æˆ‘ä»¬é€šè¿‡ <code>const router = new Router()</code> è¯­å¥åˆ›å»ºäº†æ–°çš„ Router ç¤ºä¾‹ï¼Œç„¶åæˆ‘ä»¬ä¸ºå…¶æ ¹ç›®å½• <code>/</code> åˆ›å»ºäº†å¤„ç† <code>get</code> è¯·æ±‚çš„æ‰§è¡Œæ–¹å¼ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡ç‚¹çœ‹çœ‹å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>router.get</code> å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è·¯ç”±æŒ‚è½½çš„è·¯å¾„ <code>/</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å‡½æ•°æœ¬èº«ä¹Ÿæ¥å—ä¸€ä¸ªå¯¹è±¡å‚æ•°ï¼Œè¿™é‡Œä½¿ç”¨ ES6 è¯­æ³•å°†å…¶è§£æ„ï¼Œåªå–äº†å…¶ä¸­ response å˜é‡çš„å€¼ã€‚</p>\n<p>æ¥ä¸‹æ¥å°±åƒä¹‹å‰ç¼–å†™Â <code>const port: number = 8080;</code> è¯­å¥ä¸€æ ·ä¸º <code>response</code> å˜é‡å£°æ˜ç±»å‹ã€‚<code>{ response }: { response: any }</code> è¯­å¥å‘Šè¯‰ TypeScript æˆ‘ä»¬è¿™é‡Œè§£æ„çš„ <code>response</code> å˜é‡æ˜¯ <code>any</code> ç±»å‹çš„ã€‚</p>\n<p><code>any</code> ç±»å‹å¯ä»¥å¸®å‡†ä½ é¿å… TypeScript è¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œä½ å¯ä»¥é€šè¿‡<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html#any">è¿™ä¸ªæ–‡æ¡£</a>æ¥äº†è§£æ›´å¤šã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘æ‰€ç¼–å†™çš„å°±æ˜¯ä½¿ç”¨ <code>response</code> å˜é‡ï¼Œå¹¶è®¾ç½® <code>response.body.message = &quot;hello world&quot;;</code>ã€‚</p>\n<pre class="language-autoit"><code class="language-autoit">response<span class="token punctuation">.</span>body <span class="token operator">=</span> {\n  message<span class="token punctuation">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n}<span class="token comment">;</span>\n</code></pre>\n<p>æœ€ååŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ç¼–å†™äº†å¦‚ä¸‹ä¸¤è¡Œä»£ç ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>ç¬¬ä¸€è¡Œå‘Šè¯‰ Deno è¦åŒ…å«æˆ‘ä»¬çš„ router å˜é‡é‡Œè®¾ç½®çš„æ‰€æœ‰è·¯å¾„ï¼ˆç›®å‰æˆ‘ä»¬åªè®¾ç½®äº†æ ¹è·¯å¾„ï¼‰ï¼Œç¬¬äºŒè¡Œè®© Deno å…è®¸ä»»æ„è®¿é—®æ–¹æ³•æ¥è¯·æ±‚æˆ‘ä»¬è®¾ç½®çš„è·¯å¾„ï¼Œæ¯”å¦‚ <code>GET, POST, PUT, DELETE</code>ã€‚</p>\n<p>åˆ°è¿™é‡Œå°±å¯ä»¥æµ‹è¯•è¿è¡Œäº† âœ… ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œè¿™è¡Œè¯­å¥æ¥çœ‹çœ‹æœ€ç»ˆä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p><code>---allow-net</code> å‚æ•°å‘Šè¯‰ Denoï¼šç”¨æˆ·æˆäºˆäº†è¿™ä¸ªåº”ç”¨åœ¨æ‰“å¼€çš„ç«¯å£ä¸Šè®¿é—®ç½‘ç»œçš„æƒé™ã€‚</p>\n<p>ç°åœ¨é€šè¿‡ä½ å¸¸ç”¨çš„æµè§ˆå™¨æ‰“å¼€ <code>http://localhost:8080</code> åœ°å€ï¼Œå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-05.jpg" alt="">\næµè§ˆå™¨æ‰“å¼€ localhost:8080 çš„æ‰§è¡Œç»“æœ</p>\n<p>æœ€éš¾çš„éƒ¨åˆ†å·®ä¸å¤šæå®šäº†ï¼Œä½†åœ¨å¯¹æ¦‚å¿µçš„æ›´å¤šäº†è§£ä¸­æˆ‘ä»¬åªè¿›è¡Œäº† 60% çš„ä»‹ç»ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-06.jpg" alt="">\næ¥è‡ª Yoda å¤§å¸ˆçš„æ‰¹å‡†</p>\n<p>æ£’æäº†ã€‚</p>\n<p>åœ¨æˆ‘ä»¬æ­£å¼å¼€å§‹ç¼–å†™å¾…åšæ¸…å•çš„ API å‰ï¼Œæˆ‘ä»¬æœ€åè¦åšçš„äº‹æ˜¯å°†å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'running on port \'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ›¿æ¢æˆè¿™æ ·ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">app<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> secure<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> protocol <span class="token operator">=</span> secure <span class="token operator">?</span> <span class="token string">"https://"</span> <span class="token operator">:</span> <span class="token string">"http://"</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> url <span class="token operator">=</span> $<span class="token punctuation">{</span>protocol<span class="token punctuation">}</span>$<span class="token punctuation">{</span>hostname <span class="token operator">??</span> <span class="token string">"localhost"</span><span class="token punctuation">}</span><span class="token operator">:</span>$<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Listening on<span class="token operator">:</span> $<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬ä¹‹å‰çš„ä»£ç æ˜¯å…ˆåœ¨æ§åˆ¶å°ä¸Šç®€å•çš„æ‰“å°ä¸€æ¡æˆåŠŸæ—¥å¿—ï¼Œç„¶åå†è®©åº”ç”¨å¼€å§‹åœ¨ç«¯å£ä¸Šç›‘å¬ï¼Œä¸æ˜¯å¾ˆä¼˜é›…ï¼ˆè¯‘è€…æ³¨ï¼šæœ‰å¯èƒ½ä¼šåœ¨ç›‘å¬å¤±è´¥çš„æƒ…å†µä¸‹ä¾ç„¶æ‰“å°ç›‘å¬æˆåŠŸçš„æ—¥å¿—ï¼‰ã€‚</p>\n<p>åœ¨æ›¿æ¢åçš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>app.addEventListener(&quot;listen&quot;, ({ secure, hostname, port }) =&gt; {}</code> è¯­å¥æ¥å‘åº”ç”¨å®ä¾‹æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨åï¼Œå†è®©åº”ç”¨ç›‘å¬åœ¨ç«¯å£ä¸Šã€‚</p>\n<p>ä¾¦å¬å™¨çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æƒ³ä¾¦å¬çš„äº‹ä»¶ã€‚ä¸€è¯­åŒå…³ï¼Œè¿™é‡Œä¾¦å¬ï¼ˆlistenï¼‰çš„å°±æ˜¯ <code>listen</code> äº‹ä»¶ ğŸ˜…ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯ä»¥è¢«è§£æ„çš„å¯¹è±¡ï¼Œè¿™é‡Œè§£æ„å‡º <code>{ secure, hostname, port }</code> ä¸‰ä¸ªå˜é‡ã€‚Secure å˜é‡æ˜¯å¸ƒå°”ç±»å‹ï¼Œhostname å˜é‡æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œport å˜é‡æ˜¯æ•°å€¼ç±»å‹ã€‚</p>\n<p>æ­¤æ—¶è¿è¡Œè¿™ä¸ªåº”ç”¨çš„è¯ï¼Œåªæœ‰åœ¨æˆåŠŸç›‘å¬æŒ‡å®šç«¯å£åæ‰ä¼šè¾“å‡ºç›‘å¬æˆåŠŸçš„æ—¥å¿—ï¼Œ</p>\n<p>æˆ‘ä»¬å¯ä»¥å†å‘è¿œæ–¹è¿ˆå‡ºä¸€æ­¥ï¼Œä½¿å…¶æ›´åŠ ä¸°å¯Œå¤šå½©ã€‚è®©æˆ‘ä»¬åœ¨ <code>server.ts</code> æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ è¿™æ ·ä¸€ä¸ªæ–°æ¨¡å—ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> green<span class="token punctuation">,</span> yellow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨ä¹‹å‰çš„äº‹ä»¶ä¾¦å¬å™¨å‡½æ•°é‡Œå°†å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Listening on<span class="token operator">:</span> $<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ›¿æ¢ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">"Listening on:"</span><span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ¥ä¸‹æ¥å½“æˆ‘ä»¬æ‰§è¡Œï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>å°†ä¼šæ‰“å°è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-07.jpg" alt=""></p>\n<p>å¤ªé…·äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªè‰²å½©ç¼¤çº·çš„æ§åˆ¶å°ã€‚</p>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®æœ¬æ•™ç¨‹çš„æºç ä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">@adeelibr/deno-playground</a>ã€‚</p>\n<p>è®©æˆ‘ä»¬æ¥ä¸‹æ¥åˆ›å»ºå¾…åšæ¸…å•çš„ API å§ã€‚</p>\n<ul>\n<li>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>routes</code> æ–‡ä»¶å¤¹ï¼Œç„¶åå†æ–‡ä»¶å¤¹é‡Œé¢åˆ›å»ºä¸€ä¸ª <code>todo.ts</code> æ–‡ä»¶ã€‚</li>\n<li>ä¸æ­¤åŒæ—¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>controllers</code> æ–‡ä»¶å¤¹ï¼Œå†åœ¨æ–‡ä»¶å¤¹é‡Œä¹Ÿåˆ›å»ºä¸€ä¸ª <code>todo.ts</code> æ–‡ä»¶ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å…ˆæ¥å¡«å…… <code>controllers/todo.ts</code> æ–‡ä»¶é‡Œçš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬åœ¨è¿™é‡Œå…ˆç®€å•åœ°å¯¼å‡ºäº†ä¸€ä¸ªåŒ…å«å¾ˆå¤šæœ‰åå­—çš„å‡½æ•°çš„å¯¹è±¡ï¼Œè¿™äº›å‡½æ•°ç›®å‰éƒ½æ˜¯ç©ºçš„ã€‚</p>\n<p>æ¥ä¸‹æ¥åœ¨ <code>routes/todo.ts</code> æ–‡ä»¶ä¸­å¡«å……è¿™äº›ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// controller æ§åˆ¶å™¨</span>\n<span class="token keyword">import</span> todoController <span class="token keyword">from</span> <span class="token string">"../controllers/todo.ts"</span><span class="token punctuation">;</span>\nrouter\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getAllTodos<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>createTodo<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>updateTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>deleteTodoById<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>\n</code></pre>\n<p>å¯¹äºç¼–å†™è¿‡ Node å’Œ Express çš„äººæ¥è¯´ï¼Œå¯¹å¦‚ä¸Šçš„ä»£ç é£æ ¼ä¸€å®šå¾ˆç†Ÿæ‚‰ã€‚</p>\n<p>å…¶ä¸­åŒ…æ‹¬ä» <code>oak</code> ä¸­å¯¼å…¥äº† <code>Route</code> å˜é‡å¹¶é€šè¿‡ <code>const router = new Router();</code> è¯­å¥å°†å…¶å®ä¾‹åŒ–ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¼å…¥æˆ‘ä»¬çš„æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">import todoController from <span class="token string">"../controllers/todo.ts"</span><span class="token comment">;</span>\n</code></pre>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ Deno ä¸­æˆ‘ä»¬æ¯æ¬¡å¯¼å…¥ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶åˆ°é¡¹ç›®ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»å¡«å†™å®Œæ•´è¿™ä¸ªæ–‡ä»¶çš„åç¼€ã€‚å¦åˆ™ Deno æ˜¯ä¸çŸ¥é“ç”¨æˆ·æƒ³è¦å¯¼å…¥çš„æ–‡ä»¶åç¼€åˆ°åº•ä»¥ <code>.js</code>Â è¿˜æ˜¯ <code>.ts</code> ç»“å°¾ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç ä¸ºåº”ç”¨é…ç½®äº†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ RESTful é£æ ¼çš„è·¯å¾„ã€‚</p>\n<pre class="language-typescript"><code class="language-typescript">router\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getAllTodos<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/todos"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>createTodo<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>getTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>updateTodoById<span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> todoController<span class="token punctuation">.</span>deleteTodoById<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ä¸Šé¢çš„ä»£ç ä¼šå°†è·¯å¾„è§£æä¸ºè¿™æ ·ï¼š</p>\n<div class="table_wrapper"><table>\n<thead>\n<tr>\n<th>è¯·æ±‚æ–¹å¼</th>\n<th>API è·¯ç”±</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/todos</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/todos/:id</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/todos</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/todos/:id</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/todos/:id</td>\n</tr>\n</tbody>\n</table></div>\n<p>æœ€åæˆ‘ä»¬é€šè¿‡Â <code>export default router;</code>Â è¯­å¥æ¥å°†é…ç½®å¥½çš„è·¯ç”±å¯¼å‡ºã€‚</p>\n<p>æ­¤æ—¶æˆ‘ä»¬å·²ç»å®Œæˆäº†åˆ›å»ºè·¯ç”±çš„å·¥ä½œï¼ˆä½†æ˜¯ç”±äºæˆ‘ä»¬çš„æ§åˆ¶å™¨è¿˜æ˜¯ç©ºçš„å‡½æ•°ï¼Œæ‰€ä»¥æ¯ä¸ªè·¯ç”±å¹¶éƒ½ä¸ä¼šåšä»»ä½•ååº”ï¼Œæˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ åŠŸèƒ½ï¼‰ã€‚</p>\n<p>åœ¨æˆ‘ä»¬å¼€å§‹å‘æ¯ä¸ªæ§åˆ¶å™¨æ·»åŠ åŠŸèƒ½ä¹‹å‰çš„æœ€åä¸€ä¸ªéš¾é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤ <code>router</code> æŒ‚è½½åˆ°æˆ‘ä»¬çš„Â <code>app</code> å®ä¾‹ä¸Šã€‚</p>\n<p>å› æ­¤å›åˆ° <code>server.ts</code>Â æ–‡ä»¶ä¸­æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<ul>\n<li>å°†è¿™è¡Œä»£ç æ·»åŠ è‡³æ–‡ä»¶é¡¶éƒ¨ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// routes è·¯ç”±</span>\n<span class="token keyword">import</span> todoRouter <span class="token keyword">from</span> <span class="token string">"./routes/todo.ts"</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>åˆ é™¤è¿™ä¸€æ®µä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nrouter<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    message<span class="token operator">:</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>å°†å…¶æ›¿æ¢ä¸ºï¼š</li>\n</ul>\n<pre class="language-autoit"><code class="language-autoit">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>ç»ˆäºæå®šäº†ï¼Œä½ çš„ <code>server.ts</code> ç°åœ¨åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Application <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/x/oak/mod.ts">https://deno.land/x/oak/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> green<span class="token punctuation">,</span> yellow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token comment">// routes</span>\n<span class="token keyword">import</span> todoRouter <span class="token keyword">from</span> <span class="token string">"./routes/todo.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> port<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> secure<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> protocol <span class="token operator">=</span> secure <span class="token operator">?</span> <span class="token string">"https://"</span> <span class="token operator">:</span> <span class="token string">"http://"</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname <span class="token operator">??</span> <span class="token string">"localhost"</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>\n    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">"Listening on:"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®æœ¬æ•™ç¨‹çš„æºç ä»“åº“ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">@adeelibr/deno-playground</a>ã€‚</p>\n<p>ç”±äºè·¯ç”±çš„æ§åˆ¶å™¨ä¸Šæš‚æ—¶æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œç°åœ¨ä¸€èµ·æ¥æ‰‹åŠ¨ä¸ºæˆ‘ä»¬çš„æ§åˆ¶å™¨æ·»åŠ åŠŸèƒ½ã€‚</p>\n<p>åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¾—å…ˆåˆ›å»ºä¸¤ä¸ªï¼ˆå°ï¼‰æ–‡ä»¶ï¼š</p>\n<ul>\n<li>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸Šåˆ›å»ºä¸€ä¸ª <code>interfaces</code>Â æ–‡ä»¶å¤¹å¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª <code>Todo.ts</code>ï¼ˆç¡®ä¿ Todo é¦–å­—æ¯å¤§å†™ï¼Œå› ä¸ºå¦‚æœä¸è¿™æ ·åšï¼Œå®ƒå°†ä¸ä¼šåœ¨æ­¤å¤„ç»™å‡ºä»»ä½•è¯­æ³•é”™è¯¯â€”â€”è¿™åªæ˜¯ä¸€ç§çº¦å®šï¼‰ã€‚</li>\n<li>åŒæ—¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª <code>stubs</code>Â æ–‡ä»¶å¤¹å¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªÂ <code>todos.ts</code>Â æ–‡ä»¶ã€‚</li>\n</ul>\n<p>åœ¨ <code>interfaces/Todo.ts</code>Â æ–‡ä»¶ä¸­ç¼–å†™å¦‚ä¸‹æ¥å£è¯´æ˜ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> interface Todo {\n  id<span class="token punctuation">:</span> string<span class="token punctuation">,</span>\n  todo<span class="token punctuation">:</span> string<span class="token punctuation">,</span>\n  isCompleted<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>\n}\n</code></pre>\n<p>ä»€ä¹ˆæ˜¯ interfaceï¼ˆæ¥å£ï¼‰ï¼Ÿ</p>\n<p>è¦çŸ¥é“ TypeScript çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯æ£€æŸ¥ä¸€ä¸ªå˜é‡çš„ç±»å‹ã€‚å°±åƒå‰æ–‡çš„ <code>const port: number = 8080</code>Â å’ŒÂ <code>{ response }: { response : any }</code>Â ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æµ‹ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºå¯¹è±¡ç±»å‹ã€‚</p>\n<p>åœ¨ TypeScript ä¸­ï¼Œinterface è´Ÿè´£å‘½åç±»å‹ï¼Œå¹¶ä¸”æ˜¯<strong>å®šä¹‰ä»£ç å†…å¤–ç±»å‹çº¦æŸ</strong>çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>\n<p>è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰å…³ interface çš„ç¤ºä¾‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å†™äº†ä¸ªæ¥å£</span>\n<span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">{</span>\n  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// æ­¤å‡½æ•°çš„labeledObj å‚æ•°æ˜¯ç¬¦åˆ LabeledValue æ¥å£ç±»å‹çš„</span>\n<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token function">printLabel</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¸Œæœ›å¦‚ä¸Šç¤ºä¾‹å¯ä»¥è®©ä½ å¯¹ interface æœ‰æ›´å¤šçš„äº†è§£ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://www.typescriptlang.org/docs/handbook/interfaces.html">Interfaces å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>\n<p>ç°åœ¨å…³äº interface çš„çŸ¥è¯†å·²ç»ä»‹ç»å¤Ÿäº†ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ¨¡æ‹Ÿä¸€äº›å‡æ•°æ®ï¼ˆå› ä¸ºæœ¬æ–‡ä¸æ¶‰åŠæœ‰å…³æ•°æ®åº“çš„æ“ä½œï¼‰ã€‚</p>\n<p>æˆ‘ä»¬åœ¨ <code>stubs/todos.ts</code> æ–‡ä»¶ä¸­æ¥ä¸º todos å˜é‡å¡«å……ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ã€‚è¿™æ ·å³å¯ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interface</span>\n<span class="token class-name"><span class="token keyword">import</span></span> Todo <span class="token keyword">from</span> <span class="token string">\'../interfaces/Todo.ts\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> todos<span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    todo<span class="token operator">:</span> <span class="token string">\'walk dog\'</span><span class="token punctuation">,</span>\n    isCompleted<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span>\n    id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    todo<span class="token operator">:</span> <span class="token string">\'eat food\'</span><span class="token punctuation">,</span>\n    isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> todos<span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æœ‰ä¸¤ä»¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼šæˆ‘ä»¬è¿™é‡Œå¼•ç”¨äº†ä¸€ä¸ªæ–°çš„æ¨¡å—å¹¶ä¸”é€šè¿‡ <code>import { v4 } from &quot;https://deno.land/std/uuid/mod.ts&quot;;</code>Â è¯­å¥è§£æ„äº†å…¶ä¸­çš„ <code>v4</code>Â å˜é‡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¯æ¬¡ä½¿ç”¨ <code>v4.generate()</code>Â è¯­å¥éƒ½èƒ½ç”Ÿæˆä¸€ä¸ªéšæœºçš„ ID å­—ç¬¦ä¸²ã€‚è¿™ä¸ª <code>id</code>Â ä¸èƒ½æ˜¯Â <code>number</code> ç±»å‹çš„ï¼Œè€Œéœ€æ˜¯Â <code>string</code>Â ç±»å‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„ <code>Todo</code> æ¥å£å·²ç»å£°æ˜äº†Â <code>id</code>Â çš„ç±»å‹å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚</li>\n<li>å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ <code>let todos: Todo[] = []</code>Â è¯­å¥ã€‚æ­¤è¯­å¥å‘Šè¯‰ Deno æˆ‘ä»¬çš„ todos å˜é‡æ˜¯ä¸€ä¸ªÂ <code>Todo</code> æ•°ç»„ï¼ˆæ­¤æ—¶ç¼–è¯‘å™¨å°†ä¼šçŸ¥é“æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯Â <code>{id: _string_, todo: _string_ &amp; isCompleted: _boolean_}</code> ç±»å‹çš„ï¼Œå¹¶ä¸å…è®¸å…¶ä»–ä»»ä½•ç±»å‹ï¼‰ã€‚</li>\n</ul>\n<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šçš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹ï¼š<a href="https://www.typescriptlang.org/docs/handbook/interfaces.html">Interfaces å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>\n<p>å¤ªæ£’äº†ï¼Œä½ å·²ç»è¿›è¡Œåˆ°å¦‚æ­¤ä¹‹è¿œï¼Œå†æ¥å†å‰ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-08.jpg" alt=""></p>\n<p>å·¨çŸ³å¼ºæ£®æ„Ÿæ¿€ä½ æ‰€åšçš„ä¸€åˆ‡åŠªåŠ›ã€‚</p>\n<h2 id="%E8%AE%A9%E6%88%91%E4%BB%AC%E5%85%B3%E6%B3%A8%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A">è®©æˆ‘ä»¬å…³æ³¨åœ¨æ§åˆ¶å™¨ä¸Š<a class="anchor" href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%85%B3%E6%B3%A8%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A">Â§</a></h2>\n<p>åœ¨ä½ çš„Â <code>controllers/todo.ts</code>Â æ–‡ä»¶ä¸­ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬å…ˆç¼–å†™Â <code>getAllTodos</code>Â æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> è·å–æ‰€æœ‰ todos\n   * <span class="token keyword">@route</span> GET /todos\n   */</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åœ¨å¼€å§‹ä»‹ç»è¿™æ®µä»£ç å‰ï¼Œè®©æˆ‘è§£é‡Šä¸‹æ¯ä¸ªæ§åˆ¶å™¨éƒ½æœ‰çš„å‚æ•°â€”â€”<code>context</code>ï¼ˆä¸Šä¸‹æ–‡ï¼‰å‚æ•°ã€‚</p>\n<p>å› æ­¤æˆ‘ä»¬æ‰èƒ½è§£æ„ <code>getAllTodos: (context) =&gt; {}</code>Â ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre>\n<p>å¹¶ä¸”è‡ªä»å“ªä¸ªæˆ‘ä»¬ä½¿ç”¨Â <code>typescript</code>Â åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè¿™æ ·çš„å˜é‡æ·»åŠ ç±»å‹å£°æ˜ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n  <span class="token punctuation">{</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> params <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> \n    request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> \n    response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> \n    params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n</code></pre>\n<p>æ­¤æ—¶æˆ‘ä»¬ä¸ºè§£æ„çš„ä¸‰ä¸ªå˜é‡Â <code>{ request, response, params }</code>Â æ·»åŠ äº†ç±»å‹è¯´æ˜ã€‚</p>\n<ul>\n<li><code>request</code>Â å˜é‡æœ‰å…³ç”¨æˆ·å‘æ¥çš„è¯·æ±‚ï¼ˆæ¯”å¦‚è¯·æ±‚å¤´å’Œ JSON ç±»çš„è¯·æ±‚ä½“ï¼‰ã€‚</li>\n<li><code>response</code>Â å˜é‡æœ‰å…³æœåŠ¡å™¨ç«¯é€šè¿‡ API è¿”å›çš„ä¿¡æ¯ã€‚</li>\n<li><code>params</code>Â å˜é‡æ˜¯æˆ‘ä»¬åœ¨è·¯ç”±é…ç½®ä¸­å®šä¹‰çš„å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/todos/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p><code>/todos/:id</code>Â ä¸­çš„Â <code>:id</code>Â æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥ä» URL ä¸­è·å¾—åŠ¨æ€çš„æ•°æ®ã€‚å› æ­¤å½“ç”¨æˆ·è®¿é—®è¿™ä¸ª API ï¼ˆæ¯”å¦‚ <code>/todos/756</code>ï¼‰çš„æ—¶å€™ï¼Œ<strong>756</strong> åˆ™æ˜¯ <strong>:id</strong> å‚æ•°çš„å€¼ã€‚å¹¶ä¸”æˆ‘ä»¬çŸ¥é“ URL é‡Œçš„è¿™ä¸ªå€¼çš„ç±»å‹æ˜¯Â <code>string</code>Â ç±»çš„ã€‚</p>\n<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†åŸºæœ¬çš„å£°æ˜åï¼Œè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ todos æ§åˆ¶å™¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> è·å–æ‰€æœ‰ todos\n   * <span class="token keyword">@route</span> GET /todos\n   */</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¯¹äº <code>getAllTodos</code>Â æ–¹æ³•æ¥è¯´æˆ‘ä»¬åªéœ€è¦ç®€å•çš„è¿”å›ç»“æœã€‚å¦‚æœä½ è®°å¾—ä¹‹å‰è¯´çš„ï¼Œä¼šæƒ³èµ·æ¥Â <code>response</code>Â æ˜¯ç”¨æ¥å¤„ç†æœåŠ¡å™¨æƒ³è¦ç»™ç”¨æˆ·è¿”å›çš„æ•°æ®ã€‚</p>\n<p>å¯¹äºç¼–å†™è¿‡ Node å’Œ Express çš„äººæ¥è¯´ï¼Œè¿™é‡Œçš„ä¸€å¤§ä¸åŒæ˜¯æˆ‘ä»¬ä¸éœ€è¦ <code>return</code>Â å“åº”å¯¹è±¡ã€‚ Deno ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ‰§è¡Œæ­¤æ“ä½œã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é€šè¿‡ <code>response.status</code> æ¥è®¾ç½®æ­¤æ¬¡è¯·æ±‚çš„å“åº”ç æ˜¯ <code>200</code>ã€‚</p>\n<p>æ›´å¤š HTTP å“åº”ç å¯ä»¥çœ‹ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">MDN ä¸Šçš„Â HTTP å“åº”çŠ¶æ€ç æ–‡æ¡£</a>ã€‚</p>\n<p>å¦ä¸€ä»¶äº‹æ˜¯è®¾ç½® <code>response.body</code>Â çš„å€¼ä¸ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> todos\n<span class="token punctuation">}</span>\n</code></pre>\n<p>é‡æ–°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<blockquote>\n<p>ä¿®è®¢ï¼š--allow-net å±æ€§å‘Šè¯‰ Denoï¼Œæ­¤åº”ç”¨ç¨‹åºæˆäºˆç”¨æˆ·é€šè¿‡æ‰“å¼€çš„ç«¯å£è®¿é—®ç½‘ç»œçš„æƒé™ã€‚</p>\n</blockquote>\n<p>ä¸€æ—¦ä½ çš„æœåŠ¡ç«¯ç¤ºä¾‹è·‘é€šï¼ŒæŒºå¯ä»¥é€šè¿‡ <code>GET /todos</code>Â æ–¹å¼æ¥è¯·æ±‚è¿™ä¸ª APIã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ Google Chrome æµè§ˆå™¨ä¸‹çš„ä¸€ä¸ªæ’ä»¶ <code>postman</code>ï¼Œ<a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop//%40">åœ¨è¿™é‡Œä¸‹è½½</a>ã€‚</p>\n<p>ä½ å¯ä»¥ä½¿ç”¨ä»»æ„çš„ REST é£æ ¼çš„å®¢æˆ·ç«¯ï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨ <code>postman</code> æ˜¯å› ä¸ºå®ƒçœŸçš„å¾ˆç®€å•å¥½ç”¨ã€‚</p>\n<p>åœ¨ Postman ä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µã€‚è®¾ç½®è¯·æ±‚æ–¹å¼ä¸ºÂ <code>GET</code>Â è¯·æ±‚å¹¶ä¸”åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â ã€‚ç‚¹å‡» <code>Send</code> æŒ‰é’®ä¾¿ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-09.jpg" alt=""></p>\n<p>GET /todos API è¿”å›ç»“æœã€‚</p>\n<p>é…·ï¼ä¸€ä¸ª API æå®šäº†ï¼Œè¿˜å‰© 4 ä¸ªç­‰ç€æˆ‘ä»¬Â ğŸ‘ğŸ‘ã€‚</p>\n<p>å¦‚æœä½ åœ¨æŸå¤„å¡ä½äº†ï¼Œå¯ä»¥åœ¨<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">é…å¥—çš„æºç ä»“åº“</a>ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚</p>\n<p>è®©æˆ‘ä»¬å…³æ³¨ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨å§ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> Add a new todo\n   * <span class="token keyword">@route</span> POST /todos\n   */</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>hasBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No data provided"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœè¯·æ±‚ä½“éªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›æ–°å¢åçš„æ‰€æœ‰ todos</span>\n    <span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n      id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n      isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç”±äºæˆ‘ä»¬å°†è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ Todo åˆ°åˆ—è¡¨ä¸­ï¼Œå› æ­¤æˆ‘åœ¨ controller æ–‡ä»¶ä¸­å¯¼å…¥äº† 2 ä¸ªé€šç”¨æ¨¡å—ï¼š</p>\n<ul>\n<li><code>import { v4 } from &quot;https://deno.land/std/uuid/mod.ts&quot;</code>Â è¯­å¥ç”¨æ¥ä¸ºæ¯ä¸€ä¸ª todo å…ƒç´ åˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ ‡è¯†ã€‚</li>\n<li><code>import Todo from &quot;../interfaces/Todo.ts&quot;;</code> è¯­å¥ç”¨æ¥ä¿è¯æ–°å»ºçš„ todo éµå¾ª todo å…ƒç´ çš„æ¥å£æ ¼å¼æ ‡å‡†ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬çš„ <code>createTodo</code>Â æ§åˆ¶å™¨æ˜¯ <code>async</code> å¼‚æ­¥çš„ä»£è¡¨å‡½æ•°ä¸­ä¼šä½¿ç”¨åˆ°ä¸€äº› Promise æŠ€æœ¯ã€‚</p>\n<p>è®©æˆ‘ä»¬æ¥æˆªæ–­è¯´æ˜å…¶ä¸­çš„å°ç‰‡æ®µï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>hasBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No data provided"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>é¦–å…ˆæˆ‘ä»¬è¯»å–è¯·æ±‚ä½“ä¸­ç”¨æˆ·ä¼ æ¥çš„çš„ JSON å†…å®¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ <code>oak</code>Â çš„å†…ç½® <code>request.hasBody</code>Â æ–¹æ³•æ¥æ£€æŸ¥ç”¨æˆ·ä¼ æ¥çš„å†…å®¹æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œæˆ‘ä»¬å°†è¿›å…¥Â <code>if (!request.hasBody) {}</code>Â ä»£ç å—ä¸­æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>\n<p>é‡Œé¢æˆ‘ä»¬å°†å“åº”ä½“çš„çŠ¶æ€ç è®¾ç½®æˆ <code>400</code>ï¼ˆ400 ä»£è¡¨ç€ç”¨æˆ·ç«¯å‡ºç°äº†ä¸€äº›æœ¬ä¸è¯¥å‡ºç°çš„é”™è¯¯ï¼‰ï¼Œå¹¶ä¸”æœåŠ¡ç«¯è¿”å›çš„å“åº”ä½“ä¸º <code>{success: false, message: &quot;no data provided }</code>ã€‚ä¹‹åç¨‹åºç›´æ¥æ‰§è¡ŒÂ <code>return;</code>Â è¯­å¥æ¥ä¿è¯æ¥ä¸‹æ¥çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœè¯·æ±‚ä½“éªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›æ–°å¢åçš„æ‰€æœ‰ todos</span>\n<span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n  id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n  isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„ todo å…ƒç´ ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> newTodo<span class="token operator">:</span> Todo <span class="token operator">=</span> <span class="token punctuation">{</span>\n  id<span class="token operator">:</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  todo<span class="token operator">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span>\n  isCompleted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p><code>let newTodo: Todo = {}</code> ä¿è¯Â <code>newTodo</code>Â å˜é‡çš„å€¼å’Œå…¶å®ƒ todo å…ƒç´ ä¸€æ ·éƒ½éµå¾ªç›¸åŒçš„æ¥å£æ ¼å¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>v4.generate()</code>Â åˆ†é…ä¸€ä¸ªéšæœº IDï¼Œå°† todo çš„é”®å€¼è®¾ç½®ä¸º <code>body.value.todo</code>Â å¹¶å°† <code>isCompleted</code>Â å˜é‡å€¼è®¾ç½®ä¸ºÂ <code>false</code>ã€‚</p>\n<p>è¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œç”¨æˆ·ç»™æˆ‘ä»¬å‘çš„å†…å®¹æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>oak</code>Â ä¸­çš„Â <code>body.value</code>Â æ¥è·å–ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™é‡Œå°† <code>newTodo</code>Â æ·»åŠ åˆ°æ•´ä¸ª todo åˆ—è¡¨ä¸­ä¸­ï¼Œå¹¶åœ¨å“åº”ä½“ä¸­è¿”å›Â <code>{success: true &amp; data: data</code>ã€‚</p>\n<p>æ­¤æ—¶è¿™ä¸ªæ§åˆ¶å™¨ä¹Ÿè¿è¡ŒæˆåŠŸäº†Â âœ…ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡æ–°è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ postman ä¸­ï¼Œæˆ‘å†æ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µã€‚è®¾ç½®è¯·æ±‚çš„æ–¹å¼ä¸º <code>POST</code>Â ç±»å‹ï¼Œå¹¶åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â åï¼Œç‚¹å‡» <code>Send</code>Â ä¾¿ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-10.jpg" alt=""></p>\n<p>å› ä¸ºä¸Šé¢çš„è¯·æ±‚ä½“ä¸­å‘é€äº†ç©ºçš„å†…å®¹ï¼Œæ‰€ä»¥å¾—åˆ°äº† 400 é”™è¯¯å“åº”ç åŠå…¶é”™è¯¯åŸå› ã€‚</p>\n<p>ä½†å¦‚æœæˆ‘ä»¬ç»™è¯·æ±‚ä½“ä¸­åŠ å…¥å¦‚ä¸‹ JSON å†…å®¹ï¼Œå¹¶é‡æ–°å‘é€ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-11.jpg" alt=""></p>\n<p>é€šè¿‡ { todo: &quot;eat a lamma&quot; } æ¥Â POST /todosÂ åçš„æˆåŠŸç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°çš„å…ƒç´ å·²ç»åŠ å…¥åˆ°åˆ—è¡¨ä¸­ã€‚</p>\n<p>é…·ï¼Œæˆ‘ä¹°å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ API å·²ç»ä¸€ä¸ªä¸ªä»¥é¢„æœŸçš„æ–¹å¼æ‰§è¡ŒæˆåŠŸäº†ã€‚</p>\n<p>ä¸¤ä¸ª API æå®šï¼Œè¿˜å‰©ä¸‰ä¸ªè¦åšã€‚</p>\n<p>æˆ‘ä»¬å¿«è¦æå®šäº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†éš¾çš„å†…å®¹å·²ç»ä»‹ç»å®Œæ¯•ã€‚â˜ºï¸ ğŸ™‚ğŸ¤—ğŸ¤©</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸‰ä¸ª APIï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> é€šè¿‡ ID è·å– todo\n   * <span class="token keyword">@route</span> GET todos/:id\n   */</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœ todo æ‰¾åˆ°äº†</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> todo<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘ä»¬å…ˆæ¥èŠèŠÂ <code>GET todos/:id</code>Â ä¸‹çš„æ§åˆ¶å™¨ï¼Œæ­¤æ§åˆ¶å™¨ä¼šé€šè¿‡ ID æ¥æŸ¥æ‰¾ç›¸åº”çš„ todo å…ƒç´ ã€‚</p>\n<p>è®©æˆ‘ä»¬ç»§ç»­é€šè¿‡æˆªå–å°ç‰‡æ®µæ¥æ·±å…¥åˆ†æï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>åœ¨ç¬¬ä¸€è¡Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code>const todo</code> å˜é‡å¹¶å°†å…¶ç±»å‹è®¾ç½®ä¸ºÂ <code>Todo</code>Â æˆ–Â <code>undefined</code>Â ç±»ã€‚å› æ­¤ <code>todo</code> å…ƒç´ åªèƒ½æ˜¯ç¬¦åˆ <code>Todo</code>Â æ¥å£è§„èŒƒçš„å˜é‡æˆ–è€…æ˜¯ä¸€ä¸ª <code>undefined</code>Â å€¼ï¼Œè€Œä¸èƒ½æ˜¯å…¶å®ƒä»»ä½•ç±»å‹ã€‚</p>\n<p>æˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨ <code>todos.find((t) =&gt; t.id === params.id);</code>Â è¯­å¥æ¥é€šè¿‡Â <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find">Array.find()</a>Â æ–¹æ³•å’ŒÂ <code>params.id</code>Â çš„å€¼æ¥æŸ¥æ‰¾æŒ‡å®šçš„ <code>todo</code>Â å…ƒç´ ã€‚å¦‚æœæ‰¾åˆ°äº†æˆ‘ä»¬ä¼šå¾—åˆ°Â <code>Todo</code>Â ç±»å‹çš„ <code>todo</code>Â å…ƒç´ ï¼Œå‘å¦åˆ™å¾—åˆ°ä¸€ä¸ªÂ <code>undefined</code>Â å€¼ã€‚</p>\n<p>å¦‚æœå¾—åˆ°çš„ <code>todo</code>Â çš„å€¼æ˜¯ undefined çš„ï¼Œæ„å‘³ç€å¦‚ä¸‹ if æ¡ä»¶ä¸­çš„ä»£ç ä¼šæ‰§è¡Œï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®å“åº”çš„çŠ¶æ€ç ä¸º <code>404</code>ï¼Œä»£è¡¨ç€ <code>not found</code>Â æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å…ƒç´ ï¼Œå¹¶ä¸”è¿”å›ä½“çš„æ ¼å¼ä¹Ÿæ˜¯æ ‡å‡†çš„Â <code>{ status, message }</code>ã€‚</p>\n<p>å¾ˆé…·ä¸æ˜¯å˜›ï¼Ÿ ğŸ˜„</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•åœ°ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœ todo æ‰¾åˆ°äº†</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> todo<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®¾ç½®ä¸€ä¸ªå“åº”çŠ¶æ€ç ä¸º <code>200</code>Â çš„å“åº”ä½“å¹¶è¿”å›Â <code>success: true &amp; data: todo</code>Â å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬æ¥åœ¨ postman ä¸­æµ‹è¯•ï¼š</p>\n<p>å…ˆä¸€èµ·é‡æ–°å¯åŠ¨æœåŠ¡ç«¯ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ postman ä¸­ï¼Œç»§ç»­æ‰“å¼€ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œè®¾ç½®è¯·æ±‚æ–¹å¼ä¸ºÂ <code>GET</code>Â è¯·æ±‚å¹¶åœ¨Â <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code>Â åï¼Œç‚¹å‡» <code>Send</code>Â æ¥æ‰§è¡Œè¯·æ±‚ã€‚</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚æ¯æ¬¡ä½ é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p>æˆ‘ä»¬è¿™æ ·è¾“å…¥ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-12.jpg" alt=""></p>\n<p>æœåŠ¡ç«¯è¿”å› 404ï¼Œä¸”å‘Šè¯‰æˆ‘ä»¬æ²¡æœ‰ç›¸å…³æ•°æ®è¢«æ‰¾åˆ°ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-13.jpg" alt=""></p>\n<p>ä½†å¦‚æœè¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„ IDï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›å…¶ ID å’Œè¿™ä¸ª ID çš„ä¸€æ ·çš„æ•°æ®å¹¶ä¸”å“åº”çŠ¶æ€ä¸º 200ã€‚</p>\n<p>å¦‚æœä½ éœ€è¦å‚è€ƒæœ¬æ–‡çš„æºç å¯ä»¥è®¿é—®è¿™é‡Œï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<p>ä¸é”™ï¼Œ3 ä¸ª API æå®šï¼Œåªå‰© 2 ä¸ªäº†ã€‚</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> Update todo by id\n   * <span class="token keyword">@route</span> PUT todos/:id\n   */</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      request<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>\n      response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n      response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n        success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åº” todo åˆ™æ›´æ–°å®ƒ</span>\n    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> newTodos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬æ¥æ¢è®¨ä¸‹ä¸€ä¸ªæ§åˆ¶å™¨Â <code>PUT todos/:id</code>ã€‚è¿™ä¸ªæ§åˆ¶å™¨ä¼šæ›´æ–°ä¸€ä¸ªå…ƒç´ çš„å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬ç»§ç»­æˆªæ–­ä»£ç æ¥ç»†çœ‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> todo<span class="token operator">:</span> Todo <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™é‡Œåšçš„å’Œä¹‹å‰æ§åˆ¶å™¨åšçš„ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘å°±ä¸æ·±å…¥ä»‹ç»äº†ã€‚</p>\n<p>é«˜çº§æç¤ºï¼šå¦‚æœä½ æƒ³å°†è¿™æ®µä»£ç è®¾ä¸ºé€šç”¨ä»£ç å—ï¼Œç„¶ååœ¨ä¸¤ä¸ªæ§åˆ¶å™¨ä¸­éƒ½ä½¿ç”¨å®ƒï¼Œå®Œå…¨å¯ä»¥ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·åšï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// å¦‚æœæ‰¾åˆ°ç›¸åº” todo åˆ™æ›´æ–°å®ƒ</span>\n<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n<span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> newTodos<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­æˆ‘æƒ³åœ¨è¿™é‡Œé‡ç‚¹è®¨è®ºçš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n<span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰§è¡Œ <code>const updatedData = body.value</code>ï¼Œç„¶åå°†ç±»å‹æ£€æŸ¥æ·»åŠ åˆ° <code>updatedData</code> ä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<pre class="language-typescript"><code class="language-typescript">updatedData<span class="token operator">:</span> <span class="token punctuation">{</span> todo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> isCompleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span>\n</code></pre>\n<p>è¿™ä¸€å°æ®µä»£ç å‘Šè¯‰ TSï¼š<code>updatedData</code>Â å˜é‡æ˜¯ä¸€ä¸ªæœ‰å¯èƒ½åŒ…å«ä¹Ÿæœ‰å¯èƒ½ä¸åŒ…å« todoã€isComplete ç†Ÿæ‚‰çš„å¯¹è±¡ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬éå†æ¯ä¸€ä¸ª todo å…ƒç´ ï¼Œå°±åƒè¿™æ ·ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> newTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> params<span class="token punctuation">.</span>id <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>t<span class="token punctuation">,</span> <span class="token operator">...</span>updatedData <span class="token punctuation">}</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å…¶ä¸­å½“Â <code>params.id</code>Â å’ŒÂ <code>t.id</code>Â çš„å€¼ä¸€è‡´æ—¶ï¼Œæˆ‘ä»¬å°†æ­¤æ—¶çš„å¯¹è±¡çš„å†…å®¹é‡æ–°è¦†ç›–ä¸ºç”¨æˆ·ä¼ æ¥çš„æƒ³è¦æ›´æ”¹ä¸ºçš„å†…å®¹ã€‚</p>\n<p>æˆ‘ä»¬ä¹Ÿç¼–å†™æˆåŠŸäº†è¿™ä¸ª APIã€‚</p>\n<p>è®©æˆ‘ä»¬é‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸ºÂ <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code>Â è¾“å…¥æ¡†ä¸­è¾“å…¥Â <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚</p>\n<p>æ¯æ¬¡é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-14.jpg" alt=""></p>\n<p>å¦‚ä¸Šè¿”å›äº† 404 çŠ¶æ€ç å¹¶æç¤ºæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ todo å…ƒç´ ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-15.jpg" alt=""></p>\n<p>æä¾›ä¸€ä¸ªå·²çŸ¥çš„ IDï¼Œå¹¶ä¸”è¯·æ±‚ä½“ä¸­å¡«å†™éœ€è¦æ”¹å˜çš„å†…å®¹ã€‚æœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªæ›´æ”¹åçš„å…ƒç´ åŠå…¶å®ƒæ‰€æœ‰å…ƒç´ ã€‚</p>\n<p>é…·ï¼Œå››ä¸ª API æå®šæˆ‘ä»¬åªå‰©æœ€åä¸€ä¸ªéœ€è¦åšã€‚</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>"</span><span class="token punctuation">;</span>\n<span class="token comment">// interfaces</span>\n<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">"../interfaces/Todo.ts"</span><span class="token punctuation">;</span>\n<span class="token comment">// stubs</span>\n<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">"../stubs/todos.ts"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getAllTodos</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">createTodo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateTodoById</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token doc-comment comment">/**\n   * <span class="token keyword">@description</span> é€šè¿‡ ID åˆ é™¤æŒ‡å®š todo\n   * <span class="token keyword">@route</span> DELETE todos/:id\n   */</span>\n  <span class="token function-variable function">deleteTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> params<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> params<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> allTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// remove the todo w.r.t id and return</span>\n    <span class="token comment">// remaining todos</span>\n    response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n      success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      data<span class="token operator">:</span> allTodos<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è®©æˆ‘ä»¬æœ€åæ¥è®¨è®ºä¸‹ <code>Delete todos/:id</code> æ§åˆ¶å™¨çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ­¤æ§åˆ¶å™¨ä¼šé€šè¿‡ç»™å®šçš„ ID æ¥åˆ é™¤ç›¸åº” todo å…ƒç´ ã€‚</p>\n<p>æˆ‘ä»¬è¿™é‡Œåªéœ€ç®€å•åœ°åŠ ä¸€æ¡è¿‡æ»¤æ–¹æ³•ï¼š</p>\n<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> allTodos <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> t<span class="token punctuation">.</span>id !<span class="token operator">==</span> params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token comment">;</span>\n</code></pre>\n<p>éå†æ‰€æœ‰å…ƒç´ å¹¶åˆ é™¤Â <code>todo.id</code> å’ŒÂ <code>params.id</code>Â å€¼ä¸€æ ·çš„å…ƒç´ ï¼Œå¹¶è¿”å›å…¶ä½™æ‰€æœ‰å…ƒç´ ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿™æ ·ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// åˆ é™¤è¿™ä¸ª todo å¹¶è¿”å›å…¶å®ƒæ‰€æœ‰å†…å®¹</span>\nresponse<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n  success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  data<span class="token operator">:</span> allTodos<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åªéœ€è¿”å›æ‰€æœ‰æ²¡æœ‰ç›¸åŒ <a href="http://todo.id">todo.id</a> çš„å¾…åŠäº‹é¡¹æ¸…å•å³å¯ã€‚</p>\n<p>è®©æˆ‘ä»¬é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p>è‡ªä»æˆ‘ä»¬ä½¿ç”¨äº†éšæœº ID ç”Ÿæˆå™¨ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ƒå–è·å–æ‰€æœ‰å…ƒç´ çš„ APIã€‚å¹¶åœ¨å…ƒç´ åˆ—è¡¨é‡Œé€‰å–ä¸€ä¸ª ID æ¥æµ‹è¯•è¿™ä¸ªæ–°çš„ APIã€‚æ¯æ¬¡ä½ é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p>æ¯æ¬¡é‡å¯ Deno ç¨‹åºæ—¶ï¼Œæ–°çš„ ID éƒ½ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-16.jpg" alt=""></p>\n<p>æˆ‘ä»¬ç»ˆäºæå®šäº†æ‰€æœ‰ 5 ä¸ª APIã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-17.jpg" alt=""></p>\n<p>ç°åœ¨æˆ‘ä»¬åªå‰©ä¸‹ä¸¤ä»¶äº‹äº†ï¼š</p>\n<ul>\n<li>å¢åŠ ä¸€ä¸ª 404 ä¸­é—´ä»¶ï¼Œæ¥è®©ç”¨æˆ·è®¿é—®ä¸å­˜åœ¨çš„è·¯ç”±æ—¶å¾—åˆ°è¯¥æœ‰çš„æç¤ºï¼›</li>\n<li>å¢åŠ ä¸€ä¸ªæ—¥å¿— API æ¥æ‰“å°æ‰€æœ‰è¯·æ±‚çš„æ‰§è¡Œæ—¶é—´ã€‚</li>\n</ul>\n<h2 id="%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-404-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6">åˆ›å»ºä¸€ä¸ª 404 è·¯ç”±ä¸­é—´ä»¶<a class="anchor" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-404-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6">Â§</a></h2>\n<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºÂ <code>middlewares</code>Â çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>notFound.ts</code> çš„æ–‡ä»¶åï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>\n  response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>\n    success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    message<span class="token operator">:</span> <span class="token string">"404 - Not found."</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>å¦‚ä¸Šä»£ç å¹¶æ²¡æœ‰å¼•å…¥ä»€ä¹ˆæ–°çš„çŸ¥è¯†ç‚¹â€”â€”å®ƒå¯¹äºæˆ‘ä»¬çš„æ§åˆ¶å™¨ç»“æ„æ¥ä½¿ç”¨äº†è¯´å¾ˆç†Ÿæ‚‰çš„é£æ ¼ã€‚è¿™é‡Œä»…ä»…è¿”å›äº†Â <code>404</code>Â çŠ¶æ€ç ï¼ˆä»£è¡¨ç€ç›¸å…³è·¯ç”±æ²¡æœ‰æ‰¾åˆ°ï¼‰å¹¶ä¸”è¿”å›äº†ä¸€æ®µ JSON å†…å®¹ï¼šÂ <code>{ success, message }</code>ã€‚</p>\n<p>æ¥ä¸‹æ¥åœ¨ä½ çš„Â <code>server.ts</code>Â æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>\n<ul>\n<li>åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ç›¸å…³å¯¼å…¥è¯­å¥ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// æ²¡æœ‰æ‰¾åˆ°</span>\n<span class="token keyword">import</span> notFound <span class="token keyword">from</span> <span class="token string">\'./middlewares/notFound.ts\'</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æ¥ä¸‹æ¥åœ¨ <code>app.use(todoRouter.allowedMethods())</code>Â ä¸‹é¢å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 404 page</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>notFound<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ‰§è¡Œé¡ºåºåœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šæ¯å½“æˆ‘ä»¬å°è¯•è®¿é—® API è·¯ç”±æ—¶ï¼Œå®ƒéƒ½ä¼šé¦–å…ˆåŒ¹é…/æ£€æŸ¥æ¥è‡ª <code>todoRouter</code>Â çš„è·¯ç”±ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå®ƒå°†æ‰§è¡Œ <code>app.use(notFound);</code>Â è¯­å¥ã€‚</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿è¡Œã€‚</p>\n<p>é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>PUT</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos/:id</code> åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-18.jpg" alt=""></p>\n<p>å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œå°† <code>app.use(notFound);</code>Â æ”¾åœ¨Â <code>server.ts</code>Â æ–‡ä»¶ä¸­å…¶å®ƒè·¯ç”±çš„åé¢ã€‚å¦‚æœè¯·æ±‚è·¯ç”±ä¸å­˜åœ¨ï¼Œå®ƒå°†æ‰§è¡Œå¹¶è¿”å› <code>404</code>Â çŠ¶æ€ä»£ç ï¼ˆè¡¨ç¤ºæœªæ‰¾åˆ°ï¼‰ï¼Œå¹¶åƒå¾€å¸¸ä¸€æ ·ç®€å•åœ°è¿”å›ä¸€ä¸ªå“åº”æ¶ˆæ¯ï¼Œå³ <code>{success, message}</code>ã€‚</p>\n<p><strong>é«˜çº§è´´å£«</strong>ï¼šæˆ‘ä»¬å·²ç»çº¦æŸ <code>{success, message}</code>Â æ˜¯åœ¨è¯·æ±‚å¤±è´¥æ—¶è¿”å›çš„æ ¼å¼ï¼Œ<code>{success, data}</code> æ˜¯åœ¨è¯·æ±‚æˆåŠŸæ—¶å€™è¿”å›ç»™ç”¨æˆ·çš„æ ¼å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸ºå¯¹è±¡æ¥å£ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œä»¥ç¡®ä¿æ¥å£çš„ä¸€è‡´æ€§å’Œè¿›è¡Œå®‰å…¨çš„ç±»å‹æ£€æŸ¥ã€‚</p>\n<p>é…·ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æå®šäº†å…¶ä¸­ä¸€ä¸ªä¸­é—´ä»¶â€”â€”è®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªä¸­é—´ä»¶æ¥åœ¨ç»ˆç«¯æ‰“å°æ—¥å¿—å§ã€‚</p>\n<p><strong>åˆ‡è®°</strong>ï¼šå¦‚æœä½ åœ¨æŸäº›åœ°æ–¹å¡ä½äº†ï¼Œå¯ä»¥çœ‹çœ‹æ–‡ç« çš„é…å¥—æºç ï¼š<a href="https://github.com/adeelibr/deno-playground">@adeelibr/deno-playground</a>ã€‚</p>\n<h2 id="%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6">ç»ˆç«¯ä¸­æ‰“å°æ—¥å¿—çš„ä¸­é—´ä»¶<a class="anchor" href="#%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6">Â§</a></h2>\n<p>åœ¨ä½ çš„ <code>middlewares</code> æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>logger.ts</code> æ–‡ä»¶å¹¶å¡«å……å¦‚ä¸‹å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  green<span class="token punctuation">,</span>\n  cyan<span class="token punctuation">,</span>\n  white<span class="token punctuation">,</span>\n  bgRed<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">X_RESPONSE_TIME</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"X-Response-Time"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">responseTime</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>åœ¨Â <code>server.ts</code>Â æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<ul>\n<li>æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  import è¯­å¥æ¥å¯¼å…¥æ¨¡å—ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// logger</span>\n<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">\'./middlewares/logger.ts\'</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>åœ¨ä¹‹å‰æåˆ°çš„Â <code>todoRouter</code>Â ä»£ç å‰è¿™æ ·å¢åŠ ä¸­é—´ä»¶ä»£ç ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä»£ç çš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>\n<p>æˆ‘ä»¬å…ˆæ¥è®¨è®º <code>logger.ts</code>Â æ–‡ä»¶ï¼Œå…ˆæˆªæ–­çœ‹è¿™é‡Œï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  green<span class="token punctuation">,</span>\n  cyan<span class="token punctuation">,</span>\n  white<span class="token punctuation">,</span>\n  bgRed<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"<a class="token url-link" href="https://deno.land/std@0.53.0/fmt/colors.ts">https://deno.land/std@0.53.0/fmt/colors.ts</a>"</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æˆ‘åœ¨è¿™é‡Œå¯¼å…¥äº†æœ‰å…³ç»ˆç«¯é¢œè‰²çš„æ¨¡å—ï¼Œæƒ³è¦ç”¨åœ¨æˆ‘ä»¬çš„æ—¥å¿—ä¸­é—´ä»¶ä¸Šã€‚</p>\n<p>è¿™é‡Œå’Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„Â <code>server.ts</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>eventListener</code>Â çš„æ–¹å¼å¾ˆåƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨æœ‰é¢œè‰²çš„æ—¥å¿—ä¿¡æ¯æ¥è®°å½•æˆ‘ä»¬çš„ API è¯·æ±‚ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¾ç½®äº†Â <code>const X_RESPONSE_TIME: string = &quot;X-Response-Time&quot;;</code>ã€‚è¿™æ¡è¯­å¥ç”¨æ¥åœ¨ä¸ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ç»™å“åº”å¤´çš„ Header ä¸­æ³¨å…¥ <code>X_RESPONSE_TIME</code>Â å˜é‡çš„å€¼ï¼š<code>X-Response-Time</code>ã€‚æˆ‘ä¼šåœ¨åé¢è¿›è¡Œè¯´æ˜ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬åƒè¿™æ ·ä¸€æ ·å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  logger<span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  responseTime<span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>æ­¤æ—¶æˆ‘ä»¬åœ¨Â <code>server.ts</code>Â ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä¸¤è¡Œçš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸‹æ—¥å¿—ä¸­é—´ä»¶åˆ°åº•åšäº†ä»€ä¹ˆï¼Œå¹¶ä¸”é€šè¿‡Â <code>next()</code> æ¥è¯´æ˜å…¶æ‰§è¡Œè¿‡ç¨‹ã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-19.jpg" alt=""></p>\n<p>ä¸Šå›¾ä¸ºè°ƒç”¨ GET / todos API æ—¶æ—¥å¿—è®°å½•ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºã€‚</p>\n<p>è¿™é‡Œå’Œä»¥å‰çš„æ§åˆ¶å™¨å”¯ä¸€çš„åŒºåˆ«æ˜¯ä½¿ç”¨äº† <code>next()</code>Â å‡½æ•°ï¼Œæ­¤å‡½æ•°æœ‰åŠ©äºæˆ‘ä»¬ä»ä¸€ä¸ªæ§åˆ¶å™¨è·³åˆ°å¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>\n<p>å› æ­¤æœ‰äº†è¿™æ®µï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">responseTime</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\n    response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¯·ç•™æ„æˆ‘ä»¬åœ¨ <code>server.ts</code> ä¸­çš„ç¼–å†™æ–¹å¼ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ä»¥ä¸‹ä»£ç çš„ç¼–å†™é¡ºåºå¾ˆé‡è¦</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>todoRouter<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>è¿™é‡Œçš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>logger.logger ä¸­é—´ä»¶</li>\n<li>logger.responseTime ä¸­é—´ä»¶</li>\n<li>todoRouter æ§åˆ¶å™¨ï¼ˆæ— è®ºç”¨æˆ·æƒ³è¦è®¿é—®ä»€ä¹ˆè·¯ç”±ï¼Œå‡ºäºè§£é‡Šçš„ç›®çš„ï¼Œè¿™é‡Œå‡è®¾ç”¨æˆ·éƒ½è°ƒç”¨ <code>GET /todos</code>Â æ¥è·å–æ‰€æœ‰å¾…åŠäº‹é¡¹ï¼‰ã€‚</li>\n</ul>\n<p>å› æ­¤ä¼šå…ˆæ‰§è¡ŒÂ logger.logger çš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token function-variable function">logger</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">{</span> response<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> response<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    next<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre>\n<p>å½“é‡åˆ°Â <code>await next()</code> æ—¶ä¼šç«‹å³è·³åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶â€”â€”<code>responseTime</code>Â ä¸Šã€‚</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-20.jpg" alt=""></p>\n<p>å†æ¬¡åˆ†äº«æ­¤å›¾æ¥å›é¡¾è¿™ä¸ªè¿‡ç¨‹ã€‚</p>\n<p>åœ¨Â <code>responseTime</code>Â ä¸­ï¼Œåªä¼šå…ˆæ‰§è¡Œå¦‚ä¸‹ä¸¤è¡Œï¼ˆå‚è€ƒä¸Šå›¾çš„æ‰§è¡Œè¿‡ç¨‹ 2ï¼‰ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>ç„¶åè·³è½¬åˆ°Â <code>getAllTodos</code>Â æ§åˆ¶å™¨ä¸­å¹¶æ‰§è¡Œ <code>getAllTodos</code>Â é‡Œçš„æ‰€æœ‰ä»£ç ã€‚</p>\n<p>åœ¨è¿™ä¸ªæ§åˆ¶å™¨ä¸­æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ <code>next()</code>ï¼Œå®ƒä¼šè‡ªåŠ¨è¿”å›åˆ° <code>responseTime</code>Â ä¸­é—´ä»¶ä¸­ï¼Œå¹¶æ‰§è¡Œæ¥ä¸‹æ¥çš„å†…å®¹ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> ms<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>\nresponse<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n</code></pre>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¾¿äº†è§£äº† 2ã€3ã€4 çš„æ‰§è¡Œé¡ºåºè¿‡ç¨‹ï¼ˆå‚è§ä¸Šå›¾ï¼‰ã€‚</p>\n<p>è¿™é‡Œæ˜¯å‘ç”Ÿçš„å…·ä½“è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ <code>const start = Date.now();</code>Â æ¥æ•è·ä»¥ <code>ms</code>Â ä¸ºå•ä½çš„æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬ç«‹å³è°ƒç”¨ <code>next()</code> æ¥è·³è½¬åˆ° <code>getAllTodos</code>Â æ§åˆ¶å™¨å¹¶è¿è¡Œå…¶ä¸­çš„ä»£ç ã€‚ç„¶åå†æ¬¡è¿”å›åˆ° <code>responseTime</code>Â æ§åˆ¶å™¨ä¸­ã€‚</li>\n<li>ç„¶åï¼Œé€šè¿‡æ‰§è¡Œ <code>const ms: number = Date.now() - start;</code>Â æ¥å‡å»è¯·æ±‚åˆšæ¥çš„æ—¶é—´ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ¯«ç§’å·®çš„æ•°å­—ï¼Œå°†å‘Šè¯‰ Deno æ‰§è¡Œ getAllTodos æ§åˆ¶å™¨æ‰€èŠ±è´¹çš„æ‰€æœ‰æ—¶é—´ã€‚</li>\n</ul>\n<p>å†æ¬¡åˆ†äº«è¿™ä¸ªæ–‡ä»¶æ¥å›é¡¾è¿™ä¸ªè¿‡ç¨‹ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-21.jpg" alt=""></p>\n<ul>\n<li>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ <code>response</code>Â å“åº”å¤´çš„ Headers ä¸­è®¾ç½®ï¼š</li>\n</ul>\n<pre class="language-typescript"><code class="language-typescript">response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>ms<span class="token punctuation">}</span>ms<span class="token punctuation">)</span>\n</code></pre>\n<p>å°† X-Response-Time çš„å€¼è®¾ç½®ä¸º Deno getAllTodos API æ‰€èŠ±è´¹çš„æ¯«ç§’æ•°ã€‚</p>\n<ul>\n<li>ç„¶åä»æ‰§è¡Œé¡ºåº 4 è¿”å›åˆ°æ‰§è¡Œé¡ºåº 5ï¼ˆå‚è€ƒä¸Šå›¾ï¼‰ã€‚</li>\n</ul>\n<p>åœ¨è¿™é‡Œç®€å•åœ°ç¼–å†™ï¼š</p>\n<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> responseTime <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">X_RESPONSE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">green</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">}</span> $<span class="token punctuation">{</span><span class="token function">cyan</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">{</span><span class="token function">bgRed</span><span class="token punctuation">(</span><span class="token function">white</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>responseTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<ul>\n<li>æ‰“å°æ—¥å¿—æ—¶æˆ‘ä»¬ä»Â <code>X-Response-Time</code>Â ä¸­è·å–åˆ°äº†æ‰§è¡Œ API è€—è´¹çš„æ—¶é—´ã€‚</li>\n<li>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å¸¦æœ‰é¢œè‰²çš„å­—ä½“å°†å…¶æ‰“å°åœ¨ç»ˆç«¯ã€‚</li>\n</ul>\n<p><code>request.method</code>Â è¿”å›ç”¨æˆ·è¯·æ±‚çš„æ–¹å¼ï¼Œæ¯”å¦‚Â <code>GET, PUT ç­‰</code>ï¼ŒåŒæ—¶Â <code>request.url.pathname</code>Â è¿”å›ç”¨æˆ·è¯·æ±‚çš„è·¯å¾„ï¼Œæ¯”å¦‚Â <code>/todos</code>ã€‚</p>\n<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦èƒ½æˆåŠŸè¿è¡Œã€‚</p>\n<p>é‡å¯æœåŠ¡å™¨ï¼š</p>\n<pre class="language-bash"><code class="language-bash">$ deno run --allow-net server.ts\n</code></pre>\n<p>åœ¨ Postman ä¸­æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚å°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º <code>GET</code>ï¼Œå¹¶åœ¨ <code>URL</code> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>http://localhost:8080/todos</code>Â åï¼Œç‚¹å‡» <code>Send</code>ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-22.jpg" alt=""></p>\n<p>åœ¨ Postman ä¸­å¤šè¯·æ±‚å‡ æ¬¡ APIï¼Œç„¶åè¿”å›åˆ°æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—æ—¶ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„å†…å®¹ï¼š</p>\n<p><img src="http://qiniu.ningo.cloud/articles/1b4-23.jpg" alt=""></p>\n<p>æ¯ä¸ª API è¯·æ±‚éƒ½ä¼šè¢«æ—¥å¿—ä¸­é—´ä»¶è®°å½•åœ¨ç»ˆç«¯ã€‚</p>\n<p>å°±æ˜¯è¿™æ · â€”â€” æˆ‘ä»¬æå®šäº†è¿™ä¸€åˆ‡ã€‚</p>\n<p>å¦‚æœä½ åœ¨å“ªé‡Œå¡ä½äº†ï¼Œå¯ä»¥çœ‹çœ‹æœ¬æ–‡çš„å…¨éƒ¨æºç ï¼š<a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">github.com/adeelibr/deno-playground/tree/master/chapter_1:oak</a></p>\n<p>æˆ‘å¸Œæœ›ä½ è§‰å¾—æœ¬æ–‡ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œå¹¶ä¸”çœŸçš„èƒ½å¸®åŠ©ä½ å­¦åˆ°ä¸€äº›æ–°çš„çŸ¥è¯†ã€‚</p>\n<p>å¦‚æœä½ å–œæ¬¢ï¼Œæ¬¢è¿åˆ†äº«åˆ°ç¤¾äº¤å¹³å°ä¸Šã€‚å¦‚æœä½ æƒ³è¦æ·±å…¥äº¤æµï¼Œå¯ä»¥åœ¨Â <a href="https://twitter.com/adeelibr">Twitter</a>Â ä¸Šä¸æˆ‘è”ç³»ã€‚</p>'
        } }),
    'toc': React.createElement("aside", { dangerouslySetInnerHTML: {
            __html: '<nav class="toc"><ol><li><a href="#%E5%BA%8F%E8%A8%80">åºè¨€</a><ol><li><a href="#%E6%9C%AC%E6%96%87%E4%BC%9A%E6%B6%89%E5%8F%8A%E7%9A%84%E5%86%85%E5%AE%B9">æœ¬æ–‡ä¼šæ¶‰åŠçš„å†…å®¹</a></li><li><a href="#%E6%9C%AC%E6%96%87%E9%9C%80%E8%A6%81%E7%9A%84%E7%9F%A5%E8%AF%86%E5%87%86%E5%A4%87">æœ¬æ–‡éœ€è¦çš„çŸ¥è¯†å‡†å¤‡</a></li></ol></li><li><a href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%BC%80%E5%A7%8B%E5%90%A7">è®©æˆ‘ä»¬å¼€å§‹å§</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">é¡¹ç›®çš„å‡†å¤‡å·¥ä½œ</a></li><li><a href="#%E8%AE%A9%E6%88%91%E4%BB%AC%E5%85%B3%E6%B3%A8%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%99%A8%E4%B8%8A">è®©æˆ‘ä»¬å…³æ³¨åœ¨æ§åˆ¶å™¨ä¸Š</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-404-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6">åˆ›å»ºä¸€ä¸ª 404 è·¯ç”±ä¸­é—´ä»¶</a></li><li><a href="#%E7%BB%88%E7%AB%AF%E4%B8%AD%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6">ç»ˆç«¯ä¸­æ‰“å°æ—¥å¿—çš„ä¸­é—´ä»¶</a></li></ol></nav>'
        } }),
    'author': "hylerrix",
    'contributors': [
        "hylerrix"
    ],
    'date': "2021-03-09T09:47:13.000Z",
    'updated': null,
    'excerpt': "åºè¨€ æˆ‘æ˜¯ä¸€ä½ JavaScript/Node å¼€å‘è€…ï¼Œé»˜é»˜åœ°å–œæ¬¢ç”šè‡³çˆ±æ…•ç€ Denoã€‚Deno è¯ç”Ÿä¹‹åˆå°±æ·±æ·±åœ°å¸å¼•äº†æˆ‘ï¼Œæ­¤åæˆ‘æˆä¸ºäº† Deno çš„å¿ å®ç²‰ä¸ï¼ŒæœŸå¾…ç€æœ‰æœä¸€æ—¥èƒ½æ­£å¼ç©ä¸Š Denoã€‚ æœ¬æ–‡ä¸“æ³¨äºåˆ›é€ ä¸€ä¸ªåŸºäº REST API è®¾è®¡çš„å¾…åšæ¸…å•ï¼ˆTodo...",
    'cover': "http://qiniu.ningo.cloud/articles/1b4-01.jpg",
    'sidebar': [
        {
            "text": "Deno é’»ç ”ä¹‹æœ¯",
            "link": "articles/index.html",
            "pagePath": "articles/README.md"
        },
        {
            "link": "articles/document/index.html",
            "title": "æ–‡æ¡£ç¯‡",
            "children": [
                {
                    "text": "Deno ç‰ˆæœ¬å†å²æ¦‚è§ˆ",
                    "link": "articles/document/deno-version-handbook.html",
                    "pagePath": "articles/document/deno-version-handbook.md"
                },
                {
                    "text": "Deno CLI é€šç”¨æ‰‹å†Œ",
                    "link": "articles/document/deno-cli-handbook.html",
                    "pagePath": "articles/document/deno-cli-handbook.md"
                },
                {
                    "text": "Deno ä¸“ä¸šæœ¯è¯­ç¿»è¯‘æ‰‹å†Œ",
                    "link": "articles/document/deno-translation-dictionary.html",
                    "pagePath": "articles/document/deno-translation-dictionary.md"
                }
            ],
            "pagePath": "articles/document/README.md",
            "text": "æ–‡æ¡£ç¯‡"
        },
        {
            "link": "articles/basic/index.html",
            "title": "åŸºç¡€ç¯‡",
            "children": [
                {
                    "text": "Helloï¼Œä»å¤šæ ·åŒ–å®‰è£…åˆ°ç®€å•å®æˆ˜",
                    "link": "articles/basic/install-and-hello-world.html",
                    "pagePath": "articles/basic/install-and-hello-world.md"
                }
            ],
            "pagePath": "articles/basic/README.md",
            "text": "åŸºç¡€ç¯‡"
        },
        {
            "link": "articles/architecture/index.html",
            "title": "æ¶æ„ç¯‡",
            "children": [
                {
                    "link": "articles/architecture/cli/index.html",
                    "title": "æ¢ç´¢ CLI",
                    "children": [
                        {
                            "text": "ä» CLI æŒ‡ä»¤é€šè¯» Deno v1.x å…¨ç‰¹æ€§",
                            "link": "articles/architecture/cli/deno-cli-v1-function.html",
                            "pagePath": "articles/architecture/cli/deno-cli-v1-function.md"
                        }
                    ],
                    "pagePath": "articles/architecture/cli/README.md",
                    "text": "CLI ç¯‡"
                }
            ],
            "pagePath": "articles/architecture/README.md",
            "text": "æ¶æ„ç¯‡"
        },
        {
            "link": "articles/ecology/index.html",
            "title": "ç”Ÿæ€ç¯‡",
            "children": [
                {
                    "text": "Awesome Deno ä¸­æ–‡èµ„æºå…¨å›¾è°±",
                    "link": "articles/ecology/awesome-deno-cn.html",
                    "pagePath": "articles/ecology/awesome-deno-cn.md"
                }
            ],
            "pagePath": "articles/ecology/README.md",
            "text": "ç”Ÿæ€ç¯‡"
        },
        {
            "link": "articles/node/index.html",
            "title": "Node ç¯‡",
            "children": [
                {
                    "text": "æ·±å…¥æµ…å‡º Create React App",
                    "link": "articles/node/create-react-app-intro.html",
                    "pagePath": "articles/node/create-react-app-intro.md"
                },
                {
                    "text": "æ¬²å–ä»£ç»å¤§å¤š JavaScript å·¥å…·é“¾ï¼ŸRome å°é²œ",
                    "link": "articles/node/javascript-toolchain-rome.html",
                    "pagePath": "articles/node/javascript-toolchain-rome.md"
                }
            ],
            "pagePath": "articles/node/README.md",
            "text": "Node ç¯‡"
        },
        {
            "link": "articles/official/index.html",
            "title": "å®˜æ–¹ç¯‡",
            "children": [
                {
                    "text": "ç²¾è¯»ã€ŠDeno 2020 å®˜æ–¹å›é¡¾åŠ 2021 å±•æœ›ã€‹",
                    "link": "articles/official/thoroughgoing-deno-in-2020.html",
                    "pagePath": "articles/official/thoroughgoing-deno-in-2020.md"
                },
                {
                    "text": "ç²¾è¯»ã€ŠDeno v1.8 å‘å¸ƒè¯´æ˜ã€‹",
                    "link": "articles/official/thoroughgoing-deno-1-8.html",
                    "pagePath": "articles/official/thoroughgoing-deno-1-8.md"
                }
            ],
            "pagePath": "articles/official/README.md",
            "text": "å®˜æ–¹ç¯‡"
        },
        {
            "link": "articles/translation/index.html",
            "title": "ç¿»è¯‘ç¯‡",
            "children": [
                {
                    "text": "Deno å…¥é—¨æ‰‹å†Œï¼šé™„å¤§é‡ TypeScript ä»£ç å®ä¾‹",
                    "link": "articles/translation/the-deno-handbook.html",
                    "pagePath": "articles/translation/the-deno-handbook.md"
                },
                {
                    "text": "Deno + WebSockets æ‰“é€ èŠå¤©å®¤åº”ç”¨",
                    "link": "articles/translation/deno-chat-app.html",
                    "pagePath": "articles/translation/deno-chat-app.md"
                },
                {
                    "text": "ä» Node åˆ° Denoï¼šæ¢ç´¢å„å¤§ä¸»æµåº“æ›¿ä»£æ–¹æ¡ˆ",
                    "link": "articles/translation/from-node-to-deno.html",
                    "pagePath": "articles/translation/from-node-to-deno.md"
                },
                {
                    "text": "Deno + Oak æ„å»ºé…·ç‚«çš„ Todo API",
                    "link": "articles/translation/deno-oak-todo-api.html",
                    "pagePath": "articles/translation/deno-oak-todo-api.md"
                },
                {
                    "text": "Deno + Oak è¿æ¥ MySQL å®æˆ˜æ•™ç¨‹",
                    "link": "articles/translation/deno-oak-mysql.html",
                    "pagePath": "articles/translation/deno-oak-mysql.md"
                },
                {
                    "text": "ä¸ºä»€ä¹ˆæˆ‘è®¤ä¸º Deno æ˜¯ä¸€ä¸ªè¿ˆå‘é”™è¯¯æ–¹å‘çš„ JavaScript è¿è¡Œæ—¶ï¼Ÿ",
                    "link": "articles/translation/why-deno-wrong.html",
                    "pagePath": "articles/translation/why-deno-wrong.md"
                }
            ],
            "pagePath": "articles/translation/README.md",
            "text": "ç¿»è¯‘ç¯‡"
        },
        {
            "link": "articles/rust/README.md",
            "title": "Rust ç¯‡",
            "children": [
                {
                    "text": "Rust è¯­è¨€å…¥é—¨æ•™ç¨‹ï¼šä»å®æˆ˜ To-Do App å¼€å§‹",
                    "link": "articles/rust/rust-tutorial-todo-app.html",
                    "pagePath": "articles/rust/rust-tutorial-todo-app.md"
                }
            ],
            "text": "articles/rust/README.md"
        },
        {
            "text": "æ„Ÿè°¢",
            "link": "articles/THANKS.html",
            "pagePath": "articles/THANKS.md"
        }
    ],
    'gitalk': React.createElement(Gitalk, { admin: [
            'hylerrix'
        ], clientID: "60180eea2c09238f8998", clientSecret: "e9ea0ff6555185eda28eff4dfd4b755b1764abf3", id: "articles/translation/deno-oak-todo-api.html", owner: "hylerrix", pagerDirection: "first", repo: "deno-tutorial", title: "Deno + Oak \u6784\u5EFA\u9177\u70AB\u7684 Todo API" })
};
