import projectConfig from '/pagic.config.js';
import Ga from '/_ga.js';
import Gitalk from '/_gitalk.js';
export default {
    'prev': undefined,
    'next': undefined,
    config: { "root": "/", ...projectConfig, branch: 'main' },
    'pagePath': "articles/translation/original-articles/deno-chat-app.md.md",
    'layoutPath': "_layout.tsx",
    'outputPath': "articles/translation/original-articles/deno-chat-app.md.html",
    'title': "Learn Deno: Chat app",
    'content': React.createElement("article", { dangerouslySetInnerHTML: {
            __html: '<h1><a href="https://aralroca.com/blog/learn-deno-chat-app">Learn Deno: Chat app</a></h1>\n<p>Node.js was writtern initially by <a href="https://en.wikipedia.org/wiki/Ryan_Dahl">Ryan Dahl</a> on 2009 (in C++). Ryan left Node.js in 2012, as at this point he felt he had more or less fulfilled his goals.</p>\n<p>His goals are now different. After realizing that there were some design errors impossible to fix in Node.js, he decided to create another JavaScript (also TypeScript) runtime built with V8: Deno (in Rust). Deno 1.0.0 will be finally released on 13th May 2020.</p>\n<p><img src="https://aralroca.com/images/blog-images/38.svg" alt=""></p>\n<p>We\'ll see how Deno works and its differences with Node, implementing a simple chat application.</p>\n<p><strong>We will cover the following:</strong></p>\n<ul>\n<li><a href="#learn-deno-chat-app">Learn Deno: Chat app</a>\n<ul>\n<li><a href="#installing-deno">Installing Deno</a></li>\n<li><a href="#simple-%22hello-world%22">Simple &quot;Hello World&quot;</a></li>\n<li><a href="#serve-an-indexhtml">Serve an index.html</a></li>\n<li><a href="#using-websockets">Using WebSockets</a></li>\n<li><a href="#third-party-and-depsts-convention">Third-party and deps.ts convention</a></li>\n<li><a href="#testing">Testing</a></li>\n<li><a href="#debugging">Debugging</a></li>\n<li><a href="#conclusion">Conclusion</a></li>\n<li><a href="#code-of-this-article">Code of this article</a></li>\n<li><a href="#references">References</a></li>\n</ul>\n</li>\n</ul>\n<h2 id="installing-deno">Installing Deno<a class="anchor" href="#installing-deno">¬ß</a></h2>\n<p>There are different ways to install Deno: Using curl, iwr, Homebrew, Chocolatey... See how to install it <a href="https://github.com/denoland/deno/blob/34ec3b225425cecdccf754fbc87f4a8f3728890d/docs/getting_started/installation.md">here</a>. Deno is a single binary executable, it has no external dependencies.</p>\n<p>In my case I\'m going to use Homebrew:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  ~ brew install deno\n‚ûú  ~ deno <span class="token operator">-</span><span class="token operator">-</span>version\ndeno <span class="token number">1.0</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>rc1\nv8 <span class="token number">8.2</span><span class="token punctuation">.</span><span class="token number">308</span>\ntypescript <span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">3</span>\n</code></pre>\n<p>As we can see, there\'s no <code>npm</code> here. Npm started to be essential in the Node ecosystem... And it\'s a centralized (privately controlled even) repository for modules. This is now changing with Deno. We will see later how to install packages without a <code>package.json</code> and <code>node_modules</code> either.</p>\n<p>To upgrade to the latest version we need to do <code>deno upgrade</code>.</p>\n<p>I recommend to execute <code>deno help</code> to see all the possible usages:</p>\n<pre class="language-autoit"><code class="language-autoit">USAGE<span class="token punctuation">:</span>\n    deno <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUBCOMMAND<span class="token punctuation">]</span>\n\nOPTIONS<span class="token punctuation">:</span>\n    <span class="token operator">-</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>help                     Prints help information\n    <span class="token operator">-</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>log<span class="token operator">-</span>level <span class="token operator">&lt;</span>log<span class="token operator">-</span>level<span class="token operator">></span>    Set log level <span class="token punctuation">[</span>possible values<span class="token punctuation">:</span> debug<span class="token punctuation">,</span> info<span class="token punctuation">]</span>\n    <span class="token operator">-</span>q<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>quiet                    Suppress diagnostic output\n    <span class="token operator">-</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>version                  Prints version information\n\nSUBCOMMANDS<span class="token punctuation">:</span>\n    bundle         Bundle module <span class="token operator">and</span> dependencies into single file\n    cache          Cache the dependencies\n    completions    Generate shell completions\n    doc            Show documentation <span class="token keyword">for</span> a module\n    eval           Eval script\n    fmt            Format source files\n    help           Prints this message <span class="token operator">or</span> the help of the given <span class="token function">subcommand</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    info           Show info about cache <span class="token operator">or</span> info related <span class="token keyword">to</span> source file\n    install        Install script as an executable\n    repl           Read Eval Print Loop\n    run            Run a program given a filename <span class="token operator">or</span> url <span class="token keyword">to</span> the module\n    test           Run tests\n    types          Print runtime TypeScript declarations\n    upgrade        Upgrade deno executable <span class="token keyword">to</span> newest version\n\nENVIRONMENT VARIABLES<span class="token punctuation">:</span>\n    DENO_DIR             Set deno\'s base directory <span class="token punctuation">(</span>defaults <span class="token keyword">to</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>deno<span class="token punctuation">)</span>\n    DENO_INSTALL_ROOT    Set deno install\'s output directory\n                         <span class="token punctuation">(</span>defaults <span class="token keyword">to</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>deno<span class="token operator">/</span>bin<span class="token punctuation">)</span>\n    NO_COLOR             Set <span class="token keyword">to</span> disable color\n    HTTP_PROXY           Proxy address <span class="token keyword">for</span> HTTP requests\n                         <span class="token punctuation">(</span>module downloads<span class="token punctuation">,</span> fetch<span class="token punctuation">)</span>\n    HTTPS_PROXY          Same but <span class="token keyword">for</span> HTTPS\n</code></pre>\n<p>In case that you are using Visual Studio Code, I recommend to install this plugin to ease working with Deno:</p>\n<ul>\n<li><a href="https://marketplace.visualstudio.com/items?itemName=axetroy.vscode-deno">https://marketplace.visualstudio.com/items?itemName=axetroy.vscode-deno</a></li>\n</ul>\n<h2 id="simple-hello-world">Simple &quot;Hello World&quot;<a class="anchor" href="#simple-hello-world">¬ß</a></h2>\n<p>For a simple &quot;Hello world&quot; in Deno, we just need to create a file <code>.js</code> or <code>.ts</code>, and execute it with <code>deno run [file]</code>.</p>\n<p>In case of <code>.ts</code>, it will compile + execute, meanwhile for <code>.js</code>, the file will be executed directly:</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// example.ts file</span>\n<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">\'Hello from Deno üñê\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>And in the shell:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno run example<span class="token punctuation">.</span>ts\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>example<span class="token punctuation">.</span>ts\nHello from Deno üñê\n</code></pre>\n<p>The <code>tsconfig.json</code> file is optional because in Deno there are some TypeScript defaults. To apply the <code>tsconfig.json</code> we should use <code>deno run -c tsconfig.json [file]</code>.</p>\n<p>By the way, Deno uses web standards where possible. It\'s possible to use <code>window</code>, <code>fetch</code>, <code>Worker</code>... Our code should be compatible with both Deno and the browser.</p>\n<h2 id="serve-an-indexhtml">Serve an index.html<a class="anchor" href="#serve-an-indexhtml">¬ß</a></h2>\n<p>Deno has his own standard library <a href="https://deno.land/std/">https://deno.land/std/</a> so to use their modules we can import it directly from the <strong>URL</strong>. One of its goals is shipping only a single executable with minimal linkage. This way it\'s only necessary to import the URL to their projects, or execute directly with <code>deno run https://...</code> in case of CLIs.</p>\n<p>In order to create a http server and serve an <code>index.html</code> we are going to use this module: <a href="https://deno.land/std/http/">https://deno.land/std/http/</a>.</p>\n<p>We are going to create two files: <code>server.ts</code> and <code>index.html</code>.</p>\n<p><small>index.html</small></p>\n<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Example using Deno<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    index.html served correctly\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n<p><small>server.ts</small></p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> listenAndServe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/http/server.ts">https://deno.land/std/http/server.ts</a>\'</span>\n\n<span class="token function">listenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">method</span> <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">===</span> <span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    req<span class="token punctuation">.</span><span class="token method function property-access">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n      headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token string">\'content-type\'</span><span class="token operator">:</span> <span class="token string">\'text/html\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token operator">:</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Deno</span><span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">\'./index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">\'Server running on localhost:3000\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>We can use ESmodules by default instead of Common.js, indicating the file extension always at the end. Moreover, it supports the latest features as <code>async-await</code>.</p>\n<p>Also, we don\'t need to worry about formatting anymore. Instead of using tools as Prettier, we can format the files with <code>deno fmt</code> command.</p>\n<p>The first time <code>deno run server.ts</code> runs, we\'ll see two differences with respect to the &quot;Hello World&quot; example:</p>\n<ol>\n<li>\n<p>It downloads all the dependencies from <code>http</code> module. Instead of using <code>yarn</code> or <code>npm install</code>, it should install all the needed dependencies before running the project. This happens only the first time, since it\'s cached. To clean the cache you can use the <code>--reload</code> command.</p>\n</li>\n<li>\n<p>It throws an error <code>Uncaught PermissionDenied: network access to &quot;127.0.0.1:3000&quot;, run again with the --allow-net flag</code>. Deno is secure by default. This means that we can\'t access to the net or read a file (index.html). This is one of the big improvements over Node. In Node any CLI library could do many things without our consent. With Deno it\'s possible, for example, to allow reading access only in one folder: <code>deno --allow-read=/etc</code>. To see all permission flags, run <code>deno run -h</code>.</p>\n</li>\n</ol>\n<p>Now we are ready to serve <code>index.html</code>:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>read server<span class="token punctuation">.</span>ts\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>server<span class="token punctuation">.</span>ts\nServer running on localhost<span class="token punctuation">:</span><span class="token number">3000</span>\n</code></pre>\n<p><img src="https://aralroca.com/images/blog-images/32.png" alt=""></p>\n<h2 id="using-websockets">Using WebSockets<a class="anchor" href="#using-websockets">¬ß</a></h2>\n<p>WebSockets, UUID, and other essentials in Node are not part of the core. This means that we need to use third-party libraries to use it. Yet, you can use WebSockets and UUID among many others by using Deno standard library. In other words, you don\'t need to worry about maintenance, because now it will be always maintained.</p>\n<p>To continue implementing our simple chat app, let\'s create a new file <code>chat.ts</code> with:</p>\n<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  WebSocket<span class="token punctuation">,</span>\n  isWebSocketCloseEvent<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/ws/mod.ts">https://deno.land/std/ws/mod.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>\'</span>\n\n<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> WebSocket<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> senderId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">)</span> <span class="token keyword">return</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>senderId <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>senderId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> message<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">chat</span><span class="token punctuation">(</span>ws<span class="token operator">:</span> WebSocket<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> userId <span class="token operator">=</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// Register user connection</span>\n  users<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> ws<span class="token punctuation">)</span>\n  <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">> User with the id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is connected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n  <span class="token comment">// Wait for new messages</span>\n  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> event <span class="token keyword">of</span> ws<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span>\n\n    <span class="token function">broadcast</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>\n\n    <span class="token comment">// Unregister user conection</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message <span class="token operator">&amp;&amp;</span> <span class="token function">isWebSocketCloseEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      users<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>\n      <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">> User with the id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is disconnected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token keyword">break</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, register an endpoint <code>/ws</code> to expose the chat on <code>server.ts</code>:</p>\n<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> listenAndServe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/http/server.ts">https://deno.land/std/http/server.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> acceptWebSocket<span class="token punctuation">,</span> acceptable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/ws/mod.ts">https://deno.land/std/ws/mod.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> chat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./chat.ts\'</span>\n\n<span class="token function">listenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n      headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token string">\'content-type\'</span><span class="token operator">:</span> <span class="token string">\'text/html\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token operator">:</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">\'./index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// WebSockets Chat</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">\'/ws\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">acceptable</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">acceptWebSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        conn<span class="token operator">:</span> req<span class="token punctuation">.</span>conn<span class="token punctuation">,</span>\n        bufReader<span class="token operator">:</span> req<span class="token punctuation">.</span>r<span class="token punctuation">,</span>\n        bufWriter<span class="token operator">:</span> req<span class="token punctuation">.</span>w<span class="token punctuation">,</span>\n        headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>chat<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Server running on localhost:3000\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>To implement our client-side part, we are going to choose Preact to be able to use modules directly without the need of npm, babel and webpack, as we saw on the <a href="https://aralroca.com/blog/app-with-react-api-without-tools-as-webpack-or-babel">previous article</a>.</p>\n<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Chat using Deno<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>\n        html<span class="token punctuation">,</span>\n        render<span class="token punctuation">,</span>\n        useEffect<span class="token punctuation">,</span>\n        useState<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://unpkg.com/htm/preact/standalone.module.js">https://unpkg.com/htm/preact/standalone.module.js</a>\'</span>\n\n      <span class="token keyword">let</span> ws\n\n      <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chat</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Messages</span>\n        <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">onReceiveMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>m<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">onSendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span>\n\n          e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          ws<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n          e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">\'\'</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Websocket connection + events</span>\n        <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>ws<span class="token punctuation">)</span> ws<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ws://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">host</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/ws</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n          ws<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">)</span>\n\n          <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n            ws<span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n        <span class="token keyword control-flow">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token embedded-code html">\n          ${messages.map((message) => html` &lt;div>${message}&lt;/div> `)}\n\n          &lt;form onSubmit=${onSendMessage}>\n            &lt;input type="text" />\n            &lt;button>Send&lt;/button>\n          &lt;/form>\n        </span><span class="token template-punctuation string">`</span></span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token embedded-code html">&lt;${Chat} /></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">\'app\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n<p>Result:</p>\n<p><img src="https://aralroca.com/images/blog-images/33.gif" alt=""></p>\n<p>It\'s a very ugly chat without styles, but functional, because our aim here is to understand how Deno works.</p>\n<h2 id="third-party-and-depsts-convention">Third-party and deps.ts convention<a class="anchor" href="#third-party-and-depsts-convention">¬ß</a></h2>\n<p>We can use third-party libraries in the same way we use the Deno Standard Library, by importing directly the URL of the module.</p>\n<ul>\n<li>STD, Deno core libraries: <a href="https://deno.land/std/">https://deno.land/std/</a></li>\n<li>X, Deno Third-party libraries: <a href="https://deno.land/x/">https://deno.land/x/</a></li>\n</ul>\n<p>However, the ecosystem in <a href="https://deno.land/x/">https://deno.land/x/</a> is quite small yet. But hey, I have good news for you, we can use packages from <a href="https://www.pika.dev">https://www.pika.dev</a>. Thanks to tools like Parcel or Minibundle we can compile Node libraries into modules to re-use them in Deno projects.</p>\n<p>We are going to use the <a href="https://www.pika.dev/npm/camel-case">camel-case</a> package to transform every chat message to camelCase!</p>\n<p><img src="https://aralroca.com/images/blog-images/34.png" alt=""></p>\n<p>Let\'s add this import in our <code>chat.ts</code> file:</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://cdn.pika.dev/camel-case@">https://cdn.pika.dev/camel-case@</a>^4.1.1\'</span>\n<span class="token comment">// ...before code</span>\n<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n<span class="token comment">// ... before code</span>\n</code></pre>\n<p>That\'s it. Running again the <code>server.ts</code> is going to download the <code>camel-case</code> package. Now you can see that it works:</p>\n<p><img src="https://aralroca.com/images/blog-images/35.gif" alt=""></p>\n<p>However, if I want to use this <code>camelCase</code> helper in more than one file, it\'s cumbersome to add the full import everywhere. The URL indicates which version of the package we have to use. This means that if we want to upgrade a dependency we will need to search and replace all the imports. This could cause us problems, but don\'t worry, there is a Deno convention for the dependencies that solves this. Creating a <code>deps.ts</code> file to export all project dependencies.</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// deps.ts file</span>\n<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://cdn.pika.dev/camel-case@">https://cdn.pika.dev/camel-case@</a>^4.1.1\'</span>\n</code></pre>\n<p>and</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// chat.ts file</span>\n<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./deps.ts\'</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n<span class="token comment">// ...</span>\n</code></pre>\n<h2 id="testing">Testing<a class="anchor" href="#testing">¬ß</a></h2>\n<p>We are going to build a useless <code>camelize.ts</code> utility to return the text in camelCase with a nice extra, it includes one üê™ per uppercase letter. Why? To see how to test it with Deno.</p>\n<pre class="language-js"><code class="language-js"><span class="token doc-comment comment">/**\n * Return the text in camelCase + how many üê™\n *\n * <span class="token keyword">@example</span> <span class="token example"><span class="token code language-javascript"><span class="token string">"this is an example"</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"thisIsAnExample üê™üê™üê™"</span></span></span>\n * <span class="token keyword">@param</span> <span class="token parameter">text</span>\n * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span>\n */</span>\n<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">camelize</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// @todo</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>By the way, we can visualize the JSdocs of a file using <code>deno doc [file]</code>:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno doc camelize<span class="token punctuation">.</span>ts\nfunction <span class="token function">camelize</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> string<span class="token punctuation">)</span>\n  Return the text <span class="token keyword">in</span> camelCase <span class="token operator">+</span> how many üê™\n</code></pre>\n<p>Let\'s create a file <code>test.ts</code>. The test runner is built into the core of Deno using the <code>Deno.test()</code> and we can use assertions using the STD <a href="https://deno.land/std/testing/asserts.ts">https://deno.land/std/testing/asserts.ts</a>.</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertStrictEq <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/testing/asserts.ts">https://deno.land/std/testing/asserts.ts</a>\'</span>\n<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelize <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./camelize.ts\'</span>\n\n<span class="token maybe-class-name">Deno</span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span><span class="token string">\'camelize works\'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">assertStrictEq</span><span class="token punctuation">(</span><span class="token function">camelize</span><span class="token punctuation">(</span><span class="token string">\'this is an example\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'thisIsAnExample üê™üê™üê™\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>To run all tests, we just need to execute <code>deno test</code>.</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno test\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>test<span class="token punctuation">.</span>ts\nrunning <span class="token number">1</span> tests\ntest camelize works <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> FAILED <span class="token punctuation">(</span>0ms<span class="token punctuation">)</span>\n\nfailures<span class="token punctuation">:</span>\n\ncamelize works\nAssertionError<span class="token punctuation">:</span> actual<span class="token punctuation">:</span> undefined expected<span class="token punctuation">:</span> thisIsAnExample üê™üê™üê™\n    at assertStrictEq <span class="token punctuation">(</span>asserts<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">224</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at test<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">3</span>\n    at asyncOpSanitizer <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at Object<span class="token punctuation">.</span>resourceSanitizer <span class="token punctuation">[</span>as fn<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at TestApi<span class="token punctuation">.</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">264</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">)</span>\n    at TestApi<span class="token punctuation">.</span><span class="token keyword">next</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>anonymous<span class="token operator">></span><span class="token punctuation">)</span>\n    at Object<span class="token punctuation">.</span>runTests <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">346</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">)</span>\n\nfailures<span class="token punctuation">:</span>\n\n        camelize works\n\ntest result<span class="token punctuation">:</span> FAILED<span class="token punctuation">.</span> <span class="token number">0</span> passed<span class="token comment">; 1 failed; 0 ignored; 0 measured; 0 filtered out (0ms)</span>\n</code></pre>\n<p>Of course it fails because we didn\'t implemented our utility yet, but still, we can see how the errors are displayed in the shell.</p>\n<p>After implementing the <code>camelize</code> utility:</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./deps.ts\'</span>\n\n<span class="token doc-comment comment">/**\n * Return the text in camelCase + how many üê™\n *\n * <span class="token keyword">@example</span> <span class="token example"><span class="token code language-javascript"><span class="token string">"this is an example"</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"thisIsAnExample üê™üê™üê™"</span></span></span>\n * <span class="token keyword">@param</span> <span class="token parameter">text</span>\n * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span>\n */</span>\n<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">camelize</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> camelCaseText <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> matches <span class="token operator">=</span> camelCaseText<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[A-Z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token keyword">const</span> camels <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> matches<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">\'üê™\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>\n\n  <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>camelCaseText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>camels<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now all tests pass:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno test\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>camelize<span class="token punctuation">.</span>ts\nrunning <span class="token number">1</span> tests\ntest camelize works <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ok <span class="token punctuation">(</span>3ms<span class="token punctuation">)</span>\n\ntest result<span class="token punctuation">:</span> ok<span class="token punctuation">.</span> <span class="token number">1</span> passed<span class="token comment">; 0 failed; 0 ignored; 0 measured; 0 filtered out (3ms)</span>\n</code></pre>\n<p>If you want to use a watcher to not execute everytime all tests, you can use <a href="https://deno.land/x/denon/">https://deno.land/x/denon/</a>, based on nodemon, and then run <code>denon test</code>.</p>\n<p>Now we are ready to use our helper on <code>chat.ts</code>.</p>\n<p><img src="https://aralroca.com/images/blog-images/36.png" alt=""></p>\n<h2 id="debugging">Debugging<a class="anchor" href="#debugging">¬ß</a></h2>\n<p>In order to debug with Deno:</p>\n<ol>\n<li>Add somewhere in your code a <code>debugger;</code> line of code.</li>\n<li>Run with <code>--inspect-brk</code> flag. <code>deno run --inspect-brk ...</code> or <code>deno test --inspect-brk ...</code> to debug tests.</li>\n<li>Open <code>chrome://inspect</code> page on Chrome.</li>\n<li>On the Remote Target section press to &quot;inspect&quot;.</li>\n<li>Press the Resume script execution button, the code will pause just in your breakpoint.</li>\n</ol>\n<p><img src="https://aralroca.com/images/blog-images/37.png" alt=""></p>\n<h2 id="conclusion">Conclusion<a class="anchor" href="#conclusion">¬ß</a></h2>\n<p>We learned about how Deno works by creating a simple chat app in TypeScript. We did it without npm, package.json, node_modules, webpack, babel, jest, prettier... because we don\'t need them, Deno simplifies this.</p>\n<p>We explored important things to begin with a Deno project: Permissions, deno commands, how to use deno internals, how to use third-party dependencies, serving a file, websockets, formating files, testing, debugging, etc.</p>\n<p>I hope this article will be useful to start using Deno 1.0.0 in your projects when it comes out on May 13, 2020.</p>\n<h2 id="code-of-this-article">Code of this article<a class="anchor" href="#code-of-this-article">¬ß</a></h2>\n<p>I uploaded the code on my GitHub:</p>\n<ul>\n<li><a href="https://github.com/aralroca/chat-with-deno-and-preact">https://github.com/aralroca/chat-with-deno-and-preact</a></li>\n</ul>\n<h2 id="references">References<a class="anchor" href="#references">¬ß</a></h2>\n<ul>\n<li><a href="https://deno.land/">https://deno.land/</a></li>\n<li><a href="https://github.com/denoland/deno/tree/master/docs">https://github.com/denoland/deno/tree/master/docs</a></li>\n<li><a href="https://blog.logrocket.com/deno-1-0-what-you-need-to-know/">https://blog.logrocket.com/deno-1-0-what-you-need-to-know/</a></li>\n<li><a href="https://twitter.com/flaviocopes/status/1259068673966383105">https://twitter.com/flaviocopes/status/1259068673966383105</a></li>\n<li><a href="https://www.youtube.com/watch?v=M3BM9TB-8yA">https://www.youtube.com/watch?v=M3BM9TB-8yA</a></li>\n<li><a href="https://github.com/denoland/deno">https://github.com/denoland/deno</a></li>\n<li><a href="https://en.wikipedia.org/wiki/Ryan_Dahl">https://en.wikipedia.org/wiki/Ryan_Dahl</a></li>\n</ul>'
        } }),
    'head': React.createElement(React.Fragment, null,
        React.createElement(Ga, { id: "UA-169223577-1" }),
        React.createElement("link", { href: "/favicon.png", rel: "icon", type: "image/png" })),
    'script': React.createElement(React.Fragment, null,
        React.createElement("script", { src: "https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js" }),
        React.createElement("script", { src: "https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js" }),
        React.createElement("script", { src: "/index.js", type: "module" })),
    'contentTitle': React.createElement("h1", { key: "0" },
        React.createElement("a", { href: "https://aralroca.com/blog/learn-deno-chat-app" }, "Learn Deno: Chat app")),
    'contentBody': React.createElement("article", { dangerouslySetInnerHTML: {
            __html: '<p>Node.js was writtern initially by <a href="https://en.wikipedia.org/wiki/Ryan_Dahl">Ryan Dahl</a> on 2009 (in C++). Ryan left Node.js in 2012, as at this point he felt he had more or less fulfilled his goals.</p>\n<p>His goals are now different. After realizing that there were some design errors impossible to fix in Node.js, he decided to create another JavaScript (also TypeScript) runtime built with V8: Deno (in Rust). Deno 1.0.0 will be finally released on 13th May 2020.</p>\n<p><img src="https://aralroca.com/images/blog-images/38.svg" alt=""></p>\n<p>We\'ll see how Deno works and its differences with Node, implementing a simple chat application.</p>\n<p><strong>We will cover the following:</strong></p>\n<ul>\n<li><a href="#learn-deno-chat-app">Learn Deno: Chat app</a>\n<ul>\n<li><a href="#installing-deno">Installing Deno</a></li>\n<li><a href="#simple-%22hello-world%22">Simple &quot;Hello World&quot;</a></li>\n<li><a href="#serve-an-indexhtml">Serve an index.html</a></li>\n<li><a href="#using-websockets">Using WebSockets</a></li>\n<li><a href="#third-party-and-depsts-convention">Third-party and deps.ts convention</a></li>\n<li><a href="#testing">Testing</a></li>\n<li><a href="#debugging">Debugging</a></li>\n<li><a href="#conclusion">Conclusion</a></li>\n<li><a href="#code-of-this-article">Code of this article</a></li>\n<li><a href="#references">References</a></li>\n</ul>\n</li>\n</ul>\n<h2 id="installing-deno">Installing Deno<a class="anchor" href="#installing-deno">¬ß</a></h2>\n<p>There are different ways to install Deno: Using curl, iwr, Homebrew, Chocolatey... See how to install it <a href="https://github.com/denoland/deno/blob/34ec3b225425cecdccf754fbc87f4a8f3728890d/docs/getting_started/installation.md">here</a>. Deno is a single binary executable, it has no external dependencies.</p>\n<p>In my case I\'m going to use Homebrew:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  ~ brew install deno\n‚ûú  ~ deno <span class="token operator">-</span><span class="token operator">-</span>version\ndeno <span class="token number">1.0</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>rc1\nv8 <span class="token number">8.2</span><span class="token punctuation">.</span><span class="token number">308</span>\ntypescript <span class="token number">3.8</span><span class="token punctuation">.</span><span class="token number">3</span>\n</code></pre>\n<p>As we can see, there\'s no <code>npm</code> here. Npm started to be essential in the Node ecosystem... And it\'s a centralized (privately controlled even) repository for modules. This is now changing with Deno. We will see later how to install packages without a <code>package.json</code> and <code>node_modules</code> either.</p>\n<p>To upgrade to the latest version we need to do <code>deno upgrade</code>.</p>\n<p>I recommend to execute <code>deno help</code> to see all the possible usages:</p>\n<pre class="language-autoit"><code class="language-autoit">USAGE<span class="token punctuation">:</span>\n    deno <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>SUBCOMMAND<span class="token punctuation">]</span>\n\nOPTIONS<span class="token punctuation">:</span>\n    <span class="token operator">-</span>h<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>help                     Prints help information\n    <span class="token operator">-</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>log<span class="token operator">-</span>level <span class="token operator">&lt;</span>log<span class="token operator">-</span>level<span class="token operator">></span>    Set log level <span class="token punctuation">[</span>possible values<span class="token punctuation">:</span> debug<span class="token punctuation">,</span> info<span class="token punctuation">]</span>\n    <span class="token operator">-</span>q<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>quiet                    Suppress diagnostic output\n    <span class="token operator">-</span>V<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">-</span>version                  Prints version information\n\nSUBCOMMANDS<span class="token punctuation">:</span>\n    bundle         Bundle module <span class="token operator">and</span> dependencies into single file\n    cache          Cache the dependencies\n    completions    Generate shell completions\n    doc            Show documentation <span class="token keyword">for</span> a module\n    eval           Eval script\n    fmt            Format source files\n    help           Prints this message <span class="token operator">or</span> the help of the given <span class="token function">subcommand</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n    info           Show info about cache <span class="token operator">or</span> info related <span class="token keyword">to</span> source file\n    install        Install script as an executable\n    repl           Read Eval Print Loop\n    run            Run a program given a filename <span class="token operator">or</span> url <span class="token keyword">to</span> the module\n    test           Run tests\n    types          Print runtime TypeScript declarations\n    upgrade        Upgrade deno executable <span class="token keyword">to</span> newest version\n\nENVIRONMENT VARIABLES<span class="token punctuation">:</span>\n    DENO_DIR             Set deno\'s base directory <span class="token punctuation">(</span>defaults <span class="token keyword">to</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>deno<span class="token punctuation">)</span>\n    DENO_INSTALL_ROOT    Set deno install\'s output directory\n                         <span class="token punctuation">(</span>defaults <span class="token keyword">to</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>deno<span class="token operator">/</span>bin<span class="token punctuation">)</span>\n    NO_COLOR             Set <span class="token keyword">to</span> disable color\n    HTTP_PROXY           Proxy address <span class="token keyword">for</span> HTTP requests\n                         <span class="token punctuation">(</span>module downloads<span class="token punctuation">,</span> fetch<span class="token punctuation">)</span>\n    HTTPS_PROXY          Same but <span class="token keyword">for</span> HTTPS\n</code></pre>\n<p>In case that you are using Visual Studio Code, I recommend to install this plugin to ease working with Deno:</p>\n<ul>\n<li><a href="https://marketplace.visualstudio.com/items?itemName=axetroy.vscode-deno">https://marketplace.visualstudio.com/items?itemName=axetroy.vscode-deno</a></li>\n</ul>\n<h2 id="simple-hello-world">Simple &quot;Hello World&quot;<a class="anchor" href="#simple-hello-world">¬ß</a></h2>\n<p>For a simple &quot;Hello world&quot; in Deno, we just need to create a file <code>.js</code> or <code>.ts</code>, and execute it with <code>deno run [file]</code>.</p>\n<p>In case of <code>.ts</code>, it will compile + execute, meanwhile for <code>.js</code>, the file will be executed directly:</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// example.ts file</span>\n<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">\'Hello from Deno üñê\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>And in the shell:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno run example<span class="token punctuation">.</span>ts\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>example<span class="token punctuation">.</span>ts\nHello from Deno üñê\n</code></pre>\n<p>The <code>tsconfig.json</code> file is optional because in Deno there are some TypeScript defaults. To apply the <code>tsconfig.json</code> we should use <code>deno run -c tsconfig.json [file]</code>.</p>\n<p>By the way, Deno uses web standards where possible. It\'s possible to use <code>window</code>, <code>fetch</code>, <code>Worker</code>... Our code should be compatible with both Deno and the browser.</p>\n<h2 id="serve-an-indexhtml">Serve an index.html<a class="anchor" href="#serve-an-indexhtml">¬ß</a></h2>\n<p>Deno has his own standard library <a href="https://deno.land/std/">https://deno.land/std/</a> so to use their modules we can import it directly from the <strong>URL</strong>. One of its goals is shipping only a single executable with minimal linkage. This way it\'s only necessary to import the URL to their projects, or execute directly with <code>deno run https://...</code> in case of CLIs.</p>\n<p>In order to create a http server and serve an <code>index.html</code> we are going to use this module: <a href="https://deno.land/std/http/">https://deno.land/std/http/</a>.</p>\n<p>We are going to create two files: <code>server.ts</code> and <code>index.html</code>.</p>\n<p><small>index.html</small></p>\n<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Example using Deno<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    index.html served correctly\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n<p><small>server.ts</small></p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> listenAndServe <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/http/server.ts">https://deno.land/std/http/server.ts</a>\'</span>\n\n<span class="token function">listenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">method</span> <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">===</span> <span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    req<span class="token punctuation">.</span><span class="token method function property-access">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n      headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token string">\'content-type\'</span><span class="token operator">:</span> <span class="token string">\'text/html\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token operator">:</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Deno</span><span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token string">\'./index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">\'Server running on localhost:3000\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>We can use ESmodules by default instead of Common.js, indicating the file extension always at the end. Moreover, it supports the latest features as <code>async-await</code>.</p>\n<p>Also, we don\'t need to worry about formatting anymore. Instead of using tools as Prettier, we can format the files with <code>deno fmt</code> command.</p>\n<p>The first time <code>deno run server.ts</code> runs, we\'ll see two differences with respect to the &quot;Hello World&quot; example:</p>\n<ol>\n<li>\n<p>It downloads all the dependencies from <code>http</code> module. Instead of using <code>yarn</code> or <code>npm install</code>, it should install all the needed dependencies before running the project. This happens only the first time, since it\'s cached. To clean the cache you can use the <code>--reload</code> command.</p>\n</li>\n<li>\n<p>It throws an error <code>Uncaught PermissionDenied: network access to &quot;127.0.0.1:3000&quot;, run again with the --allow-net flag</code>. Deno is secure by default. This means that we can\'t access to the net or read a file (index.html). This is one of the big improvements over Node. In Node any CLI library could do many things without our consent. With Deno it\'s possible, for example, to allow reading access only in one folder: <code>deno --allow-read=/etc</code>. To see all permission flags, run <code>deno run -h</code>.</p>\n</li>\n</ol>\n<p>Now we are ready to serve <code>index.html</code>:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>read server<span class="token punctuation">.</span>ts\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>server<span class="token punctuation">.</span>ts\nServer running on localhost<span class="token punctuation">:</span><span class="token number">3000</span>\n</code></pre>\n<p><img src="https://aralroca.com/images/blog-images/32.png" alt=""></p>\n<h2 id="using-websockets">Using WebSockets<a class="anchor" href="#using-websockets">¬ß</a></h2>\n<p>WebSockets, UUID, and other essentials in Node are not part of the core. This means that we need to use third-party libraries to use it. Yet, you can use WebSockets and UUID among many others by using Deno standard library. In other words, you don\'t need to worry about maintenance, because now it will be always maintained.</p>\n<p>To continue implementing our simple chat app, let\'s create a new file <code>chat.ts</code> with:</p>\n<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>\n  WebSocket<span class="token punctuation">,</span>\n  isWebSocketCloseEvent<span class="token punctuation">,</span>\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/ws/mod.ts">https://deno.land/std/ws/mod.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/uuid/mod.ts">https://deno.land/std/uuid/mod.ts</a>\'</span>\n\n<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> WebSocket<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">function</span> <span class="token function">broadcast</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> senderId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">)</span> <span class="token keyword">return</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    user<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>senderId <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>senderId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> message<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">chat</span><span class="token punctuation">(</span>ws<span class="token operator">:</span> WebSocket<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> userId <span class="token operator">=</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// Register user connection</span>\n  users<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> ws<span class="token punctuation">)</span>\n  <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">> User with the id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is connected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n  <span class="token comment">// Wait for new messages</span>\n  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> event <span class="token keyword">of</span> ws<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span>\n\n    <span class="token function">broadcast</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> userId<span class="token punctuation">)</span>\n\n    <span class="token comment">// Unregister user conection</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message <span class="token operator">&amp;&amp;</span> <span class="token function">isWebSocketCloseEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      users<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>\n      <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">> User with the id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is disconnected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token keyword">break</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now, register an endpoint <code>/ws</code> to expose the chat on <code>server.ts</code>:</p>\n<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> listenAndServe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/http/server.ts">https://deno.land/std/http/server.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> acceptWebSocket<span class="token punctuation">,</span> acceptable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/ws/mod.ts">https://deno.land/std/ws/mod.ts</a>\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> chat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./chat.ts\'</span>\n\n<span class="token function">listenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n      headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token string">\'content-type\'</span><span class="token operator">:</span> <span class="token string">\'text/html\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token operator">:</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">\'./index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// WebSockets Chat</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">\'GET\'</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">\'/ws\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">acceptable</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">acceptWebSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        conn<span class="token operator">:</span> req<span class="token punctuation">.</span>conn<span class="token punctuation">,</span>\n        bufReader<span class="token operator">:</span> req<span class="token punctuation">.</span>r<span class="token punctuation">,</span>\n        bufWriter<span class="token operator">:</span> req<span class="token punctuation">.</span>w<span class="token punctuation">,</span>\n        headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>chat<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Server running on localhost:3000\'</span><span class="token punctuation">)</span>\n</code></pre>\n<p>To implement our client-side part, we are going to choose Preact to be able to use modules directly without the need of npm, babel and webpack, as we saw on the <a href="https://aralroca.com/blog/app-with-react-api-without-tools-as-webpack-or-babel">previous article</a>.</p>\n<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Chat using Deno<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>\n        html<span class="token punctuation">,</span>\n        render<span class="token punctuation">,</span>\n        useEffect<span class="token punctuation">,</span>\n        useState<span class="token punctuation">,</span>\n      <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://unpkg.com/htm/preact/standalone.module.js">https://unpkg.com/htm/preact/standalone.module.js</a>\'</span>\n\n      <span class="token keyword">let</span> ws\n\n      <span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Chat</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Messages</span>\n        <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">onReceiveMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token spread operator">...</span>m<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">onSendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> msg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span>\n\n          e<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          ws<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n          e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">\'\'</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Websocket connection + events</span>\n        <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>ws<span class="token punctuation">)</span> ws<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n          ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ws://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">location</span><span class="token punctuation">.</span><span class="token property-access">host</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/ws</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n          ws<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">)</span>\n\n          <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n            ws<span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">,</span> onReceiveMessage<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n        <span class="token keyword control-flow">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token embedded-code html">\n          ${messages.map((message) => html` &lt;div>${message}&lt;/div> `)}\n\n          &lt;form onSubmit=${onSendMessage}>\n            &lt;input type="text" />\n            &lt;button>Send&lt;/button>\n          &lt;/form>\n        </span><span class="token template-punctuation string">`</span></span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span>html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token embedded-code html">&lt;${Chat} /></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">\'app\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n<p>Result:</p>\n<p><img src="https://aralroca.com/images/blog-images/33.gif" alt=""></p>\n<p>It\'s a very ugly chat without styles, but functional, because our aim here is to understand how Deno works.</p>\n<h2 id="third-party-and-depsts-convention">Third-party and deps.ts convention<a class="anchor" href="#third-party-and-depsts-convention">¬ß</a></h2>\n<p>We can use third-party libraries in the same way we use the Deno Standard Library, by importing directly the URL of the module.</p>\n<ul>\n<li>STD, Deno core libraries: <a href="https://deno.land/std/">https://deno.land/std/</a></li>\n<li>X, Deno Third-party libraries: <a href="https://deno.land/x/">https://deno.land/x/</a></li>\n</ul>\n<p>However, the ecosystem in <a href="https://deno.land/x/">https://deno.land/x/</a> is quite small yet. But hey, I have good news for you, we can use packages from <a href="https://www.pika.dev">https://www.pika.dev</a>. Thanks to tools like Parcel or Minibundle we can compile Node libraries into modules to re-use them in Deno projects.</p>\n<p>We are going to use the <a href="https://www.pika.dev/npm/camel-case">camel-case</a> package to transform every chat message to camelCase!</p>\n<p><img src="https://aralroca.com/images/blog-images/34.png" alt=""></p>\n<p>Let\'s add this import in our <code>chat.ts</code> file:</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://cdn.pika.dev/camel-case@">https://cdn.pika.dev/camel-case@</a>^4.1.1\'</span>\n<span class="token comment">// ...before code</span>\n<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n<span class="token comment">// ... before code</span>\n</code></pre>\n<p>That\'s it. Running again the <code>server.ts</code> is going to download the <code>camel-case</code> package. Now you can see that it works:</p>\n<p><img src="https://aralroca.com/images/blog-images/35.gif" alt=""></p>\n<p>However, if I want to use this <code>camelCase</code> helper in more than one file, it\'s cumbersome to add the full import everywhere. The URL indicates which version of the package we have to use. This means that if we want to upgrade a dependency we will need to search and replace all the imports. This could cause us problems, but don\'t worry, there is a Deno convention for the dependencies that solves this. Creating a <code>deps.ts</code> file to export all project dependencies.</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// deps.ts file</span>\n<span class="token keyword module">export</span> <span class="token exports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://cdn.pika.dev/camel-case@">https://cdn.pika.dev/camel-case@</a>^4.1.1\'</span>\n</code></pre>\n<p>and</p>\n<pre class="language-js"><code class="language-js"><span class="token comment">// chat.ts file</span>\n<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./deps.ts\'</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> event <span class="token operator">:</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n<span class="token comment">// ...</span>\n</code></pre>\n<h2 id="testing">Testing<a class="anchor" href="#testing">¬ß</a></h2>\n<p>We are going to build a useless <code>camelize.ts</code> utility to return the text in camelCase with a nice extra, it includes one üê™ per uppercase letter. Why? To see how to test it with Deno.</p>\n<pre class="language-js"><code class="language-js"><span class="token doc-comment comment">/**\n * Return the text in camelCase + how many üê™\n *\n * <span class="token keyword">@example</span> <span class="token example"><span class="token code language-javascript"><span class="token string">"this is an example"</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"thisIsAnExample üê™üê™üê™"</span></span></span>\n * <span class="token keyword">@param</span> <span class="token parameter">text</span>\n * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span>\n */</span>\n<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">camelize</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// @todo</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>By the way, we can visualize the JSdocs of a file using <code>deno doc [file]</code>:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno doc camelize<span class="token punctuation">.</span>ts\nfunction <span class="token function">camelize</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> string<span class="token punctuation">)</span>\n  Return the text <span class="token keyword">in</span> camelCase <span class="token operator">+</span> how many üê™\n</code></pre>\n<p>Let\'s create a file <code>test.ts</code>. The test runner is built into the core of Deno using the <code>Deno.test()</code> and we can use assertions using the STD <a href="https://deno.land/std/testing/asserts.ts">https://deno.land/std/testing/asserts.ts</a>.</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> assertStrictEq <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'<a class="token url-link" href="https://deno.land/std/testing/asserts.ts">https://deno.land/std/testing/asserts.ts</a>\'</span>\n<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelize <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./camelize.ts\'</span>\n\n<span class="token maybe-class-name">Deno</span><span class="token punctuation">.</span><span class="token method function property-access">test</span><span class="token punctuation">(</span><span class="token string">\'camelize works\'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">assertStrictEq</span><span class="token punctuation">(</span><span class="token function">camelize</span><span class="token punctuation">(</span><span class="token string">\'this is an example\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'thisIsAnExample üê™üê™üê™\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n<p>To run all tests, we just need to execute <code>deno test</code>.</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno test\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>test<span class="token punctuation">.</span>ts\nrunning <span class="token number">1</span> tests\ntest camelize works <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> FAILED <span class="token punctuation">(</span>0ms<span class="token punctuation">)</span>\n\nfailures<span class="token punctuation">:</span>\n\ncamelize works\nAssertionError<span class="token punctuation">:</span> actual<span class="token punctuation">:</span> undefined expected<span class="token punctuation">:</span> thisIsAnExample üê™üê™üê™\n    at assertStrictEq <span class="token punctuation">(</span>asserts<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">224</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at test<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">3</span>\n    at asyncOpSanitizer <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at Object<span class="token punctuation">.</span>resourceSanitizer <span class="token punctuation">[</span>as fn<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">)</span>\n    at TestApi<span class="token punctuation">.</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>asyncIterator<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">264</span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">)</span>\n    at TestApi<span class="token punctuation">.</span><span class="token keyword">next</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>anonymous<span class="token operator">></span><span class="token punctuation">)</span>\n    at Object<span class="token punctuation">.</span>runTests <span class="token punctuation">(</span><span class="token variable">$deno</span>$<span class="token operator">/</span>testing<span class="token punctuation">.</span>ts<span class="token punctuation">:</span><span class="token number">346</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">)</span>\n\nfailures<span class="token punctuation">:</span>\n\n        camelize works\n\ntest result<span class="token punctuation">:</span> FAILED<span class="token punctuation">.</span> <span class="token number">0</span> passed<span class="token comment">; 1 failed; 0 ignored; 0 measured; 0 filtered out (0ms)</span>\n</code></pre>\n<p>Of course it fails because we didn\'t implemented our utility yet, but still, we can see how the errors are displayed in the shell.</p>\n<p>After implementing the <code>camelize</code> utility:</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">\'./deps.ts\'</span>\n\n<span class="token doc-comment comment">/**\n * Return the text in camelCase + how many üê™\n *\n * <span class="token keyword">@example</span> <span class="token example"><span class="token code language-javascript"><span class="token string">"this is an example"</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"thisIsAnExample üê™üê™üê™"</span></span></span>\n * <span class="token keyword">@param</span> <span class="token parameter">text</span>\n * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span>\n */</span>\n<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">camelize</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> camelCaseText <span class="token operator">=</span> <span class="token function">camelCase</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> matches <span class="token operator">=</span> camelCaseText<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[A-Z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token keyword">const</span> camels <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> matches<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">\'üê™\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>\n\n  <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>camelCaseText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>camels<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p>Now all tests pass:</p>\n<pre class="language-autoit"><code class="language-autoit">‚ûú  deno test\nCompile file<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token operator">/</span>Users<span class="token operator">/</span>aralroca<span class="token operator">/</span>camelize<span class="token punctuation">.</span>ts\nrunning <span class="token number">1</span> tests\ntest camelize works <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> ok <span class="token punctuation">(</span>3ms<span class="token punctuation">)</span>\n\ntest result<span class="token punctuation">:</span> ok<span class="token punctuation">.</span> <span class="token number">1</span> passed<span class="token comment">; 0 failed; 0 ignored; 0 measured; 0 filtered out (3ms)</span>\n</code></pre>\n<p>If you want to use a watcher to not execute everytime all tests, you can use <a href="https://deno.land/x/denon/">https://deno.land/x/denon/</a>, based on nodemon, and then run <code>denon test</code>.</p>\n<p>Now we are ready to use our helper on <code>chat.ts</code>.</p>\n<p><img src="https://aralroca.com/images/blog-images/36.png" alt=""></p>\n<h2 id="debugging">Debugging<a class="anchor" href="#debugging">¬ß</a></h2>\n<p>In order to debug with Deno:</p>\n<ol>\n<li>Add somewhere in your code a <code>debugger;</code> line of code.</li>\n<li>Run with <code>--inspect-brk</code> flag. <code>deno run --inspect-brk ...</code> or <code>deno test --inspect-brk ...</code> to debug tests.</li>\n<li>Open <code>chrome://inspect</code> page on Chrome.</li>\n<li>On the Remote Target section press to &quot;inspect&quot;.</li>\n<li>Press the Resume script execution button, the code will pause just in your breakpoint.</li>\n</ol>\n<p><img src="https://aralroca.com/images/blog-images/37.png" alt=""></p>\n<h2 id="conclusion">Conclusion<a class="anchor" href="#conclusion">¬ß</a></h2>\n<p>We learned about how Deno works by creating a simple chat app in TypeScript. We did it without npm, package.json, node_modules, webpack, babel, jest, prettier... because we don\'t need them, Deno simplifies this.</p>\n<p>We explored important things to begin with a Deno project: Permissions, deno commands, how to use deno internals, how to use third-party dependencies, serving a file, websockets, formating files, testing, debugging, etc.</p>\n<p>I hope this article will be useful to start using Deno 1.0.0 in your projects when it comes out on May 13, 2020.</p>\n<h2 id="code-of-this-article">Code of this article<a class="anchor" href="#code-of-this-article">¬ß</a></h2>\n<p>I uploaded the code on my GitHub:</p>\n<ul>\n<li><a href="https://github.com/aralroca/chat-with-deno-and-preact">https://github.com/aralroca/chat-with-deno-and-preact</a></li>\n</ul>\n<h2 id="references">References<a class="anchor" href="#references">¬ß</a></h2>\n<ul>\n<li><a href="https://deno.land/">https://deno.land/</a></li>\n<li><a href="https://github.com/denoland/deno/tree/master/docs">https://github.com/denoland/deno/tree/master/docs</a></li>\n<li><a href="https://blog.logrocket.com/deno-1-0-what-you-need-to-know/">https://blog.logrocket.com/deno-1-0-what-you-need-to-know/</a></li>\n<li><a href="https://twitter.com/flaviocopes/status/1259068673966383105">https://twitter.com/flaviocopes/status/1259068673966383105</a></li>\n<li><a href="https://www.youtube.com/watch?v=M3BM9TB-8yA">https://www.youtube.com/watch?v=M3BM9TB-8yA</a></li>\n<li><a href="https://github.com/denoland/deno">https://github.com/denoland/deno</a></li>\n<li><a href="https://en.wikipedia.org/wiki/Ryan_Dahl">https://en.wikipedia.org/wiki/Ryan_Dahl</a></li>\n</ul>'
        } }),
    'toc': React.createElement("aside", { dangerouslySetInnerHTML: {
            __html: '<nav class="toc"><ol><li><a href="#installing-deno">Installing Deno</a></li><li><a href="#simple-hello-world">Simple &quot;Hello World&quot;</a></li><li><a href="#serve-an-indexhtml">Serve an index.html</a></li><li><a href="#using-websockets">Using WebSockets</a></li><li><a href="#third-party-and-depsts-convention">Third-party and deps.ts convention</a></li><li><a href="#testing">Testing</a></li><li><a href="#debugging">Debugging</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#code-of-this-article">Code of this article</a></li><li><a href="#references">References</a></li></ol></nav>'
        } }),
    'author': "hylerrix",
    'contributors': [
        "hylerrix"
    ],
    'date': "2021-02-22T04:11:42.000Z",
    'updated': null,
    'excerpt': "Node.js was writtern initially by Ryan Dahl on 2009 (in C++). Ryan left Node.js in 2012, as at this point he felt he had more or less fulfilled his goals. His goals are now different. After realizing that there...",
    'cover': "https://aralroca.com/images/blog-images/38.svg",
    'created': "05/10/2020",
    'description': "Learn how Deno works and it's differences with Node.js by creating a Chat application.",
    'tags': "deno, javascript, react",
    'cover_image': "/images/cover-images/8_cover_image.jpg",
    'cover_image_mobile': "/images/cover-images/8_cover_image_mobile.jpg",
    'cover_image_vert': "/images/cover-images/8_cover_image_vert.jpg",
    'cover_color': "#6A6A6C",
    'sidebar': [
        {
            "text": "Deno ÈíªÁ†î‰πãÊúØ",
            "link": "articles/index.html",
            "pagePath": "articles/README.md"
        },
        {
            "link": "articles/document/index.html",
            "title": "ÊñáÊ°£ÁØá",
            "children": [
                {
                    "text": "Deno ÁâàÊú¨ÂéÜÂè≤Ê¶ÇËßà",
                    "link": "articles/document/deno-version-handbook.html",
                    "pagePath": "articles/document/deno-version-handbook.md"
                },
                {
                    "text": "Deno CLI ÈÄöÁî®ÊâãÂÜå",
                    "link": "articles/document/deno-cli-handbook.html",
                    "pagePath": "articles/document/deno-cli-handbook.md"
                },
                {
                    "text": "Deno ‰∏ì‰∏öÊúØËØ≠ÁøªËØëÊâãÂÜå",
                    "link": "articles/document/deno-translation-dictionary.html",
                    "pagePath": "articles/document/deno-translation-dictionary.md"
                }
            ],
            "pagePath": "articles/document/README.md",
            "text": "ÊñáÊ°£ÁØá"
        },
        {
            "link": "articles/basic/index.html",
            "title": "Âü∫Á°ÄÁØá",
            "children": [
                {
                    "text": "HelloÔºå‰ªéÂ§öÊ†∑ÂåñÂÆâË£ÖÂà∞ÁÆÄÂçïÂÆûÊàò",
                    "link": "articles/basic/install-and-hello-world.html",
                    "pagePath": "articles/basic/install-and-hello-world.md"
                }
            ],
            "pagePath": "articles/basic/README.md",
            "text": "Âü∫Á°ÄÁØá"
        },
        {
            "link": "articles/architecture/index.html",
            "title": "Êû∂ÊûÑÁØá",
            "children": [
                {
                    "link": "articles/architecture/cli/index.html",
                    "title": "Êé¢Á¥¢ CLI",
                    "children": [
                        {
                            "text": "‰ªé CLI Êåá‰ª§ÈÄöËØª Deno v1.x ÂÖ®ÁâπÊÄß",
                            "link": "articles/architecture/cli/deno-cli-v1-function.html",
                            "pagePath": "articles/architecture/cli/deno-cli-v1-function.md"
                        }
                    ],
                    "pagePath": "articles/architecture/cli/README.md",
                    "text": "CLI ÁØá"
                }
            ],
            "pagePath": "articles/architecture/README.md",
            "text": "Êû∂ÊûÑÁØá"
        },
        {
            "link": "articles/ecology/index.html",
            "title": "ÁîüÊÄÅÁØá",
            "children": [
                {
                    "text": "Awesome Deno ‰∏≠ÊñáËµÑÊ∫êÂÖ®ÂõæË∞±",
                    "link": "articles/ecology/awesome-deno-cn.html",
                    "pagePath": "articles/ecology/awesome-deno-cn.md"
                }
            ],
            "pagePath": "articles/ecology/README.md",
            "text": "ÁîüÊÄÅÁØá"
        },
        {
            "link": "articles/node/index.html",
            "title": "Node ÁØá",
            "children": [
                {
                    "text": "Ê∑±ÂÖ•ÊµÖÂá∫ Create React App",
                    "link": "articles/node/create-react-app-intro.html",
                    "pagePath": "articles/node/create-react-app-intro.md"
                },
                {
                    "text": "Ê¨≤Âèñ‰ª£ÁªùÂ§ßÂ§ö JavaScript Â∑•ÂÖ∑ÈìæÔºüRome Â∞ùÈ≤ú",
                    "link": "articles/node/javascript-toolchain-rome.html",
                    "pagePath": "articles/node/javascript-toolchain-rome.md"
                }
            ],
            "pagePath": "articles/node/README.md",
            "text": "Node ÁØá"
        },
        {
            "link": "articles/official/index.html",
            "title": "ÂÆòÊñπÁØá",
            "children": [
                {
                    "text": "Á≤æËØª„ÄäDeno 2020 ÂÆòÊñπÂõûÈ°æÂèä 2021 Â±ïÊúõ„Äã",
                    "link": "articles/official/thoroughgoing-deno-in-2020.html",
                    "pagePath": "articles/official/thoroughgoing-deno-in-2020.md"
                }
            ],
            "pagePath": "articles/official/README.md",
            "text": "ÂÆòÊñπÁØá"
        },
        {
            "link": "articles/translation/index.html",
            "title": "ÁøªËØëÁØá",
            "children": [
                {
                    "text": "Deno ÂÖ•Èó®ÊâãÂÜåÔºöÈôÑÂ§ßÈáè TypeScript ‰ª£Á†ÅÂÆû‰æã",
                    "link": "articles/translation/the-deno-handbook.html",
                    "pagePath": "articles/translation/the-deno-handbook.md"
                },
                {
                    "text": "Deno + WebSockets ÊâìÈÄ†ËÅäÂ§©ÂÆ§Â∫îÁî®",
                    "link": "articles/translation/deno-chat-app.html",
                    "pagePath": "articles/translation/deno-chat-app.md"
                },
                {
                    "text": "‰ªé Node Âà∞ DenoÔºöÊé¢Á¥¢ÂêÑÂ§ß‰∏ªÊµÅÂ∫ìÊõø‰ª£ÊñπÊ°à",
                    "link": "articles/translation/from-node-to-deno.html",
                    "pagePath": "articles/translation/from-node-to-deno.md"
                },
                {
                    "text": "Deno + Oak ÊûÑÂª∫ÈÖ∑ÁÇ´ÁöÑ Todo API",
                    "link": "articles/translation/deno-oak-todo-api.html",
                    "pagePath": "articles/translation/deno-oak-todo-api.md"
                },
                {
                    "text": "Deno + Oak ËøûÊé• MySQL ÂÆûÊàòÊïôÁ®ã",
                    "link": "articles/translation/deno-oak-mysql.html",
                    "pagePath": "articles/translation/deno-oak-mysql.md"
                },
                {
                    "text": "‰∏∫‰ªÄ‰πàÊàëËÆ§‰∏∫ Deno ÊòØ‰∏Ä‰∏™ËøàÂêëÈîôËØØÊñπÂêëÁöÑ JavaScript ËøêË°åÊó∂Ôºü",
                    "link": "articles/translation/why-deno-wrong.html",
                    "pagePath": "articles/translation/why-deno-wrong.md"
                }
            ],
            "pagePath": "articles/translation/README.md",
            "text": "ÁøªËØëÁØá"
        },
        {
            "text": "ÊÑüË∞¢",
            "link": "articles/THANKS.html",
            "pagePath": "articles/THANKS.md"
        }
    ],
    'gitalk': React.createElement(Gitalk, { admin: [
            'hylerrix'
        ], clientID: "60180eea2c09238f8998", clientSecret: "e9ea0ff6555185eda28eff4dfd4b755b1764abf3", id: "articles/translation/original-articles/deno-chat-app.md.html", owner: "hylerrix", pagerDirection: "first", repo: "deno-tutorial", title: "Learn Deno: Chat app" })
};
